<div id="instructions" style="display:none;">
    Grants are imported from the institutional finance system and are included in your grants table if you are the PI or the co-PI, but you have to edit the records to 
    <ol>
        <li>Provide the complete title of the application that led to the grant</li>
        <li>Indicate whether the grant is internal (from a UofA unit),</li>
        <li>Provide your estimate of the amount that is available to you, if the grant involves multiple investigators, and</li>
        <li>Indicate whether the grant is internal.</li>
    </ol>
</div>
<p>
    <b>NOTE: If you make any changes on this page and have other tabs open, the changes will not be reflected on those other tabs until you refresh the page.</b>
</p>
<p><a href="#/new" class="button">Add Grant</a><!--&nbsp;<a href="<%= wgServer + wgScriptPath %>/index.php/Special:GrantAwardPage" class="button">Show Awarded NSERC Applications</a></p>-->
<table id="grants" frame="box" rules="all">
    <thead>
        <tr>
            <th style="white-space:nowrap;">Title</th>
            <th style="white-space:nowrap;">Excluded&nbsp;<span class="tooltip" title="If a Grant is marked as excluded, it will NOT show up in your profile or Annual Report.">&#9432;</span></th>
            <th style="white-space:nowrap;">PI</th>
            <th style="white-space:nowrap;">Co-PI</th>
            <th style="white-space:nowrap;">Sponsor</th>
            <th style="white-space:nowrap;">Start Date</th>
            <th style="white-space:nowrap;">End Date</th>
            <th style="white-space:nowrap;">Total ($)</th>
            <th style="white-space:nowrap;">My Portion ($)</th>
        </tr>
    </thead>
    <tbody>
        <% this.model.each(function(grant){ %>
            <% var ar = (grant.get('start_date') >= START && grant.get('end_date') <= END && grant.get('end_date') >= START ||
                         grant.get('start_date') <= START && grant.get('end_date') >= START ||
                         grant.get('start_date') <= END && grant.get('end_date') >= END ||
                         grant.get('start_date') <= END && grant.get('end_date') == "0000-00-00");
            %>
            <tr class="<% if(ar){ %>ar<% } %>">
                <td>
                    <% if(grant.get('scientific_title').trim() != ''){ %>
                        <a href="<%= grant.get('url') %>"><%= grant.get('scientific_title') %></a>
                    <% } else { %>
                        <a href="<%= grant.get('url') %>">(Missing Title)</a>
                    <% } %>
                    <div style="width:100%;max-height:100px;overflow-y:auto;"><%= grant.get('description') %></div>
                </td>
                <td align="center">
                    <% if(grant.get('exclude')){ %>Yes<% } %>
                </td>
                <td>
                    <% if(grant.get('pi').id != 0){ %>
                        <%= grant.get('pi').reversedName %>
                    <% } %>
                    <% if(grant.get('external_pi') != ""){ %>
                        <%= grant.get('external_pi') %>
                    <% } %>
                </td>
                <td><div style="width:100%;max-height:118px;overflow-y:auto;"><%= grant.get('copi_string') %></div></td>
                <td><div style="width:100%;max-height:118px;overflow-y:auto;"><%= grant.get('sponsor') %></div></td>
                <td><%= grant.get('start_date') %></td>
                <td><%= grant.get('end_date') %></td>
                <td align="right"><%= number_format(grant.get('total')) %></td>
                <td align="right"><%= number_format(grant.get('myportion')) %></td>
            </tr>
        <% }) %>
    </tbody>
</table>
