<td><%= task %></td>
<td><%= taskType %></td>
<td>
    <% 
    var assigneesList = this.model.get('assignees') || [];
    var isEveryoneAssigned = _.some(assigneesList, function(a) { return a.id === -1; });

    if (isEveryoneAssigned) { %>
        <div>Everyone</div>
    <% } else {
        if (assigneesList.length > 0) {
            assigneesList.forEach(function(assignee) { %>
                <div><a href="<%= assignee.url %>"><%= assignee.name %></a></div>
            <% });
        } else { %>
            <div>No Assignees</div>
        <% }
    } %>
</td>
<td style="text-align: center;"><%= dueDate %></td>
<td style="text-align: center; white-space:nowrap; padding: 5px;">
    <% 
    if (isLeaderAllowedToEdit) { %>
        <%
            var allStatuses = this.model.get('statuses') || {};
            var allAssignees = this.model.get('assignees') || [];
            var isFullyCompleted = false;
            if (allAssignees.length > 0) {
                isFullyCompleted = _.every(allAssignees, function(assignee) {
                    var assigneeId = assignee.id || assignee;
                    return allStatuses[assigneeId] === 'Closed';
                });
            }
        %>
        <% if (isFullyCompleted) { %>
            <div style="color: #28a745; font-weight: bold;">
                Completed
            </div>
            <button id="checkStatus" type="button" class="btn btn-primary btn-xs">Check Status</button>
        <% } else { %>
            <div style="font-size: 12px; line-height: 1.6; margin-bottom: 5px; text-align: left;">
                <div style="display: flex; align-items: center; white-space: nowrap;">
                    <span style="width: 10px; height: 10px; background-color: #28a745; border-radius: 50%; margin-right: 6px;"></span>
                    <strong style="margin-right: 4px;"><%= displayClosedCount %></strong> Completed
                </div>
                <div style="display: flex; align-items: center; white-space: nowrap;">
                    <span style="width: 10px; height: 10px; background-color: #FF8C00; border-radius: 50%; margin-right: 6px;"></span>
                    <strong style="margin-right: 4px;"><%= displayPendingReviewCount %></strong> Pending Review
                </div>
                <div style="display: flex; align-items: center; white-space: nowrap;">
                    <span style="width: 10px; height: 10px; background-color: #007bff; border-radius: 50%; margin-right: 6px;"></span>
                    <strong style="margin-right: 4px;"><%= displayAssignedCount %></strong> Assigned
                </div>
            </div>
            <button id="checkStatus" type="button" class="btn btn-primary btn-xs">Check Status</button>
        <% } %>

    <% } else if (isCurrentUserAssignee || isCurrentUserReviewer) { %>
        
        <%
            var statuses = this.model.get('statuses') || {};
            var currentUserId = me.get('id');
            var assignees = this.model.get('assignees') || [];
            var reviewers = this.model.get('reviewers') || {};
            var myStatus = null;

            if (statuses[currentUserId]) {
                myStatus = statuses[currentUserId];
            } 
            else {
                var isAssignedToEveryone = _.some(assignees, function(a) { return a.id === -1; });
                if (isAssignedToEveryone) {
                    myStatus = statuses['-1'];
                }
            }

            if (myStatus === null) {
                var reviewedAssigneeId = _.findKey(reviewers, function(reviewer) {
                    return reviewer && reviewer.id == currentUserId;
                });
                if (reviewedAssigneeId) {
                    myStatus = statuses[reviewedAssigneeId];
                }
            }

            if (myStatus === null) {
                myStatus = 'Assigned';
            }
            if (myStatus === 'Closed') { 
        %>
            <div style="color: #28a745; font-weight: bold;">
                Completed
            </div>
        <% } else if (myStatus === 'Done') { %>
            <div style="color: #FF8C00; font-weight: bold; margin-bottom: 4px;">
                Pending Review
            </div>
            <button id="checkStatus" type="button" class="btn btn-primary btn-xs">Check Status</button>
        <% } else { %>
            <div style="color: red; font-weight: bold; margin-bottom: 4px;">
                Pending
            </div>
            <button id="checkStatus" type="button" class="btn btn-primary btn-xs">Check Status</button>
        <% } %>
    <% } %>
</td>
<td>
    <%= details %>
</td>