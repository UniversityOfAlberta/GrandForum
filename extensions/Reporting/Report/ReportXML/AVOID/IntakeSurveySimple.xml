<?xml version="1.0" encoding="UTF-8" ?>
<Report name="Intake Form" reportType="RP_AVOID_SIMPLE" ajax="true" disabled="false">
    <Permissions>
        <Role role="INACTIVE+">
            <SectionPermission id="demographic" permissions="rw" />
            <SectionPermission id="nutrition1" permissions="rw" />
            <SectionPermission id="nutrition2" permissions="rw" />
            <SectionPermission id="submit" permissions="rw" />
        </Role>
    </Permissions>
    
    <Script>
        <![CDATA[
            <style>
                .requiredField {
                    padding: 5px;
                    margin-left: -5px;
                }
                
                .requiredFieldIncomplete {
                    background: #fdeeb2;
                }
            </style>
            <script type="text/javascript">
                
                setInterval(function(){
                    $("input, textarea, select", $(".requiredField")).each(function(i, el){
                        var requiredField = $(el).closest(".requiredField");
                        var name = $(el).attr('name');
                        var type = $(el).attr('type');
                        var tag = $(el).prop("tagName").toLowerCase();
                        if(type == "text" || type == "range" || tag == "textarea"){
                            if($(el).val() == ""){
                                requiredField.addClass("requiredFieldIncomplete");
                            }
                            else{
                                requiredField.removeClass("requiredFieldIncomplete");
                            }
                        }
                        else if(type == "radio" || type == "checkbox"){
                            if($("input[name='" + name + "']:checked").length == 0){
                                requiredField.addClass("requiredFieldIncomplete");
                            }
                            else{
                                requiredField.removeClass("requiredFieldIncomplete");
                            }
                        }
                        else if(tag == "select"){
                            if($("option:selected", el).val() == ""){
                                requiredField.addClass("requiredFieldIncomplete");
                            }
                            else{
                                requiredField.removeClass("requiredFieldIncomplete");
                            }
                        }
                    });
                    if($("#reportWarning").length == 0){
                        $("#reportFooter").prepend("<div id='reportWarning' style='display:none;margin:0;' class='warning'>" +
                                                        "You have not yet completed all of the questions." + 
                                                   "</div>");
                    }
                    if($(".selectedReportTab").text() != showLanguage(wgLang, "Consent", "Consentement")){
                        if($(".requiredFieldIncomplete:visible").length > 0){
                            $("button[type=submit]").hide();
                            $("#reportWarning").show();
                            $(".reportTab:not(.selectedReportTab)").addClass("disabled_lnk");
                        }
                        else{
                            $("button[type=submit]").show();
                            $("#reportWarning").hide();
                            $(".reportTab:not(.selectedReportTab)").removeClass("disabled_lnk");
                        }
                    }
                }, 250);
            </script>
        ]]>
    </Script>
    <ReportSection id="demographics" blobSection="AVOID_Demographics" type="NextPrevReportSection" pagebreak="false"
                   postId="Demographics" 
                   tooltip="Participant Demographic Questionnaire" 
                   name="Demographics" 
                   title="Participant Demographic Questionnaire">
        <!-- Gender -->
        <ReportItem id="socio_info2" type="RadioReportItem" blobItem="avoid_gender" 
                    options="Man|Woman|Nonbinary|Prefer to self describe myself">
            <![CDATA[
                <h3>What is your gender?</h3>
                <p><i>Gender refers to social roles and expectations, behaviors, expressions, and identities of girls, women, boys, men, and gender-diverse people.</i></p>
                <div class="requiredField">{$item}</div>
            ]]>
        </ReportItem>
        <ReportItem id="specify_socio_info2" type="Text" blobItem="GENDERSPECIFY" width="400px" optional="true">
            <![CDATA[
                <span id='specifygender'>
                    Please Specify
                    {$item}
                </span>
            ]]>
        </ReportItem>
        <Static>
            <![CDATA[
                <script type='text/javascript'>
                    $('span#specifygender').hide();
                    function specifyGender(){
                        if($("input:radio[value='Prefer to self describe myself']").is(':checked')){
                            $('span#specifygender').show();
                        }
                        else{ 
                            $('span#specifygender').hide(); 
                        }
                    }
                    _.defer(specifyGender);
                    $("input:radio[name='Demographics_socio_info2']").change(specifyGender);
                </script>
            ]]>
        </Static>
        
        <!-- Age -->
        <ReportItem id="socio_info1" type="SelectReportItem" blobItem="avoid_age" 
                    options="less than 60|60|61|62|63|64|65|66|67|68|69|70|71|72|73|74|75|76|77|78|79|80|81|82|83|84|85|86|87|88|89|90|91|92|93|94|95|96|97|98|99|100|101|102|103|104|105">
            <![CDATA[
                <h3>
                    What is your age?
                </h3>
                <div class="requiredField">{$item}</div>
            ]]>
        </ReportItem>
        
        <!-- Postal Code -->
        <ReportItem id="postalcode" type="Text" blobItem="POSTAL" width="45px" max_length="3">
            <![CDATA[
                <h3>What are the first three digits of your postal code (e.g. K7P)?</h3>
                <div class="requiredField">{$item} <span id="postalCodeError" class="inlineError" style="display:none;">This is not a valid postal code.</span></div>
                <script type="text/javascript">
                    $('[name=Demographics_postalcode]').on('input', function(){
                        $(this).val($(this).val().toUpperCase());
                        var val = $(this).val();
                        var matches = val.match(/[ABCEGHJKLMNPRSTVXY][0-9][ABCEGHJKLMNPRSTVWXYZ]|CFN/);
                        if(_.size(matches) != 1){
                            $('#postalCodeError').show();
                        }
                        else{
                            $('#postalCodeError').hide();
                        }
                    });
                    $('[name=Demographics_postalcode]').change(function(){
                        var val = $(this).val();
                        var matches = val.match(/[ABCEGHJKLMNPRSTVXY][0-9][ABCEGHJKLMNPRSTVWXYZ]|CFN/);
                        if(_.size(matches) != 1){
                            $(this).val('');
                        }
                    });
                </script>
            ]]>
        </ReportItem>
        
        <!-- Sexuality -->
        <ReportItem id="socio_info3" type="RadioReportItem" blobItem="avoid_sex" 
                    options="Straight or Heterosexual|Gay or Lesbian|Bisexual|Other sexual orientation">
            <![CDATA[
                <h3>Which of the following best describes your sexual orientation?</h3>
                <div class="requiredField">{$item}</div>
            ]]>
        </ReportItem>
        <ReportItem id="specify_socio_info3" type="Text" blobItem="SEXSPECIFY" width="400px" optional="true">
            <![CDATA[
                <span id='specifysex'>
                    Please Specify
                    {$item}
                </span>
            ]]>
        </ReportItem>
        <Static>
            <![CDATA[
                <script type='text/javascript'>
                    $('span#specifysex').hide();
                    function specifySex(){
                        if($("input:radio[value='Other sexual orientation']").is(':checked')){
                            $('span#specifysex').show();
                        }
                        else{ 
                            $('span#specifysex').hide(); 
                        }
                    }
                    _.defer(specifySex);
                    $("input:radio[name='Demographics_socio_info3']").change(specifySex);
                </script>
            ]]>
        </Static>
        
        <!-- Ethnicity -->
        <ReportItem id="ethnicity_avoid" type="CheckboxReportItem" blobType="BLOB_ARRAY" blobItem="ethnicity_avoid" orientation="vertical" optional="true" 
                    options="Black|East Asian|Indigenous (First Nations, Inuk/Inuit, MÃ©tis)|Latin American|Middle Eastern|South Asian|Southeast Asian|White|Another race category|I don't know|Prefer not to answer|I prefer not to answer">
            <![CDATA[
                <p style='margin-top:2em; margin-bottom:-1em;'>In our society, people are often described by their race or racial background. These are not based in science, but our race may influence the way we are treated by individuals and institutions, and this may affect our health.</p>
                <h3>Which category(ies) best describes you? Check all that apply: </h3>
                <div class="requiredField">{$item}</div>
            ]]>
        </ReportItem>
        
        <!-- Indigenous -->
        <ReportItem id="ethnicity_indigenous" type="CheckboxReportItem" blobType="BLOB_ARRAY" blobItem="ethnicity_avoid2" orientation="vertical" optional="true"
                    options="Yes, First Nations|Yes, Inuk/Inuit|Yes, MÃ©tis|No|I don't know|I prefer not to answer">
            <![CDATA[
                <h3>Do you identify as First Nations, Inuk/Inuit, and/or MÃ©tis? Check all that apply:</h3>
                {$item}
            ]]>
        </ReportItem>
    </ReportSection>
    
    <ReportSection id="submit" type="EditableReportSection" blobSection="SUBMIT" 
                   postId="Submit"
                   name="{showLanguage(Submit, Soumettre)}">
        <If if="{and({==({getProgress(demographics)},100)}
                )}">
            <ReportItem id="submitted" type="TextReportItem" blobItem="SUBMITTED">
                <![CDATA[
                    <div id='submitDiv' style='display:none;'>{$item}</div>
                ]]>
            </ReportItem>
            <Static>
                <![CDATA[
                    <div>Submitting will mark your survey as 'complete' and will prevent you from editing in the future.</div><br />
                    <a class='button' id='submit_review'>Submit</a>
                    <script type='text/javascript'>
                        $('#reportFooter').prev().hide();
                        $('#reportFooter').hide();
                        $('#submit_review').click(function(){
                            $('#submitDiv input[type=text]').val('Submitted');
                            saveAll(function(){
                                window.location.href = wgServer + wgScriptPath + "/index.php/Special:AVOIDDashboard";
                            });
                        });
                    </script>
                ]]>
            </Static>
        </If>
        <Else>
            <![CDATA[
                You must complete all of the questions in the survey.
            ]]>
        </Else>
    </ReportSection>
</Report>
