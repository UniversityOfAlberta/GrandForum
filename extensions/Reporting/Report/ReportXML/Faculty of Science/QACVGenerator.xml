<?xml version="1.0" encoding="UTF-8" ?>
<Report name=" " title=" " headerName=" " reportType="RP_QA2" pdfType="RPTP_QA2" pdfFiles="QACVPDF" ajax="true">
    <Permissions>
        <Role role="DEAN">
            <SectionPermission id="fec_table" permissions="rw" />
            <SectionPermission id="ats_table" permissions="rw" />
        </Role>
        <Role role="VDEAN">
            <SectionPermission id="fec_table" permissions="rw" />
            <SectionPermission id="ats_table" permissions="rw" />
        </Role>
        <Role role="HR">
            <SectionPermission id="fec_table" permissions="rw" />
            <SectionPermission id="ats_table" permissions="rw" />
        </Role>
        <Role role="MANAGER+">
            <SectionPermission id="fec_table" permissions="rw" />
            <SectionPermission id="ats_table" permissions="rw" />
        </Role>
    </Permissions>
    <ReportSection id="fec_table" name="FEC QACV Table" title="FEC QACV Table" type="ReportSection" renderpdf="false">
        <Static>
            <![CDATA[
                <iframe id='downloadFrame' name='downloadFrame' src="" style="display:none;"></iframe>
                <div style='float:right; margin-top: -45px;display:flex;'>
                    <div><button id='generateAll' type='button'>Generate All QACVs</button></div>
                    <div><button id='downloadAll' class='noDisable' type='button'>Download All QACVs</button></div>
                </div>
                <script type='text/javascript'>
                    function postToIframe(data,url,target){
                        $('body').append('<form action="'+url+'" method="post" target="'+target+'" id="postToIframe"></form>');
                        $.each(data,function(n,v){
                            $('#postToIframe').append('<input type="hidden" name="'+n+'" value="'+v+'" />');
                        });
                        $('#postToIframe').submit().remove();
                    }
                    $('#generateAll').click(function(){
                        $('.generateButton').click();
                    });
                    $('#downloadAll').click(function(){
                        var pdfs = $.makeArray($(".profilePDF:visible").map(function(i, pdf){ return $(pdf).attr('href');})).join(',').replaceAll(wgServer + wgScriptPath + '/index.php/Special:ReportArchive?getpdf=', '');
                        postToIframe({pdfs: pdfs}, wgServer + wgScriptPath + '/index.php?action=downloadReportZip', 'downloadFrame');
                    });
                </script>
                <table id='profileTable' class='wikitable' frame='box' rules='all'>
                    <thead>
                        <tr>
                            <th>Case#</th>
                            <th>Name</th>
                            <th>Department</th>
                            <th>Rank</th>
                            <th>PDF</th>
                            <th style='width: 12em;'>Generate</th>
                    </thead>
                    <tbody>
            ]]>
        </Static>
        <ReportItemSet id="faculty" type="FacultyPeopleReportItemSet" start="{$last_year}-07-01" end="{$this_year}-07-01">
            <Static>
                <![CDATA[
                    <tr data-fecid="{getExtra()}">
                        <td>{getExtra()}</td>
                        <td><a href="{$user_url}" target="_blank">{$user_name}</a></td>
                        <td>{$user_dept}</td>
                        <td>{$user_level}</td>
                ]]>
            </Static>
            <ReportItem id="profile" type="PDFReportItem" class="profilePDF downloadButton{$user_id}" reportType="QACVPDF" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                <![CDATA[
                        <td align='center'>
                            {$item}
                        </td>
                        <td style='white-space:nowrap;' align='center'>
                ]]>
            </ReportItem>
            <ReportItem id="submit" type="SimpleReviewSubmit" userId="{$user_id}" onlyGenerate="true" specialDownload=".downloadButton{$user_id}" />
            <Static>
                <![CDATA[
                        </td>
                    </tr>
                ]]>
            </Static>
        </ReportItemSet>
        <Static>
            <![CDATA[
                    </tbody>
                </table>
                <script type="text/javascript">
                    $('#profileTable').dataTable({
                        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                        "iDisplayLength": -1
                    });
                </script>
            ]]>
        </Static>
    </ReportSection>
    <ReportSection id="ats_table" name="ATS QACV Table" title="ATS QACV Table" type="ReportSection" renderpdf="false">
        <Static>
            <![CDATA[
                <iframe id='downloadFrame' name='downloadFrame' src="" style="display:none;"></iframe>
                <div style='float:right; margin-top: -45px;display:flex;'>
                    <div><button id='generateAll' type='button'>Generate All QACVs</button></div>
                    <div><button id='downloadAll' class='noDisable' type='button'>Download All QACVs</button></div>
                </div>
                <script type='text/javascript'>
                    function postToIframe(data,url,target){
                        $('body').append('<form action="'+url+'" method="post" target="'+target+'" id="postToIframe"></form>');
                        $.each(data,function(n,v){
                            $('#postToIframe').append('<input type="hidden" name="'+n+'" value="'+v+'" />');
                        });
                        $('#postToIframe').submit().remove();
                    }
                    $('#generateAll').click(function(){
                        $('.generateButton').click();
                    });
                    $('#downloadAll').click(function(){
                        var pdfs = $.makeArray($(".profilePDF:visible").map(function(i, pdf){ return $(pdf).attr('href');})).join(',').replaceAll(wgServer + wgScriptPath + '/index.php/Special:ReportArchive?getpdf=', '');
                        postToIframe({pdfs: pdfs}, wgServer + wgScriptPath + '/index.php?action=downloadReportZip', 'downloadFrame');
                    });
                </script>
                <table id='profileTable' class='wikitable' frame='box' rules='all'>
                    <thead>
                        <tr>
                            <th>Case#</th>
                            <th>Name</th>
                            <th>Department</th>
                            <th>Rank</th>
                            <th>PDF</th>
                            <th style='width: 12em;'>Generate</th>
                    </thead>
                    <tbody>
            ]]>
        </Static>
        <ReportItemSet id="faculty" type="FacultyPeopleReportItemSet" atsec="true" start="{$last_year}-07-01" end="{$this_year}-07-01">
            <Static>
                <![CDATA[
                    <tr data-fecid="{getExtra()}">
                        <td>{getExtra()}</td>
                        <td><a href="{$user_url}" target="_blank">{$user_name}</a></td>
                        <td>{$user_dept}</td>
                        <td>{$user_level}</td>
                ]]>
            </Static>
            <ReportItem id="profile" type="PDFReportItem" class="profilePDF downloadButton{$user_id}" reportType="QACVPDF" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                <![CDATA[
                        <td align='center'>
                            {$item}
                        </td>
                        <td style='white-space:nowrap;' align='center'>
                ]]>
            </ReportItem>
            <ReportItem id="submit" type="SimpleReviewSubmit" userId="{$user_id}" onlyGenerate="true" specialDownload=".downloadButton{$user_id}" />
            <Static>
                <![CDATA[
                        </td>
                    </tr>
                ]]>
            </Static>
        </ReportItemSet>
        <Static>
            <![CDATA[
                    </tbody>
                </table>
                <script type="text/javascript">
                    $('#profileTable').dataTable({
                        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                        "iDisplayLength": -1
                    });
                </script>
            ]]>
        </Static>
    </ReportSection>
</Report>
