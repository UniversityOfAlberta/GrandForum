<?xml version="1.0" encoding="UTF-8" ?>
<Report name=" " title=" " headerName=" " reportType="RP_PROFILE" pdfType="RP_PROFILE" pdfFiles="Profile" ajax="true" personId="{GET(userId, {$my_id})}">
    <Permissions>
        <Role role="DEAN">
            <SectionPermission id="table" permissions="rw" />
            <SectionPermission id="profile" permissions="rw" />
        </Role>
        <Role role="VDEAN">
            <SectionPermission id="table" permissions="rw" />
            <SectionPermission id="profile" permissions="rw" />
        </Role>
        <Role role="HR">
            <SectionPermission id="table" permissions="rw" />
            <SectionPermission id="profile" permissions="rw" />
        </Role>
        <Role role="MANAGER+">
            <SectionPermission id="table" permissions="rw" />
            <SectionPermission id="profile" permissions="rw" />
        </Role>
    </Permissions>
    <ReportSection id="table" name="Profiles Table" title="Profiles Table" type="ReportSection" renderpdf="false">
        <Static>
            <![CDATA[
                <iframe id='downloadFrame' name='downloadFrame' src="" style="display:none;"></iframe>
                <div style='float:right; margin-top: -45px;display:flex;'>
                    <div><button id='generateAll' type='button'>Generate All Profiles</button></div>
                    <div><button id='downloadAll' class='noDisable' type='button'>Download All Profiles</button></div>
                </div>
                <script type='text/javascript'>
                    function postToIframe(data,url,target){
                        $('body').append('<form action="'+url+'" method="post" target="'+target+'" id="postToIframe"></form>');
                        $.each(data,function(n,v){
                            $('#postToIframe').append('<input type="hidden" name="'+n+'" value="'+v+'" />');
                        });
                        $('#postToIframe').submit().remove();
                    }
                    $('#generateAll').click(function(){
                        $('.generateButton').click();
                    });
                    $('#downloadAll').click(function(){
                        var pdfs = $.makeArray($(".profilePDF:visible").map(function(i, pdf){ return $(pdf).attr('href');})).join(',').replaceAll(wgServer + wgScriptPath + '/index.php/Special:ReportArchive?getpdf=', '');
                        postToIframe({pdfs: pdfs}, wgServer + wgScriptPath + '/index.php?action=downloadReportZip', 'downloadFrame');
                    });
                </script>
                <table id='profileTable' class='wikitable' frame='box' rules='all'>
                    <thead>
                        <tr>
                            <th>Case#</th>
                            <th>Name</th>
                            <th>Department</th>
                            <th>Rank</th>
                            <th>PDF</th>
                            <th style='width: 12em;'>Generate</th>
                    </thead>
                    <tbody>
            ]]>
        </Static>
        <ReportItemSet id="faculty" type="FacultyPeopleReportItemSet" start="{$last_year}-07-01" end="{$this_year}-07-01">
            <Static>
                <![CDATA[
                    <tr data-fecid="{getExtra()}">
                        <td>{getExtra()}</td>
                        <td><a href="{$user_url}" target="_blank">{$user_name}</a></td>
                        <td>{$user_dept}</td>
                        <td>{$user_level}</td>
                ]]>
            </Static>
            <ReportItem id="profile" type="PDFReportItem" class="profilePDF downloadButton{$user_id}" reportType="Profile" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                <![CDATA[
                        <td align='center'>
                            {$item}
                        </td>
                        <td style='white-space:nowrap;' align='center'>
                ]]>
            </ReportItem>
            <ReportItem id="submit" type="SimpleReviewSubmit" userId="{$user_id}" onlyGenerate="true" specialDownload=".downloadButton{$user_id}" />
            <Static>
                <![CDATA[
                        </td>
                    </tr>
                ]]>
            </Static>
        </ReportItemSet>
        <Static>
            <![CDATA[
                    </tbody>
                </table>
                <script type="text/javascript">
                    $('#profileTable').dataTable({
                        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                        "iDisplayLength": -1
                    });
                </script>
            ]]>
        </Static>
    </ReportSection>
    <ReportSection id="profile" tooltip="Profile" name="Faculty Profile" title="Faculty Profile" blobSection="PROFILE" type="HeaderReportSection" pagebreak="false">
        <Static>
            <![CDATA[
                {$user_id}
                <div id='profile' style='font-size: 1.25em;'>
                <table cellpadding='0' cellspacing='0' style='margin-top: -1em;'>
                    <tr>
                        <td valign='top'>
                            <div class='previewnodisplay'><img src='{replace({$wgServer}{$wgScriptPath}/,,{$user_photo})}' style='height: 9em;' /></div>
                            <div class='generatenodisplay'><img src='{$user_photo}' style='height: 9em;' /></div>
                        </td>
                        <td valign='top' style='width: 100%; padding-left: 1em;'>
                            <b>{$user_name}</b><br />
                            {$user_level}, {$user_dept}<br />
                            <a href='mailto:{$user_email}' class='externalLink'>{$user_email}</a>
                        
            ]]>
        </Static>
        <If if="{!=({$user_website},http://)}">
            <![CDATA[
                            , <a href='{$user_website}'>{$user_website}</a>
            ]]>
        </If>
        <Static>
            <![CDATA[
                            <br /><a href='{$user_ldap}' class='externalLink'>{$user_ldap}</a><br />
            ]]>
        </Static>
        <If if="{!=({$user_keywords},)}">
            <![CDATA[
                <br />
                <b>Keywords:</b> {$user_keywords}
            ]]>
        </If>
        <Static>
            <![CDATA[
                        </td>
                    </tr>
                </table>
                <div style='margin-top: 1em;max-height: 12em; overflow: hidden;'>{$user_profile}</div>
                <br />
                <b>PhD:</b>&nbsp;
                
            ]]>
        </Static>
        <If if="{!=({$user_phd_uni},)}">
            <![CDATA[
                {$user_phd_uni},&nbsp;
            ]]>
        </If>
        <Static>
            <![CDATA[
                {$user_phd_year}<br />
                <br />
            ]]>
        </Static>
        <ReportItem id="employment" type="PersonEmployment2ReportItem">
            <![CDATA[
                <b>Employment History</b>
                {$item}
            ]]>
        </ReportItem>
        <Static>
            <![CDATA[
                <br />
                <b>Select Research Outcomes</b>
                <ol style='padding-left: 1.5em;'>
            ]]>
        </Static>
        <ReportItemSet id="products" type="PersonTopProductsReportItemSet">
            <Static>
                <![CDATA[
                    <li>{$product_citation}</li>
                ]]>
            </Static>
        </ReportItemSet>
        <Static>
            <![CDATA[
                </ol>
                </div>
            ]]>
        </Static>
    </ReportSection>
</Report>
