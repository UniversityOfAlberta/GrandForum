<?xml version="1.0" encoding="UTF-8" ?>
<Report name="FEC Table" title="FEC Table" reportType="RP_FEC_TABLE" ajax="true" disabled="false">
    <Permissions>
        <Role role="INACTIVE+" subRole="FEC">
            <SectionPermission id="fec" permissions="rw" />
            <SectionPermission id="fec_votes" permissions="" />
            <SectionPermission id="atsec" permissions="" />
        </Role>
        <!--Role role="INACTIVE+" subRole="ATSEC">
            <SectionPermission id="fec" permissions="" />
            <SectionPermission id="fec_votes" permissions="" />
            <SectionPermission id="atsec" permissions="rw" />
        </Role -->
        <Role role="DEAN" start="{$this_year}-07-01" end="{$next_year}-07-01">
            <SectionPermission id="fec" permissions="rw" />
            <SectionPermission id="fec_votes" permissions="rw" />
            <SectionPermission id="atsec" permissions="rw" />
        </Role>
        <Role role="VDEAN" start="{$this_year}-07-01" end="{$next_year}-07-01">
            <SectionPermission id="fec" permissions="rw" />
            <SectionPermission id="fec_votes" permissions="rw" />
            <SectionPermission id="atsec" permissions="rw" />
        </Role>
        <Role role="HR" start="{$this_year}-07-01" end="{$next_year}-07-01">
            <SectionPermission id="fec" permissions="rw" />
            <SectionPermission id="fec_votes" permissions="" />
            <SectionPermission id="atsec" permissions="rw" />
        </Role>
        <Role role="MANAGER+" start="{$this_year}-07-01" end="{$next_year}-07-01">
            <SectionPermission id="fec" permissions="rw" />
            <SectionPermission id="fec_votes" permissions="" />
            <SectionPermission id="atsec" permissions="rw" />
        </Role>
    </Permissions>
    <ReportSection id="fec" tooltip="FEC Table" name="FEC Table" title="FEC Table" blobSection="TABLE" type="EditableReportSection">
        <Static>
            <![CDATA[
                {set(sumFaculty, 0)}
                {set(sumFSO, 0)}
                {set(nFaculty, 0)}
                {set(nFSO, 0)}
                <style>
                    table#chairTable * {
                        font-size:11px !important;
                    }
                </style>
                <table id='chairTable' class='wikitable' frame='box' rules='all'>
                    <thead>
                        <tr>
                            <th width="1%">Case#</th>
                            <th>Name</th>
                            <th>Rank</th>
                            <th>Department</th>
                            <th width="1%">Annual Report</th>
                            <th>Evaluation</th>
                            <th>Increment</th>
                            <th>Revised Increment</th>
                            <th>Increment Vote <span class='tooltip' title='Votes will be visible to the FEC Chair'>&#9432;</span></th>
                            <th>Tenure Vote <span class='tooltip' title='Votes will be visible to the FEC Chair'>&#9432;</span></th>
                            <th>Promotion Vote <span class='tooltip' title='Votes will be visible to the FEC Chair'>&#9432;</span></th>
                            <th>Comments <span class='tooltip' title='Comments will be visible to the FEC Chair'>&#9432;</span></th>
                        </tr>
                    </thead>
                    <tbody>
            ]]>
        </Static>
        <ReportItemSet id="faculty" type="FacultyPeopleReportItemSet" start="{$last_year}-07-01" end="{$this_year}-07-01">
            <Static>
                <![CDATA[
                    <tr>
                        <td style='white-space:nowrap;'>{getExtra()}</td>
                        <td><a href="{$user_url}" target="_blank">{$user_name}</a></td>
                        <td>{$user_level}</td>
                        <td>{$user_dept}</td>
                ]]>
            </Static>
            <ReportItem id="download" type="PDFReportItem" reportType="FECpdf" class="" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                <![CDATA[
                        <td align='center'>{$item}</td>
                        <td align='center'>
                ]]>
            </ReportItem>
            <ReportItem id="recommendation" type="PDFReportItem" reportType="ChairTable" section="Recommendations" noRenderIfNull="true" class="" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                <![CDATA[
                        {$item} Recommendation<br />
                ]]>
            </ReportItem>
            <If if="{or({contains({$my_roles},ADMIN)},
                        {contains({$my_roles},DEAN)},
                        {contains({$my_roles},VDEAN)},
                        {contains({$my_roles},HR)})}">
                <ReportItem id="da" type="PDFReportItem" reportType="ChairTable" section="Dean Advice" noRenderIfNull="true" class="" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                    <![CDATA[
                            {$item} Dean's Advice<br />
                    ]]>
                </ReportItem>
                <ReportItem id="dd" type="PDFReportItem" reportType="ChairTable" section="Dean Decision" noRenderIfNull="true" class="" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                    <![CDATA[
                            {$item} Dean's Decision<br />
                    ]]>
                </ReportItem>
            </If>
            <If if="{or({contains({getExtra()}, A)},
                        {contains({getExtra()}, B)},
                        {contains({getExtra()}, C)},
                        {contains({getExtra()}, N)}
                    )}">
                <If if="{and({!=(,{getText(RP_CHAIR, FEC_REVIEW, INCREMENT, {$user_id}, 0, 0)})},
                             {!=(N/A,{getText(RP_CHAIR, FEC_REVIEW, INCREMENT, {$user_id}, 0, 0)})},
                             {!=(0.00,{getText(RP_CHAIR, FEC_REVIEW, INCREMENT, {$user_id}, 0, 0)})},
                             {!=(0A,{getText(RP_CHAIR, FEC_REVIEW, INCREMENT, {$user_id}, 0, 0)})},
                             {!contains({$my_roles},Chair)}
                        )}">
                    <![CDATA[
                        {set(sumFaculty, {add({get(sumFaculty)}, {getNumber(RP_CHAIR, FEC_REVIEW, INCREMENT, {$user_id}, 0, 0)})})}
                        {set(nFaculty, {add({get(nFaculty)}, 1)})}
                    ]]>
                </If>
            </If>
            <If if="{or({contains({getExtra()}, D)},
                        {contains({getExtra()}, E)},
                        {contains({getExtra()}, F)},
                        {contains({getExtra()}, M)}
                    )}">
                <If if="{and({!=(,{getText(RP_CHAIR, FEC_REVIEW, INCREMENT, {$user_id}, 0, 0)})},
                             {!=(N/A,{getText(RP_CHAIR, FEC_REVIEW, INCREMENT, {$user_id}, 0, 0)})},
                             {!=(0.00,{getText(RP_CHAIR, FEC_REVIEW, INCREMENT, {$user_id}, 0, 0)})},
                             {!=(0A,{getText(RP_CHAIR, FEC_REVIEW, INCREMENT, {$user_id}, 0, 0)})},
                             {!contains({$my_roles},Chair)}
                        )}">
                    <![CDATA[
                        {set(sumFSO, {add({get(sumFSO)}, {getNumber(RP_CHAIR, FEC_REVIEW, INCREMENT, {$user_id}, 0, 0)})})}
                        {set(nFSO, {add({get(nFSO)}, 1)})}
                    ]]>
                </If>
            </If>
            <Static>
                <![CDATA[
                        </td>
                        <td>
                            {getText(RP_CHAIR, FEC_REVIEW, INCREMENT, {$user_id}, 0, 0)}
                        </td>
                        <td>
                            {getText(RP_FEC_TABLE, TABLE, INCREMENT, {$user_id}, 1, 0)}
                        </td>
                ]]>
            </Static>
            <If if="{contains({$my_roles},ViceDean)}">
                <!-- Increment Vote -->
                <ReportItem id="vote" type="Select" blobType="BLOB_TEXT" blobItem="VOTE" blobSubItem="{$user_id}" options="|Yes|No|Abstain" width="80px">
                    <![CDATA[
                        <td>{$value}</td>
                    ]]>
                </ReportItem>
                <!-- Tenure Vote -->
                <If if="{!=({getText(RP_FEC_TABLE, TABLE, T_FREEZE, {$parent_id}, 1, 0)},Frozen)}">
                    <ReportItem id="t_vote" type="Select" blobType="BLOB_TEXT" blobItem="T_VOTE" blobSubItem="{$user_id}" options="|Yes|No|Abstain" width="80px">
                        <![CDATA[
                            <td>
                                <span id='t_vote_{$user_id}'>{$item}</span>
                                <script type='text/javascript'>
                                    var tenure = "{getText(RP_CHAIR, FEC_REVIEW, TENURE, {$user_id}, 0, 0)}";
                                    if(tenure != "i recommend that an appointment with tenure be offered" &&
                                       tenure != "i recommend tenure as per clause 12.17 (special recommendation for tenure)"){
                                        $("#t_vote_{$user_id}").remove();
                                    }
                                </script>
                            </td>
                        ]]>
                    </ReportItem>
                </If>
                <Else>
                    <![CDATA[
                        <td>{getText(RP_FEC_TABLE, TABLE, T_VOTE, {$user_id}, {$my_id}, 0)}</td>
                    ]]>
                </Else>
                <!-- Promotion Vote -->
                <ReportItem id="p_vote" type="Select" blobType="BLOB_TEXT" blobItem="P_VOTE" blobSubItem="{$user_id}" options="|Yes|No|Abstain" width="80px">
                    <![CDATA[
                        <td>{$value}</td>
                        <td>
                    ]]>
                </ReportItem>
                <ReportItemSet id="fec_comments" type="FECReportItemSet">
                    <Static>
                        <![CDATA[
                            {set(comment, {getText(RP_FEC_TABLE, TABLE, COMMENTS, {$parent_id}, {$user_id}, 0)})}
                        ]]>
                    </Static>
                    <If id="comment_if" if="{!=({get(comment)},)}">
                        <![CDATA[
                            <b>{$user_name}:</b> {get(comment)}
                            <hr />
                        ]]>
                    </If>
                </ReportItemSet>
                <Static>
                    <![CDATA[
                        </td>
                    ]]>
                </Static>
            </If>
            <ElseIf if="{contains({$my_sub_roles},Faculty Evaluation Committee)}">
                <!-- Increment Vote -->
                <ReportItem id="vote" type="Select" blobType="BLOB_TEXT" blobItem="VOTE" blobSubItem="{$user_id}" options="|Yes|No|Abstain" width="80px">
                    <![CDATA[
                        <td>{$value}</td>
                    ]]>
                </ReportItem>
                <!-- Tenure Vote -->
                <If if="{!=({getText(RP_FEC_TABLE, TABLE, T_FREEZE, {$parent_id}, 1, 0)},Frozen)}">
                    <ReportItem id="t_vote" type="Select" blobType="BLOB_TEXT" blobItem="T_VOTE" blobSubItem="{$user_id}" options="|Yes|No|Abstain" width="80px">
                        <![CDATA[
                            <td>
                                <span id='t_vote_{$user_id}'>{$item}</span>
                                <script type='text/javascript'>
                                    var tenure = "{getText(RP_CHAIR, FEC_REVIEW, TENURE, {$user_id}, 0, 0)}";
                                    if(tenure != "i recommend that an appointment with tenure be offered" &&
                                       tenure != "i recommend tenure as per clause 12.17 (special recommendation for tenure)"){
                                        $("#t_vote_{$user_id}").remove();
                                    }
                                </script>
                            </td>
                        ]]>
                    </ReportItem>
                </If>
                <Else>
                    <![CDATA[
                        <td>{getText(RP_FEC_TABLE, TABLE, T_VOTE, {$user_id}, {$my_id}, 0)}</td>
                    ]]>
                </Else>
                <!-- Promotion Vote -->
                <ReportItem id="p_vote" type="Select" blobType="BLOB_TEXT" blobItem="P_VOTE" blobSubItem="{$user_id}" options="|Yes|No|Abstain" width="80px">
                    <![CDATA[
                        <td>{$value}</td>
                    ]]>
                </ReportItem>
                <ReportItem id="comments" type="Textarea" blobType="BLOB_TEXT" blobItem="COMMENTS" blobSubItem="{$user_id}" height="75px">
                    <![CDATA[
                        <td>{$item}</td>
                    ]]>
                </ReportItem>
            </ElseIf>
            <Else if="{and({!contains({$my_roles},ViceDean)},{!contains({$my_sub_roles},Faculty Evaluation Committee)})}">
                <![CDATA[
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                ]]>
            </Else>
            <Static>
                <![CDATA[
                    </tr>
                ]]>
            </Static>
        </ReportItemSet>
        <Static>
            <![CDATA[
                    </tbody>
                </table>
                <script type='text/javascript'>
                    $('#chairTable').dataTable({
                        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                        "iDisplayLength": -1
                    });
                    $('#chairTable select, #chairTable textarea').change(function(){
                        saveAll();
                    });
                </script>
            ]]>
        </Static>
        <If if="{>({get(nFaculty)},0)}">
            <![CDATA[
                <table class='wikitable' frame='box' rules='all'>
                    <tr>
                        <th>Average<br />Faculty Increment</th>
                        <th>Average<br />FSO Increment</th>
                        <th>Total<br />Faculty Increment</th>
                        <th>Total<br />FSO Increment</th>
                    </tr>
                    <tr>
                        <td id='averageFac' align='right'>{round({divide({get(sumFaculty)}, {get(nFaculty)})}, 2)}</td>
                        <td id='averageFSO' align='right'>{round({divide({get(sumFSO)}, {get(nFSO)})}, 2)}</td>
                        <td id='totalFac' align='right'>{round({get(sumFaculty)}, 2)}</td>
                        <td id='totalFSO' align='right'>{round({get(sumFSO)}, 2)}</td>
                    </tr>
                </table>
            ]]>
        </If>
    </ReportSection>
    <ReportSection id="fec_votes" tooltip="FEC Votes" name="FEC Votes" title="FEC Votes" blobSection="TABLE" type="EditableReportSection">
        <Static>
            <![CDATA[
                <style>
                    table#chairTable * {
                        font-size:11px !important;
                    }
                </style>
                <button id='refresh' type='button' style='margin-bottom: 1em;'>Refresh</button>
                <table id='chairTable' class='wikitable' frame='box' rules='all'>
                    <thead>
                        <tr>
                            <th width="1%">Case#</th>
                            <th>Name</th>
                            <th>Rank</th>
                            <th>Department</th>
                            <th>Revised Increment</th>
                            <th>Increment Votes</th>
                            <th>Tenure Votes</th>
                            <th>Promotion Votes</th>
                        </tr>
                    </thead>
                    <tbody>
            ]]>
        </Static>
        <ReportItemSet id="faculty" type="FacultyPeopleReportItemSet" start="{$last_year}-07-01" end="{$this_year}-07-01">
            <Static>
                <![CDATA[
                    <tr>
                        <td style='white-space:nowrap;'>{getExtra()}</td>
                        <td><a href="{$user_url}" target="_blank">{$user_name}</a></td>
                        <td>{$user_level}</td>
                        <td>{$user_dept}</td>
                ]]>
            </Static>
            <ReportItem id="increment" type="Increment" blobItem="INCREMENT" blobSubItem="{$user_id}" personId="1" width="80px" history="false" default="{getText(RP_CHAIR, FEC_REVIEW, INCREMENT, {$user_id}, 0, 0)}">
                <![CDATA[
                    <td>
                        {$item}
                    </td>
                ]]>
            </ReportItem>
            
            <!-- Increment Votes -->
            <ReportItem id="freeze" type="VoteResultsReportItem" blobItem="FREEZE" blobSubItem="{$user_id}" voteBlobItem="VOTE" personId="1" width="80px">
                <![CDATA[
                        <td>
                            <div>
                                {$item}
                            </div>
                        </td>
                ]]>
            </ReportItem>
            
            <!-- Tenure Votes -->
            <ReportItem id="t_freeze" type="VoteResultsReportItem" blobItem="T_FREEZE" blobSubItem="{$user_id}" voteBlobItem="T_VOTE" personId="1" width="80px">
                <![CDATA[
                        <td>
                            <div id='t_vote_{$user_id}'>
                                {$item}
                            </div>
                            <script type='text/javascript'>
                                var tenure = "{getText(RP_CHAIR, FEC_REVIEW, TENURE, {$user_id}, 0, 0)}";
                                if(tenure != "i recommend that an appointment with tenure be offered" &&
                                   tenure != "i recommend tenure as per clause 12.17 (special recommendation for tenure)"){
                                    $("#t_vote_{$user_id}").remove();
                                }
                            </script>
                        </td>
                ]]>
            </ReportItem>
            
            <!-- Promotion Votes -->
            <ReportItem id="p_freeze" type="VoteResultsReportItem" blobItem="P_FREEZE" blobSubItem="{$user_id}" voteBlobItem="P_VOTE" personId="1" width="80px">
                <![CDATA[
                        <td>
                            <div>
                                {$item}
                            </div>
                        </td>
                ]]>
            </ReportItem>
            
            <Static>
                <![CDATA[
                    </tr>
                ]]>
            </Static>
        </ReportItemSet>
        <Static>
            <![CDATA[
                    </tbody>
                </table>
                <script type='text/javascript'>
                    $('#chairTable').dataTable({
                        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                        "iDisplayLength": -1
                    });
                    $('#chairTable select, #chairTable textarea').change(function(){
                        saveAll();
                    });
                    $("#refresh").click(function(){
                        $("#refresh").prop("disabled", true);
                        $("#chairTable select, #chairTable input, #chairTable textarea").prop("disabled", true);
                        dbWritable = false;
                        $("#FECVotes").click();
                        dbWritable = true;
                    });
                </script>
            ]]>
        </Static>
    </ReportSection>
    <ReportSection id="atsec" tooltip="ATSEC Table" name="ATSEC Table" title="ATSEC Table" blobSection="TABLE" type="EditableReportSection" disabled="true">
        <Static>
            <![CDATA[
                {set(sumFaculty, 0)}
                {set(nFaculty, 0)}
                <style>
                    table#chairTable * {
                        font-size:11px !important;
                    }
                </style>
                <table id='chairTable' class='wikitable' frame='box' rules='all'>
                    <thead>
                        <tr>
                            <th width="1%">Case#</th>
                            <th>Name</th>
                            <th>Rank</th>
                            <th>Department</th>
                            <th width="1%">Annual Report</th>
                            <th>Evaluation</th>
                            <th>Increment</th>
                            <th>Comments <span class='tooltip' title='Comments will be visible to the FEC Chair'>&#9432;</span></th>
                        </tr>
                    </thead>
                    <tbody>
            ]]>
        </Static>
        <ReportItemSet id="faculty" type="FacultyPeopleReportItemSet" atsec="true" start="{$last_year}-07-01" end="{$this_year}-07-01">
            <Static>
                <![CDATA[
                    <tr>
                        <td style='white-space:nowrap;'>{getExtra()}</td>
                        <td><a href="{$user_url}" target="_blank">{$user_name}</a></td>
                        <td>{$user_level}</td>
                        <td>{$user_dept}</td>
                ]]>
            </Static>
            <ReportItem id="download" type="PDFReportItem" reportType="FECpdf" class="" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                <![CDATA[
                        <td align='center'>{$item}</td>
                        <td align='center'>
                ]]>
            </ReportItem>
            <ReportItem id="recommendation" type="PDFReportItem" reportType="ChairTable" section="Recommendations" noRenderIfNull="true" class="" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                <![CDATA[
                        {$item} Recommendation<br />
                ]]>
            </ReportItem>
            <If if="{or({contains({$my_roles},ADMIN)},
                        {contains({$my_roles},DEAN)},
                        {contains({$my_roles},VDEAN)},
                        {contains({$my_roles},HR)})}">
                <ReportItem id="da" type="PDFReportItem" reportType="ChairTable" section="Dean Advice" noRenderIfNull="true" class="" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                    <![CDATA[
                            {$item} Dean's Advice<br />
                    ]]>
                </ReportItem>
                <ReportItem id="dd" type="PDFReportItem" reportType="ChairTable" section="Dean Decision" noRenderIfNull="true" class="" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                    <![CDATA[
                            {$item} Dean's Decision<br />
                    ]]>
                </ReportItem>
            </If>
            <If if="{and({!=(,{getText(RP_CHAIR, FEC_REVIEW, INCREMENT, {$user_id}, 0, 0)})},
                         {!=(N/A,{getText(RP_CHAIR, FEC_REVIEW, INCREMENT, {$user_id}, 0, 0)})},
                         {!=(0.00,{getText(RP_CHAIR, FEC_REVIEW, INCREMENT, {$user_id}, 0, 0)})},
                         {!=(0A,{getText(RP_CHAIR, FEC_REVIEW, INCREMENT, {$user_id}, 0, 0)})},
                         {!contains({$my_roles},Chair)}
                    )}">
                <Static id="increment" blobSection="FEC_REVIEW" blobItem="INCREMENT" blobSubItem="{$user_id}" width="100%">
                    <![CDATA[
                        {set(sumFaculty, {add({get(sumFaculty)}, {getNumber(RP_CHAIR, FEC_REVIEW, INCREMENT, {$user_id}, 0, 0)})})}
                        {set(nFaculty, {add({get(nFaculty)}, 1)})}
                    ]]>
                </Static>
            </If>
            <Static>
                <![CDATA[
                        </td>
                        <td>
                            {getText(RP_CHAIR, FEC_REVIEW, INCREMENT, {$user_id}, 0, 0)}
                        </td>
                        <td>
                ]]>
            </Static>
            <If if="{contains({$my_roles},ViceDean)}">
                <ReportItemSet id="fec_comments" type="ATSECReportItemSet">
                    <Static>
                        <![CDATA[
                            {set(comment, {getText(RP_FEC_TABLE, TABLE, COMMENTS, {$parent_id}, {$user_id}, 0)})}
                        ]]>
                    </Static>
                    <If id="comment_if" if="{!=({get(comment)},)}">
                        <![CDATA[
                            <b>{$user_name}:</b> {get(comment)}
                            <hr />
                        ]]>
                    </If>
                </ReportItemSet>
            </If>
            <ElseIf if="{contains({$my_sub_roles},Academic Teaching Staff Evaluation Committee)}">
                <ReportItem id="comments" type="Textarea" blobType="BLOB_TEXT" blobItem="COMMENTS" blobSubItem="{$user_id}" height="75px">
                    <![CDATA[
                        {$item}
                    ]]>
                </ReportItem>
            </ElseIf>
            <Static>
                <![CDATA[
                        </td>
                    </tr>
                ]]>
            </Static>
        </ReportItemSet>
        <Static>
            <![CDATA[
                    </tbody>
                </table>
                <script type='text/javascript'>
                    $('#chairTable').dataTable({
                        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                        "iDisplayLength": -1
                    });
                </script>
            ]]>
        </Static>
        <If if="{>({get(nFaculty)},0)}">
            <![CDATA[
                <table class='wikitable' frame='box' rules='all'>
                    <tr>
                        <th>Average<br />Faculty Increment</th>
                        <th>Total<br />Faculty Increment</th>
                    </tr>
                    <tr>
                        <td id='averageFac' align='right'>{round({divide({get(sumFaculty)}, {get(nFaculty)})}, 2)}</td>
                        <td id='totalFac' align='right'>{round({get(sumFaculty)}, 2)}</td>
                    </tr>
                </table>
            ]]>
        </If>
    </ReportSection>
</Report>
