<?xml version="1.0" encoding="UTF-8" ?>
<Report name="FECReview" reportType="RP_CHAIR" pdfFiles="FECReview" ajax="true">
    <Permissions>
        <Role role="ISAC">
            <SectionPermission id="reviews" permissions="rw" />
        </Role>
        <Role role="RMC">
            <SectionPermission id="reviews" permissions="rw" />
        </Role>
    </Permissions>
    <ReportSection id="reviews" tooltip="Reviews" name="Reviews" title="{$user_dept} Reviews" blobSection="FEC_REVIEW" type="EditableReportSection" pagebreak="false">
        <ReportItem id="thead" type="Static">
            <![CDATA[
                <table id='chairTable' class='wikitable' frame='box' rules='all'>
                    <thead>
                        <tr>
                            <th>Faculty Member</th>
                            <th>Position</th>
                            <th width="1%">Annual Report</th>
                            <th width="1%">Locked</th>
                            <th width="1%">Increment</th>
                            <th width="1%">Tenure</th>
                            <th width="1%">Promotion</th>
                    </thead>
                    <tbody>
            ]]>
        </ReportItem>
        <ReportItemSet type="DepartmentPeopleReportItemSet" department="{$user_dept}">
            <ReportItem id="name" type="Static">
                <![CDATA[
                    <tr>
                        <td><a href="{$user_url}" target="_blank">{$user_name}</a></td>
                        <td>{$user_level}</td>
                ]]>
            </ReportItem>
            <ReportItem id="download" type="PDFReportItem" reportType="FEC" buttonName="Download PDF">
                <![CDATA[
                        <td align='center'>{$item}</td>
                ]]>
            </ReportItem>
            <ReportItemSet type="If" if="{==({getArray(RP_FEC,FEC_SUBMIT,LOCK,0,{$user_id},0,lock)},Lock)}">
                <ReportItem id="lock" type="Checkbox" blobReport="RP_FEC" blobSection="FEC_SUBMIT" blobItem="LOCK" blobSubItem="0" personId="{$user_id}" blobType="BLOB_ARRAY" orientation="vertical" options="Lock">
                    <![CDATA[
                        <td style='white-space:nowrap;'>
                            <div id='lockContainer_{$user_id}' style='display:none;'>{$item}</div>
                            <button id='lock_{$user_id}' type="button" value="Save" name="submit">Unlock</button>
                            <script type="text/javascript">
                                $('#lock_{$user_id}').click(function(){
                                    if(confirm('Are you sure you want to proceed?\n\nThis annual report will be unlocked and the faculty member will be able to edit their report again.')){
                                        $('#lockContainer_{$user_id} input[type=checkbox]').prop('checked', false);
                                        $('#lock_{$user_id}').prop('disabled', true);
                                        $('#lock_{$user_id}').after("<span class='throbber'></span>");
                                        saveAll(function(){$("#Reviews").click();});
                                    } else {
                                        $('#lockContainer_{$user_id} input[type=checkbox]').prop('checked', true);
                                    }
                                    return false;
                                });
                            </script>
                        </td>
                    ]]>
                </ReportItem>
            </ReportItemSet>
            <ReportItemSet type="If" if="{!=({getArray(RP_FEC,FEC_SUBMIT,LOCK,0,{$user_id},0,lock)},Lock)}">
                <ReportItem id="lock" type="Static">
                    <![CDATA[
                        <td>Not Locked</td>
                    ]]>
                </ReportItem>
            </ReportItemSet>
            <ReportItem id="increment" type="Text" blobItem="INCREMENT" blobSubItem="{$user_id}" width="100px">
                <![CDATA[
                        <td><small>{$item}</small></td>
                ]]>
            </ReportItem>
            <ReportItem id="tenure" type="Text" blobItem="TENURE" blobSubItem="{$user_id}" width="100px">
                <![CDATA[
                        <td>{$item}</td>
                ]]>
            </ReportItem>
            <ReportItem id="promotion" type="Text" blobItem="PROMOTION" blobSubItem="{$user_id}" width="100px">
                <![CDATA[
                        <td>{$item}</td>
                    </tr>
                ]]>
            </ReportItem>
        </ReportItemSet>
        <ReportItem id="tfoot" type="Static">
            <![CDATA[
                    </tbody>
                </table>
                <script type='text/javascript'>
                    $('#chairTable').dataTable({
                        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                        "iDisplayLength": -1
                    });
                </script>
            ]]>
        </ReportItem>
    </ReportSection>
</Report>
