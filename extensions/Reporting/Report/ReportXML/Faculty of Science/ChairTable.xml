<?xml version="1.0" encoding="UTF-8" ?>
<Report name="Evaluations" title=" " headerName=" " reportType="RP_CHAIR" pdfFiles="ChairTable" pdfType="CHAIR_EVAL" personId="0" ajax="true">
    <Permissions>
        <Role role="ISAC">
            <SectionPermission id="evaluations" permissions="rw" />
            <SectionPermission id="dean_evaluations" permissions="" />
            <SectionPermission id="recommendations" permissions="rw" />
            <SectionPermission id="deans_advice" permissions="" />
            <SectionPermission id="deans_decision" permissions="" />
            <SectionPermission id="chairs_advice" permissions="rw" />
            <SectionPermission id="dept_publications" permissions="rw" />
            <SectionPermission id="dept_hqp" permissions="rw" />
        </Role>
        <Role role="IAC">
            <SectionPermission id="evaluations" permissions="rw" />
            <SectionPermission id="dean_evaluations" permissions="" />
            <SectionPermission id="recommendations" permissions="rw" />
            <SectionPermission id="deans_advice" permissions="" />
            <SectionPermission id="deans_decision" permissions="" />
            <SectionPermission id="chairs_advice" permissions="r" />
            <SectionPermission id="dept_publications" permissions="rw" />
            <SectionPermission id="dept_hqp" permissions="rw" />
        </Role>
        <Role role="DEAN">
            <SectionPermission id="evaluations" permissions="" />
            <SectionPermission id="dean_evaluations" permissions="rw" />
            <SectionPermission id="recommendations" permissions="rw" />
            <SectionPermission id="deans_advice" permissions="rw" />
            <SectionPermission id="deans_decision" permissions="rw" />
            <SectionPermission id="chairs_advice" permissions="" />
            <SectionPermission id="dept_publications" permissions="" />
            <SectionPermission id="dept_hqp" permissions="" />
        </Role>
        <Role role="DEANEA">
            <SectionPermission id="evaluations" permissions="" />
            <SectionPermission id="dean_evaluations" permissions="rw" />
            <SectionPermission id="recommendations" permissions="rw" />
            <SectionPermission id="deans_advice" permissions="rw" />
            <SectionPermission id="deans_decision" permissions="rw" />
            <SectionPermission id="chairs_advice" permissions="" />
            <SectionPermission id="dept_publications" permissions="" />
            <SectionPermission id="dept_hqp" permissions="" />
        </Role>
        <!-- Chemistry -->
        <!--Person id="352">
            <SectionPermission id="evaluations" permissions="rw" />
            <SectionPermission id="dean_evaluations" permissions="" />
            <SectionPermission id="recommendations" permissions="rw" />
            <SectionPermission id="deans_advice" permissions="" />
            <SectionPermission id="deans_decision" permissions="" />
            <SectionPermission id="chairs_advice" permissions="rw" />
            <SectionPermission id="dept_publications" permissions="rw" />
        </Person>
        <Person id="12146">
            <SectionPermission id="evaluations" permissions="rw" />
            <SectionPermission id="dean_evaluations" permissions="" />
            <SectionPermission id="recommendations" permissions="rw" />
            <SectionPermission id="deans_advice" permissions="" />
            <SectionPermission id="deans_decision" permissions="" />
            <SectionPermission id="chairs_advice" permissions="rw" />
            <SectionPermission id="dept_publications" permissions="rw" />
        </Person-->
        <!-- Physics -->
        <!--Person id="252">
            <SectionPermission id="evaluations" permissions="rw" />
            <SectionPermission id="dean_evaluations" permissions="" />
            <SectionPermission id="recommendations" permissions="rw" />
            <SectionPermission id="deans_advice" permissions="" />
            <SectionPermission id="deans_decision" permissions="" />
            <SectionPermission id="chairs_advice" permissions="rw" />
            <SectionPermission id="dept_publications" permissions="rw" />
        </Person>
        <Person id="12570">
            <SectionPermission id="evaluations" permissions="rw" />
            <SectionPermission id="dean_evaluations" permissions="" />
            <SectionPermission id="recommendations" permissions="rw" />
            <SectionPermission id="deans_advice" permissions="" />
            <SectionPermission id="deans_decision" permissions="" />
            <SectionPermission id="chairs_advice" permissions="rw" />
            <SectionPermission id="dept_publications" permissions="rw" />
        </Person-->
        <!-- Math -->
        <!--Person id="20">
            <SectionPermission id="evaluations" permissions="rw" />
            <SectionPermission id="dean_evaluations" permissions="" />
            <SectionPermission id="recommendations" permissions="rw" />
            <SectionPermission id="deans_advice" permissions="" />
            <SectionPermission id="deans_decision" permissions="" />
            <SectionPermission id="chairs_advice" permissions="rw" />
            <SectionPermission id="dept_publications" permissions="rw" />
        </Person>
        <Person id="12599">
            <SectionPermission id="evaluations" permissions="rw" />
            <SectionPermission id="dean_evaluations" permissions="" />
            <SectionPermission id="recommendations" permissions="rw" />
            <SectionPermission id="deans_advice" permissions="" />
            <SectionPermission id="deans_decision" permissions="" />
            <SectionPermission id="chairs_advice" permissions="rw" />
            <SectionPermission id="dept_publications" permissions="rw" />
        </Person-->
        <!-- Computing Science -->
        <!--Person id="248">
            <SectionPermission id="evaluations" permissions="rw" />
            <SectionPermission id="dean_evaluations" permissions="" />
            <SectionPermission id="recommendations" permissions="rw" />
            <SectionPermission id="deans_advice" permissions="" />
            <SectionPermission id="deans_decision" permissions="" />
            <SectionPermission id="chairs_advice" permissions="rw" />
            <SectionPermission id="dept_publications" permissions="rw" />
        </Person>
        <Person id="13029">
            <SectionPermission id="evaluations" permissions="rw" />
            <SectionPermission id="dean_evaluations" permissions="" />
            <SectionPermission id="recommendations" permissions="rw" />
            <SectionPermission id="deans_advice" permissions="" />
            <SectionPermission id="deans_decision" permissions="" />
            <SectionPermission id="chairs_advice" permissions="rw" />
            <SectionPermission id="dept_publications" permissions="rw" />
        </Person-->
        <!-- Psychology -->
        <!--Person id="64">
            <SectionPermission id="evaluations" permissions="rw" />
            <SectionPermission id="dean_evaluations" permissions="" />
            <SectionPermission id="recommendations" permissions="rw" />
            <SectionPermission id="deans_advice" permissions="" />
            <SectionPermission id="deans_decision" permissions="" />
            <SectionPermission id="chairs_advice" permissions="rw" />
            <SectionPermission id="dept_publications" permissions="rw" />
        </Person>
        <Person id="13030">
            <SectionPermission id="evaluations" permissions="rw" />
            <SectionPermission id="dean_evaluations" permissions="" />
            <SectionPermission id="recommendations" permissions="rw" />
            <SectionPermission id="deans_advice" permissions="" />
            <SectionPermission id="deans_decision" permissions="" />
            <SectionPermission id="chairs_advice" permissions="rw" />
            <SectionPermission id="dept_publications" permissions="rw" />
        </Person-->
    </Permissions>
    <ReportSection id="evaluations" tooltip="Evaluations" name="Evaluations" title="{$my_dept} Evaluations" blobSection="FEC_REVIEW" type="EditableReportSection" pagebreak="false">
        <ReportItem id="thead" type="Static">
            <![CDATA[
                <style>
                    table#chairTable * {
                        font-size:11px !important;
                    }
                </style>
                <div style='float:right; margin-top: -45px;'><button id='generateAll' type='button'>Generate All Evaluations</button></div>
                <script type='text/javascript'>
                    $('#generateAll').click(function(){
                        $('.generateButton').click();
                    });
                </script>
                <table id='chairTable' class='wikitable' frame='box' rules='all'>
                    <thead>
                        <tr>
                            <th>Case#</th>
                            <th>Name</th>
                            <th>Rank</th>
                            <th width="1%">Annual Report</th>
                            <th width="1%">Locked</th>
                            <th>Evaluation</th>
                            <th width="1%">Merit Increment</th>
                            <th width="1%">Tenure</th>
                            <th width="1%">Promotion</th>
                    </thead>
                    <tbody>
            ]]>
        </ReportItem>
        <ReportItemSet id="faculty" type="DepartmentPeopleReportItemSet" department="{$my_dept}" start="{$last_year}-07-01" end="{$this_year}-07-01" university="University of Alberta" excludeMe="true">
            <ReportItem id="name" type="Static">
                <![CDATA[
                    <tr data-fecid="{getExtra()}">
                        <td>{getExtra()}</td>
                        <td><a href="{$user_url}" target="_blank">{$user_name}</a></td>
                        <td>{$user_level}</td>
                ]]>
            </ReportItem>
            <ReportItem id="download" type="PDFReportItem" reportType="FECpdf" class="" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                <![CDATA[
                        <td align='center'>{$item}</td>
                ]]>
            </ReportItem>
            <ReportItemSet id="if_lock" type="If" if="{==({getArray(RP_FEC,FEC_SUBMIT,LOCK,0,{$user_id},0,lock)},Lock)}">
                <ReportItem id="lock" type="Unlock" blobReport="RP_FEC" blobSection="FEC_SUBMIT" blobItem="LOCK" blobSubItem="0" personId="{$user_id}" blobType="BLOB_ARRAY" orientation="vertical" options="Lock">
                    <![CDATA[
                        <td style='white-space:nowrap;' align='center'>
                            <div id='lockContainer_{$user_id}' style='display:none;'>{$item}</div>
                            <button id='lock_{$user_id}' type="button" value="Save" name="submit">Unlock</button>
                            <script type="text/javascript">
                                $('#lock_{$user_id}').click(function(){
                                    if(confirm('Are you sure you want to proceed?\n\nThis annual report will be unlocked and the faculty member will be able to edit their report again.')){
                                        $('#lockContainer_{$user_id} input[type=checkbox]').prop('checked', false);
                                        $('#lock_{$user_id}').prop('disabled', true);
                                        $('#lock_{$user_id}').after("<span class='throbber'></span>");
                                        saveAll(function(){$("#Evaluations").click();});
                                    } else {
                                        $('#lockContainer_{$user_id} input[type=checkbox]').prop('checked', true);
                                    }
                                    return false;
                                });
                            </script>
                        </td>
                    ]]>
                </ReportItem>
            </ReportItemSet>
            <ReportItemSet id="if_not_lock" type="If" if="{!=({getArray(RP_FEC,FEC_SUBMIT,LOCK,0,{$user_id},0,lock)},Lock)}">
                <ReportItem id="lock" type="Static">
                    <![CDATA[
                        <td align='center'>Not Locked</td>
                    ]]>
                </ReportItem>
            </ReportItemSet>
            <ReportItemSet id="if_not_ca" type="If" if="{!contains({$user_sub_roles},Chair's Advice)}">
                <ReportItem id="recommendation" type="PDFReportItem" class="downloadButton{$user_id}" reportType="ChairTable" section="Recommendations" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                    <![CDATA[
                            <td align='center'>
                            {$item} <a class="viewEvaluation" style="cursor:pointer;" data-href='{$wgServer}{$wgScriptPath}/index.php/Special:Report?report=ChairTable&section=Recommendations&userId={$user_id}'>Recommendation</a><br />
                    ]]>
                </ReportItem>
            </ReportItemSet>
            <ReportItemSet id="if_ca" type="If" if="{contains({$user_sub_roles},Chair's Advice)}">
                <ReportItem id="ca" type="PDFReportItem" reportType="ChairTable" class="downloadButton{$user_id}" section="Chair Advice" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                    <![CDATA[
                            <td align='center'>
                            {$item} <a class="viewCA" style="cursor:pointer;" data-href='{$wgServer}{$wgScriptPath}/index.php/Special:Report?report=ChairTable&section=Chair+Advice&userId={$user_id}'>Chair's Advice</a><br />
                    ]]>
                </ReportItem>
            </ReportItemSet>
            <ReportItem id="da_download" type="PDFReportItem" reportType="ChairTable" section="Dean Advice" noRenderIfNull="true" class="" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                <![CDATA[
                        {$item} Dean's Advice<br />
                ]]>
            </ReportItem>
            <ReportItemSet id="if_not_ca" type="If" if="{!contains({$user_sub_roles},Chair's Advice)}">
                <ReportItem id="submit" type="SimpleReviewSubmit" section="Recommendations" userId="{$user_id}" onlyGenerate="true" specialDownload=".downloadButton{$user_id}">
                    <![CDATA[
                        {$item}
                    ]]>
                </ReportItem>
            </ReportItemSet>
            <ReportItemSet id="if_ca" type="If" if="{contains({$user_sub_roles},Chair's Advice)}">
                <ReportItem id="submit" type="SimpleReviewSubmit" section="Chair Advice" userId="{$user_id}" onlyGenerate="true" specialDownload=".downloadButton{$user_id}">
                    <![CDATA[
                        {$item}
                    ]]>
                </ReportItem>
            </ReportItemSet>
            <ReportItemSet id="if_chair" type="If" if="{contains({$my_roles},Chair)}">
                <ReportItemSet id="if_not_ca" type="If" if="{!contains({$user_sub_roles},Chair's Advice)}">
                    <ReportItem id="increment" type="Increment" blobItem="INCREMENT" blobSubItem="{$user_id}" width="50px">
                        <![CDATA[
                                </td>
                                <td align='center' valign='middle' class='increment' style="white-space:nowrap;">{$item}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="tenure" type="Tenure" blobItem="TENURE" blobSubItem="{$user_id}" width="200px">
                        <![CDATA[
                                <td align='center' class='tenure'>{$item}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="promotion" type="Promotion" blobItem="PROMOTION" blobSubItem="{$user_id}" width="200px">
                        <![CDATA[
                                <td align='center' class='promotion'>{$item}</td>
                            </tr>
                        ]]>
                    </ReportItem>
                </ReportItemSet>
                <ReportItemSet id="if_ca" type="If" if="{contains({$user_sub_roles},Chair's Advice)}">
                    <ReportItem id="increment" type="Increment" blobItem="INCREMENT" blobSection="FEC_CHAIR_ADVICE" blobSubItem="{$user_id}" width="50px">
                        <![CDATA[
                                </td>
                                <td align='center' valign='middle' class='increment' style="white-space:nowrap;">{$item}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="tenure" type="Tenure" blobItem="TENURE" blobSection="FEC_CHAIR_ADVICE" blobSubItem="{$user_id}" width="200px">
                        <![CDATA[
                                <td align='center' class='tenure'>{$item}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="promotion" type="Promotion" blobItem="PROMOTION" blobSection="FEC_CHAIR_ADVICE" blobSubItem="{$user_id}" width="200px">
                        <![CDATA[
                                <td align='center' class='promotion'>{$item}</td>
                            </tr>
                        ]]>
                    </ReportItem>
                </ReportItemSet>
            </ReportItemSet>
            <ReportItemSet id="if_ea" type="If" if="{contains({$my_roles},EA)}">
                <ReportItemSet id="if_not_ca" type="If" if="{!contains({$user_sub_roles},Chair's Advice)}">
                    <ReportItem id="increment" type="Increment" blobItem="INCREMENT" blobSubItem="{$user_id}" width="50px">
                        <![CDATA[
                                </td>
                                <td align='center' valign='middle' class='increment' style="white-space:nowrap;">{$value}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="tenure" type="Tenure" blobItem="TENURE" blobSubItem="{$user_id}" width="200px">
                        <![CDATA[
                                <td align='center' class='tenure'>{$value}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="promotion" type="Promotion" blobItem="PROMOTION" blobSubItem="{$user_id}" width="200px">
                        <![CDATA[
                                <td align='center' class='promotion'>{$value}</td>
                            </tr>
                        ]]>
                    </ReportItem>
                </ReportItemSet>
                <ReportItemSet id="if_ca" type="If" if="{contains({$user_sub_roles},Chair's Advice)}">
                    <ReportItem id="increment" type="Increment" blobItem="INCREMENT" blobSection="FEC_CHAIR_ADVICE" blobSubItem="{$user_id}" width="50px">
                        <![CDATA[
                                </td>
                                <td align='center' valign='middle' class='increment' style="white-space:nowrap;">{$value}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="tenure" type="Tenure" blobItem="TENURE" blobSection="FEC_CHAIR_ADVICE" blobSubItem="{$user_id}" width="200px">
                        <![CDATA[
                                <td align='center' class='tenure'>{$value}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="promotion" type="Promotion" blobItem="PROMOTION" blobSection="FEC_CHAIR_ADVICE" blobSubItem="{$user_id}" width="200px">
                        <![CDATA[
                                <td align='center' class='promotion'>{$value}</td>
                            </tr>
                        ]]>
                    </ReportItem>
                </ReportItemSet>
            </ReportItemSet>
        </ReportItemSet>
        <ReportItem id="tfoot" type="Static">
            <![CDATA[
                    </tbody>
                </table><br />
                <table class='wikitable' frame='box' rules='all'>
                    <tr>
                        <th>Year</th>
                        <th>Average<br />Faculty Increment</th>
                        <th>Average<br />FSO Increment</th>
                    </tr>
                    <tr>
                        <td><b>{$this_year}</b></td>
                        <td id='averageFac' align='right'></td>
                        <td id='averageFSO' align='right'></td>
                    </tr>
                    <tr>
                        <td><b>{subtract({$this_year},1)}</b></td>
                        <td id='averageFac{subtract({$this_year},1)}' align='right'></td>
                        <td id='averageFSO{subtract({$this_year},1)}' align='right'></td>
                    </tr>
                    <tr>
                        <td><b>{subtract({$this_year},2)}</b></td>
                        <td id='averageFac{subtract({$this_year},2)}' align='right'></td>
                        <td id='averageFSO{subtract({$this_year},2)}' align='right'></td>
                    </tr>
                    <tr>
                        <td><b>{subtract({$this_year},3)}</b></td>
                        <td id='averageFac{subtract({$this_year},3)}' align='right'></td>
                        <td id='averageFSO{subtract({$this_year},3)}' align='right'></td>
                    </tr>
                    <tr>
                        <td><b>{subtract({$this_year},4)}</b></td>
                        <td id='averageFac{subtract({$this_year},4)}' align='right'></td>
                        <td id='averageFSO{subtract({$this_year},4)}' align='right'></td>
                    </tr>
                    <tr>
                        <td><b>{subtract({$this_year},5)}</b></td>
                        <td id='averageFac{subtract({$this_year},5)}' align='right'></td>
                        <td id='averageFSO{subtract({$this_year},5)}' align='right'></td>
                    </tr>
                    <tr>
                        <td><b>{subtract({$this_year},6)}</b></td>
                        <td id='averageFac{subtract({$this_year},6)}' align='right'></td>
                        <td id='averageFSO{subtract({$this_year},6)}' align='right'></td>
                    </tr>
                </table>
                <small>Averages are based on the people currently in the table, so previous averages may differ slightly as it does not factor in people who are no longer in the department</small>
                <script type='text/javascript'>
                    $('#chairTable').dataTable({
                        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                        "iDisplayLength": -1
                    });
                    
                    $(".viewEvaluation").click(function(){
                        var href = $(this).attr('data-href');
                        $("#Recommendations").attr('href', href);
                        $("#Recommendations").trigger('click');
                    });
                    
                    $(".viewCA").click(function(){
                        var href = $(this).attr('data-href');
                        $("#ChairAdvice").attr('href', href);
                        $("#ChairAdvice").trigger('click');
                    });
                    
                    $(".viewDA").click(function(){
                        var href = $(this).attr('data-href');
                        $("#DeanAdvice").attr('href', href);
                        $("#DeanAdvice").trigger('click');
                    });
                    
                    $(".viewDD").click(function(){
                        var href = $(this).attr('data-href');
                        $("#DeanDecision").attr('href', href);
                        $("#DeanDecision").trigger('click');
                    });
                    
                    $(".increment select").change(function(){
                        var fac_sum = 0;
                        var fac_count = 0;
                        var fso_sum = 0;
                        var fso_count = 0;
                        $(".increment select").each(function(i, el){
                            var tr = $(el).closest("tr");
                            if($(el).val() != "" && $(el).val() != "0.00 (PTC)"){
                                if($(tr).attr('data-fecid').includes("A") ||
                                   $(tr).attr('data-fecid').includes("B") ||
                                   $(tr).attr('data-fecid').includes("C") ||
                                   $(tr).attr('data-fecid').includes("N")){
                                    fac_sum += parseFloat($(el).val());
                                    fac_count++;
                                }
                                else if($(tr).attr('data-fecid').includes("D") ||
                                        $(tr).attr('data-fecid').includes("E") ||
                                        $(tr).attr('data-fecid').includes("F") ||
                                        $(tr).attr('data-fecid').includes("M")){
                                    fso_sum += parseFloat($(el).val());
                                    fso_count++;
                                }
                            }
                        });
                        $('#averageFac').html((fac_sum/Math.max(1, fac_count)).toFixed(3));
                        $('#averageFSO').html((fso_sum/Math.max(1, fso_count)).toFixed(3));
                    });
                    
                    var increments = new Array();
                    var fac_counts = new Array();
                    var fac_sums = new Array();

                    var fso_counts = new Array();
                    var fso_sums = new Array();
                    
                    increments[{subtract({$this_year},1)}] = $(".increment{subtract({$this_year},1)}");
                    increments[{subtract({$this_year},2)}] = $(".increment{subtract({$this_year},2)}");
                    increments[{subtract({$this_year},3)}] = $(".increment{subtract({$this_year},3)}");
                    increments[{subtract({$this_year},4)}] = $(".increment{subtract({$this_year},4)}");
                    increments[{subtract({$this_year},5)}] = $(".increment{subtract({$this_year},5)}");
                    increments[{subtract({$this_year},6)}] = $(".increment{subtract({$this_year},6)}");
                    
                    _.each(increments, function(increment, i){
                        fac_counts[i] = 0;
                        fac_sums[i] = 0;
                        fso_counts[i] = 0;
                        fso_sums[i] = 0;
                        $(increment).each(function(j, el){
                            var table = $(el).closest("table");
                            var val = $(el).text();
                            if(val != "N/A" && val != "" && val != "0.00 (PTC)"){
                                if($(table).attr('data-fecid').includes("A") ||
                                   $(table).attr('data-fecid').includes("B") ||
                                   $(table).attr('data-fecid').includes("C") ||
                                   $(table).attr('data-fecid').includes("N")){
                                    fac_sums[i] += parseFloat(val);
                                    fac_counts[i]++;
                                }
                                else if($(table).attr('data-fecid').includes("D") ||
                                        $(table).attr('data-fecid').includes("E") ||
                                        $(table).attr('data-fecid').includes("F") ||
                                        $(table).attr('data-fecid').includes("M")){
                                    fso_sums[i] += parseFloat(val);
                                    fso_counts[i]++;
                                }
                            }
                        });
                        $('#averageFac' + i).html((fac_sums[i]/Math.max(1, fac_counts[i])).toFixed(3));
                        $('#averageFSO' + i).html((fso_sums[i]/Math.max(1, fso_counts[i])).toFixed(3));
                    });
                    $(".increment select").first().trigger('change');
                </script>
                <script type='text/javascript' src='{$wgServer}{$wgScriptPath}/extensions/Reporting/Report/scripts/recommendations.js'></script>
            ]]>
        </ReportItem>
    </ReportSection>
    <ReportSection id="dean_evaluations" tooltip="Dean's Evaluations" name="Dean Evaluations" title="Dean's Evaluations" blobSection="FEC_REVIEW" type="EditableReportSection" pagebreak="false">
        <ReportItem id="thead" type="Static">
            <![CDATA[
                <style>
                    table#chairTable * {
                        font-size:11px !important;
                    }
                </style>
                <div style='float:right; margin-top: -45px;'><button id='generateAll' type='button'>Generate All Evaluations</button></div>
                <script type='text/javascript'>
                    $('#generateAll').click(function(){
                        $('.generateButton').click();
                    });
                </script>
                <table id='chairTable' class='wikitable' frame='box' rules='all'>
                    <thead>
                        <tr>
                            <th>Case#</th>
                            <th>Name</th>
                            <th>Rank</th>
                            <th>Special Case</th>
                            <th width="1%">Annual Report</th>
                            <th width="1%">Locked</th>
                            <th>Evaluation</th>
                            <th width="1%">Merit Increment</th>
                            <th width="1%">Tenure</th>
                            <th width="1%">Promotion</th>
                    </thead>
                    <tbody>
            ]]>
        </ReportItem>
        <ReportItemSet id="faculty" type="DeansPeopleReportItemSet" start="{$last_year}-07-01" end="{$this_year}-07-01">
            <ReportItem id="name" type="Static">
                <![CDATA[
                    <tr data-fecid="{getExtra()}">
                        <td>{getExtra()}</td>
                        <td><a href="{$user_url}" target="_blank">{$user_name}</a></td>
                        <td>{$user_level}</td>
                        <td>{$user_sub_roles}</td>
                ]]>
            </ReportItem>
            <ReportItem id="download" type="PDFReportItem" reportType="FECpdf" class="" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                <![CDATA[
                        <td align='center'>{$item}</td>
                ]]>
            </ReportItem>
            <ReportItemSet id="if_lock" type="If" if="{==({getArray(RP_FEC,FEC_SUBMIT,LOCK,0,{$user_id},0,lock)},Lock)}">
                <ReportItem id="lock" type="Unlock" blobReport="RP_FEC" blobSection="FEC_SUBMIT" blobItem="LOCK" blobSubItem="0" personId="{$user_id}" blobType="BLOB_ARRAY" orientation="vertical" options="Lock">
                    <![CDATA[
                        <td style='white-space:nowrap;' align='center'>
                            <div id='lockContainer_{$user_id}' style='display:none;'>{$item}</div>
                            <button id='lock_{$user_id}' type="button" value="Save" name="submit">Unlock</button>
                            <script type="text/javascript">
                                $('#lock_{$user_id}').click(function(){
                                    if(confirm('Are you sure you want to proceed?\n\nThis annual report will be unlocked and the faculty member will be able to edit their report again.')){
                                        $('#lockContainer_{$user_id} input[type=checkbox]').prop('checked', false);
                                        $('#lock_{$user_id}').prop('disabled', true);
                                        $('#lock_{$user_id}').after("<span class='throbber'></span>");
                                        saveAll(function(){$("#DeanEvaluations").click();});
                                    } else {
                                        $('#lockContainer_{$user_id} input[type=checkbox]').prop('checked', true);
                                    }
                                    return false;
                                });
                            </script>
                        </td>
                    ]]>
                </ReportItem>
            </ReportItemSet>
            <ReportItemSet id="if_not_lock" type="If" if="{!=({getArray(RP_FEC,FEC_SUBMIT,LOCK,0,{$user_id},0,lock)},Lock)}">
                <ReportItem id="lock" type="Static">
                    <![CDATA[
                        <td align='center'>Not Locked</td>
                    ]]>
                </ReportItem>
            </ReportItemSet>
            <ReportItem id="recommendation" type="static">
                <![CDATA[
                        <td align='center'>
                ]]>
            </ReportItem>
            <ReportItemSet id="if_dr" type="If" if="{contains({$user_sub_roles},Dean's Recommendation)}">
                <ReportItem id="dr" type="PDFReportItem" reportType="ChairTable" section="Recommendations" class="downloadButton{$user_id}" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                    <![CDATA[
                            {$item} <a class="viewEvaluation" style="cursor:pointer;" data-href='{$wgServer}{$wgScriptPath}/index.php/Special:Report?report=ChairTable&section=Recommendations&userId={$user_id}'>Dean's Recommendation</a><br />
                    ]]>
                </ReportItem>
            </ReportItemSet>
            <ReportItemSet id="if_da" type="If" if="{contains({$user_sub_roles},Dean's Advice)}">
                <ReportItem id="da" type="PDFReportItem" reportType="ChairTable" section="Dean Advice" class="downloadButton{$user_id}" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                    <![CDATA[
                            {$item} <a class="viewDA" style="cursor:pointer;" data-href='{$wgServer}{$wgScriptPath}/index.php/Special:Report?report=ChairTable&section=Dean+Advice&userId={$user_id}'>Dean's Advice</a><br />
                    ]]>
                </ReportItem>
            </ReportItemSet>
            <ReportItemSet id="if_dd" type="If" if="{contains({$user_sub_roles},Dean's Decision)}">
                <ReportItem id="dd" type="PDFReportItem" reportType="ChairTable" section="Dean Decision" class="downloadButton{$user_id}" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                    <![CDATA[
                            {$item} <a class="viewDD" style="cursor:pointer;" data-href='{$wgServer}{$wgScriptPath}/index.php/Special:Report?report=ChairTable&section=Dean+Decision&userId={$user_id}'>Dean's Decision</a><br />
                    ]]>
                </ReportItem>
            </ReportItemSet>
            <ReportItem id="ca_download" type="PDFReportItem" reportType="ChairTable" section="Chair Advice" noRenderIfNull="true" class="downloadButton{$user_id}" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                <![CDATA[
                        {$item} Chair's Advice<br />
                ]]>
            </ReportItem>
            <ReportItemSet id="if_dr" type="If" if="{contains({$user_sub_roles},Dean's Recommendation)}">
                <ReportItem id="submit" type="SimpleReviewSubmit" section="Recommendations" userId="{$user_id}" onlyGenerate="true" specialDownload=".downloadButton{$user_id}">
                    <![CDATA[
                        {$item}
                    ]]>
                </ReportItem>
            </ReportItemSet>
            <ReportItemSet id="if_da" type="If" if="{contains({$user_sub_roles},Dean's Advice)}">
                <ReportItem id="submit" type="SimpleReviewSubmit" section="Dean Advice" userId="{$user_id}" onlyGenerate="true" specialDownload=".downloadButton{$user_id}">
                    <![CDATA[
                        {$item}
                    ]]>
                </ReportItem>
            </ReportItemSet>
            <ReportItemSet id="if_dd" type="If" if="{contains({$user_sub_roles},Dean's Decision)}">
                <ReportItem id="submit" type="SimpleReviewSubmit" section="Dean Decision" userId="{$user_id}" onlyGenerate="true" specialDownload=".downloadButton{$user_id}">
                    <![CDATA[
                        {$item}
                    ]]>
                </ReportItem>
            </ReportItemSet>
            <ReportItemSet id="if_dean" type="If" if="{!contains({$my_roles},DeanEA)}">
                <ReportItemSet id="if_dr" type="If" if="{contains({$user_sub_roles},Dean's Recommendation)}">
                    <ReportItem id="increment" type="Increment" blobItem="INCREMENT" blobSection="FEC_REVIEW" blobSubItem="{$user_id}" width="50px">
                        <![CDATA[
                                </td>
                                <td align='center' valign='middle' class='increment' style="white-space:nowrap;">{$item}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="tenure" type="Tenure" blobItem="TENURE" blobSection="FEC_REVIEW" blobSubItem="{$user_id}" width="200px">
                        <![CDATA[
                                <td align='center' class='tenure'>{$item}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="promotion" type="Promotion" blobItem="PROMOTION" blobSection="FEC_REVIEW" blobSubItem="{$user_id}" width="200px">
                        <![CDATA[
                                <td align='center' class='promotion'>{$item}</td>
                            </tr>
                        ]]>
                    </ReportItem>
                </ReportItemSet>
                <ReportItemSet id="if_da" type="If" if="{contains({$user_sub_roles},Dean's Advice)}">
                    <ReportItem id="increment" type="Increment" blobItem="INCREMENT" blobSection="FEC_DEAN_ADVICE" blobSubItem="{$user_id}" width="50px">
                        <![CDATA[
                                </td>
                                <td align='center' valign='middle' class='increment' style="white-space:nowrap;">{$item}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="tenure" type="Tenure" blobItem="TENURE" blobSection="FEC_DEAN_ADVICE" blobSubItem="{$user_id}" width="200px">
                        <![CDATA[
                                <td align='center' class='tenure'>{$item}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="promotion" type="Promotion" blobItem="PROMOTION" blobSection="FEC_DEAN_ADVICE" blobSubItem="{$user_id}" width="200px">
                        <![CDATA[
                                <td align='center' class='promotion'>{$item}</td>
                            </tr>
                        ]]>
                    </ReportItem>
                </ReportItemSet>
                <ReportItemSet id="if_dd" type="If" if="{contains({$user_sub_roles},Dean's Decision)}">
                    <ReportItem id="increment" type="Increment" blobItem="INCREMENT" blobSection="FEC_DEAN_DECISION" blobSubItem="{$user_id}" width="50px">
                        <![CDATA[
                                </td>
                                <td align='center' valign='middle' class='increment' style="white-space:nowrap;">{$item}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="tenure" type="Tenure" blobItem="TENURE" blobSection="FEC_DEAN_DECISION" blobSubItem="{$user_id}" width="200px">
                        <![CDATA[
                                <td align='center' class='tenure'>{$item}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="promotion" type="Promotion" blobItem="PROMOTION" blobSection="FEC_DEAN_DECISION" blobSubItem="{$user_id}" width="200px">
                        <![CDATA[
                                <td align='center' class='promotion'>{$item}</td>
                            </tr>
                        ]]>
                    </ReportItem>
                </ReportItemSet>
            </ReportItemSet>
            <ReportItemSet id="if_ea" type="If" if="{contains({$my_roles},DeanEA)}">
                <ReportItemSet id="if_dr" type="If" if="{contains({$user_sub_roles},Dean's Recommendation)}">
                    <ReportItem id="increment" type="Increment" blobItem="INCREMENT" blobSection="FEC_REVIEW" blobSubItem="{$user_id}" width="50px">
                        <![CDATA[
                                </td>
                                <td align='center' valign='middle' class='increment' style="white-space:nowrap;">{$value}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="tenure" type="Tenure" blobItem="TENURE" blobSection="FEC_REVIEW" blobSubItem="{$user_id}" width="200px">
                        <![CDATA[
                                <td align='center' class='tenure'>{$value}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="promotion" type="Promotion" blobItem="PROMOTION" blobSection="FEC_REVIEW" blobSubItem="{$user_id}" width="200px">
                        <![CDATA[
                                <td align='center' class='promotion'>{$value}</td>
                            </tr>
                        ]]>
                    </ReportItem>
                </ReportItemSet>
                <ReportItemSet id="if_da" type="If" if="{contains({$user_sub_roles},Dean's Advice)}">
                    <ReportItem id="increment" type="Increment" blobItem="INCREMENT" blobSection="FEC_DEAN_ADVICE" blobSubItem="{$user_id}" width="50px">
                        <![CDATA[
                                </td>
                                <td align='center' valign='middle' class='increment' style="white-space:nowrap;">{$value}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="tenure" type="Tenure" blobItem="TENURE" blobSection="FEC_DEAN_ADVICE" blobSubItem="{$user_id}" width="200px">
                        <![CDATA[
                                <td align='center' class='tenure'>{$value}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="promotion" type="Promotion" blobItem="PROMOTION" blobSection="FEC_DEAN_ADVICE" blobSubItem="{$user_id}" width="200px">
                        <![CDATA[
                                <td align='center' class='promotion'>{$value}</td>
                            </tr>
                        ]]>
                    </ReportItem>
                </ReportItemSet>
                <ReportItemSet id="if_dd" type="If" if="{contains({$user_sub_roles},Dean's Decision)}">
                    <ReportItem id="increment" type="Increment" blobItem="INCREMENT" blobSection="FEC_DEAN_DECISION" blobSubItem="{$user_id}" width="50px">
                        <![CDATA[
                                </td>
                                <td align='center' valign='middle' class='increment' style="white-space:nowrap;">{$value}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="tenure" type="Tenure" blobItem="TENURE" blobSection="FEC_DEAN_DECISION" blobSubItem="{$user_id}" width="200px">
                        <![CDATA[
                                <td align='center' class='tenure'>{$value}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="promotion" type="Promotion" blobItem="PROMOTION" blobSection="FEC_DEAN_DECISION" blobSubItem="{$user_id}" width="200px">
                        <![CDATA[
                                <td align='center' class='promotion'>{$value}</td>
                            </tr>
                        ]]>
                    </ReportItem>
                </ReportItemSet>
            </ReportItemSet>
        </ReportItemSet>
        <ReportItem id="tfoot" type="Static">
            <![CDATA[
                    </tbody>
                </table><br />
                <table class='wikitable' frame='box' rules='all'>
                    <tr>
                        <th>Year</th>
                        <th>Average<br />Faculty Increment</th>
                        <th>Average<br />FSO Increment</th>
                    </tr>
                    <tr>
                        <td><b>{$this_year}</b></td>
                        <td id='averageFac' align='right'></td>
                        <td id='averageFSO' align='right'></td>
                    </tr>
                    <tr>
                        <td><b>{subtract({$this_year},1)}</b></td>
                        <td id='averageFac{subtract({$this_year},1)}' align='right'></td>
                        <td id='averageFSO{subtract({$this_year},1)}' align='right'></td>
                    </tr>
                    <tr>
                        <td><b>{subtract({$this_year},2)}</b></td>
                        <td id='averageFac{subtract({$this_year},2)}' align='right'></td>
                        <td id='averageFSO{subtract({$this_year},2)}' align='right'></td>
                    </tr>
                    <tr>
                        <td><b>{subtract({$this_year},3)}</b></td>
                        <td id='averageFac{subtract({$this_year},3)}' align='right'></td>
                        <td id='averageFSO{subtract({$this_year},3)}' align='right'></td>
                    </tr>
                    <tr>
                        <td><b>{subtract({$this_year},4)}</b></td>
                        <td id='averageFac{subtract({$this_year},4)}' align='right'></td>
                        <td id='averageFSO{subtract({$this_year},4)}' align='right'></td>
                    </tr>
                    <tr>
                        <td><b>{subtract({$this_year},5)}</b></td>
                        <td id='averageFac{subtract({$this_year},5)}' align='right'></td>
                        <td id='averageFSO{subtract({$this_year},5)}' align='right'></td>
                    </tr>
                    <tr>
                        <td><b>{subtract({$this_year},6)}</b></td>
                        <td id='averageFac{subtract({$this_year},6)}' align='right'></td>
                        <td id='averageFSO{subtract({$this_year},6)}' align='right'></td>
                    </tr>
                </table>
                <small>Averages are based on the people currently in the table, so previous averages may differ slightly as it does not factor in people who are no longer in the department</small>
                <script type='text/javascript'>
                    $('#chairTable').dataTable({
                        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                        "iDisplayLength": -1
                    });
                    
                    $(".viewEvaluation").click(function(){
                        var href = $(this).attr('data-href');
                        $("#Recommendations").attr('href', href);
                        $("#Recommendations").trigger('click');
                    });
                    
                    $(".viewCA").click(function(){
                        var href = $(this).attr('data-href');
                        $("#ChairAdvice").attr('href', href);
                        $("#ChairAdvice").trigger('click');
                    });
                    
                    $(".viewDA").click(function(){
                        var href = $(this).attr('data-href');
                        $("#DeanAdvice").attr('href', href);
                        $("#DeanAdvice").trigger('click');
                    });
                    
                    $(".viewDD").click(function(){
                        var href = $(this).attr('data-href');
                        $("#DeanDecision").attr('href', href);
                        $("#DeanDecision").trigger('click');
                    });
                    
                    $(".increment select").change(function(){
                        var fac_sum = 0;
                        var fac_count = 0;
                        var fso_sum = 0;
                        var fso_count = 0;
                        $(".increment select").each(function(i, el){
                            var tr = $(el).closest("tr");
                            if($(el).val() != "" && $(el).val() != "0.00 (PTC)"){
                                if($(tr).attr('data-fecid').includes("A") ||
                                   $(tr).attr('data-fecid').includes("B") ||
                                   $(tr).attr('data-fecid').includes("C") ||
                                   $(tr).attr('data-fecid').includes("N")){
                                    fac_sum += parseFloat($(el).val());
                                    fac_count++;
                                }
                                else if($(tr).attr('data-fecid').includes("D") ||
                                        $(tr).attr('data-fecid').includes("E") ||
                                        $(tr).attr('data-fecid').includes("F") ||
                                        $(tr).attr('data-fecid').includes("M")){
                                    fso_sum += parseFloat($(el).val());
                                    fso_count++;
                                }
                            }
                        });
                        $('#averageFac').html((fac_sum/Math.max(1, fac_count)).toFixed(3));
                        $('#averageFSO').html((fso_sum/Math.max(1, fso_count)).toFixed(3));
                    });
                    
                    var increments = new Array();
                    var fac_counts = new Array();
                    var fac_sums = new Array();

                    var fso_counts = new Array();
                    var fso_sums = new Array();
                    
                    increments[{subtract({$this_year},1)}] = $(".increment{subtract({$this_year},1)}");
                    increments[{subtract({$this_year},2)}] = $(".increment{subtract({$this_year},2)}");
                    increments[{subtract({$this_year},3)}] = $(".increment{subtract({$this_year},3)}");
                    increments[{subtract({$this_year},4)}] = $(".increment{subtract({$this_year},4)}");
                    increments[{subtract({$this_year},5)}] = $(".increment{subtract({$this_year},5)}");
                    increments[{subtract({$this_year},6)}] = $(".increment{subtract({$this_year},6)}");
                    
                    _.each(increments, function(increment, i){
                        fac_counts[i] = 0;
                        fac_sums[i] = 0;
                        fso_counts[i] = 0;
                        fso_sums[i] = 0;
                        $(increment).each(function(j, el){
                            var table = $(el).closest("table");
                            var val = $(el).text();
                            if(val != "N/A" && val != "" && val != "0.00 (PTC)"){
                                if($(table).attr('data-fecid').includes("A") ||
                                   $(table).attr('data-fecid').includes("B") ||
                                   $(table).attr('data-fecid').includes("C") ||
                                   $(table).attr('data-fecid').includes("N")){
                                    fac_sums[i] += parseFloat(val);
                                    fac_counts[i]++;
                                }
                                else if($(table).attr('data-fecid').includes("D") ||
                                        $(table).attr('data-fecid').includes("E") ||
                                        $(table).attr('data-fecid').includes("F") ||
                                        $(table).attr('data-fecid').includes("M")){
                                    fso_sums[i] += parseFloat(val);
                                    fso_counts[i]++;
                                }
                            }
                        });
                        $('#averageFac' + i).html((fac_sums[i]/Math.max(1, fac_counts[i])).toFixed(3));
                        $('#averageFSO' + i).html((fso_sums[i]/Math.max(1, fso_counts[i])).toFixed(3));
                    });
                    $(".increment select").first().trigger('change');
                </script>
                <script type='text/javascript' src='{$wgServer}{$wgScriptPath}/extensions/Reporting/Report/scripts/recommendations.js'></script>
            ]]>
        </ReportItem>
    </ReportSection>
    <ReportSection id="recommendations" tooltip="Recommendation for Academic Staff Member" name="Recommendations" title="" blobSection="FEC_REVIEW" type="EditableReportSection" pagebreak="false" disabled="true">
        <ReportItemSet id="header" type="PersonReportItemSet" userId="{GET(userId)}">
            <ReportItemSet id="if" type="If" if="{or({==({$user_dept},{$my_dept})},
                                                     {contains({$my_roles},ADMIN)},
                                                     {contains({$my_roles},DEAN)},
                                                     {contains({$my_roles},DEANEA)})}">
                <ReportItemSet id="faculty" type="DepartmentPeopleReportItemSet" department="{$my_dept}" start="{$last_year}-07-01" end="{$this_year}-07-01" university="University of Alberta">
                    <ReportItemSet id="if" type="If" if="{==({$user_id},{$parent_id})}">
                        <ReportItem id="code" type="Static">
                            <![CDATA[
                                <div id='generated' style="position:absolute; top:-1.75em;right:0;text-align:right;">{getExtra()} / {$user_name}<br /><i>Generated: {$timestamp}</i></div>
                                <script type='text/javascript'>
                                    $('#generated').after("<div style='position:absolute;top:0;right:0;padding: 20px 20px 0 100px;background:white;'>{getExtra()} / {$user_name}</div>");
                                </script>
                            ]]>
                        </ReportItem>
                    </ReportItemSet>
                </ReportItemSet>
                <ReportItem id="download" type="PDFReportItem" reportType="FECpdf" height="385px" embed="true">
                    <![CDATA[
                        <h1 style="margin-top:0;padding-top:0;">Recommendation for {$user_name}</h1>
                        <script type="text/javascript">
                            $("#reportMain form.autosave").attr("action", $("#reportMain form.autosave").attr("action") + "&userId={GET(userId)}");
                        </script>
                    ]]>
                </ReportItem>
                <ReportItemSet id="header" type="ToggleHeader" title="Annual Report">
                    <ReportItem id="sticky" type="StickyNotes" blobType="BLOB_ARRAY" blobItem="STICKY" blobSubItem="{$user_id}" reportType="FECpdf" >
                        <![CDATA[
                            Instructions:
                            <ul>
                                <li>Click on a word in the document below to annotate it with a "Sticky Note".  (Only words in headers can have a sticky note added)</li>
                                <li>To delete an annotation, delete any text in the annotation and press the 'X' icon.</li>
                                <li>Make sure to press the "Save" button at the bottom of the page after you have made changes.</li>
                            </ul>
                            {$item}
                        ]]>
                    </ReportItem>
                </ReportItemSet>
                <ReportItem id="teaching" type="Textarea" blobType="BLOB_TEXT" blobItem="TEACHING" blobSubItem="{$user_id}">
                    <![CDATA[
                        <h2>Teaching Evaluations</h2>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="research" type="Textarea" blobType="BLOB_TEXT" blobItem="RESEARCH" blobSubItem="{$user_id}">
                    <![CDATA[
                        <h2>Research Evaluations</h2>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="departmental" type="Textarea" blobType="BLOB_TEXT" blobItem="DEPARTMENTAL" blobSubItem="{$user_id}" height="100px">
                    <![CDATA[
                        <h2>Service/Committees Evaluations</h2>
                        <h3>Departmental</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="faculty" type="Textarea" blobType="BLOB_TEXT" blobItem="FACULTY" blobSubItem="{$user_id}" height="100px">
                    <![CDATA[
                        <h3>Faculty</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="university" type="Textarea" blobType="BLOB_TEXT" blobItem="UNIVERSITY" blobSubItem="{$user_id}" height="100px">
                    <![CDATA[
                        <h3>University</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="scientific" type="Textarea" blobType="BLOB_TEXT" blobItem="SCIENTIFIC" blobSubItem="{$user_id}" height="100px">
                    <![CDATA[
                        <h3>Scientific</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="community" type="Textarea" blobType="BLOB_TEXT" blobItem="COMMUNITY" blobSubItem="{$user_id}" height="100px">
                    <![CDATA[
                        <h3>Community Outreach</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="other" type="Textarea" blobType="BLOB_TEXT" blobItem="OTHER" blobSubItem="{$user_id}" height="100px">
                    <![CDATA[
                        <h3>Other</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="general" type="Textarea" blobType="BLOB_TEXT" blobItem="GENERAL" blobSubItem="{$user_id}">
                    <![CDATA[
                        <h2>General Comments</h2>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="increment" type="Increment" blobItem="INCREMENT" blobSubItem="{$user_id}" width="100%">
                    <![CDATA[
                        <h3>Recommendations</h3>
                        <table id="chairTable" class="wikitable" width="100%">
                        <thead>
                            <tr>
                                <th>Increment</th>
                                <th>Tenure</th>
                                <th>Promotion</th>
                            </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td align='center' valign='middle' class='increment' style="white-space:nowrap;">{$item}</td>
                    ]]>
                </ReportItem>
                <ReportItem id="tenure" type="Tenure" blobItem="TENURE" blobSubItem="{$user_id}" width="100%">
                    <![CDATA[
                            <td align='center' class='tenure'>{$item}</td>
                    ]]>
                </ReportItem>
                <ReportItem id="promotion" type="Promotion" blobItem="PROMOTION" blobSubItem="{$user_id}" width="100%">
                    <![CDATA[
                            <td align='center' class='promotion'>{$item}</td>
                        </tr>
                        </tbody>
                        </table>
                        <hr class="pdfnodisplay" />
                        <script type='text/javascript' src='{$wgServer}{$wgScriptPath}/extensions/Reporting/Report/scripts/recommendations.js'></script>
                    ]]>
                </ReportItem>
                <ReportItem id="submit" type="SimpleReviewSubmit" section="Recommendations" userId="{$user_id}">
                    <![CDATA[
                        {$item}
                    ]]>
                </ReportItem>
            </ReportItemSet>
            <ReportItemSet id="else" type="If" if="{and({!=({$user_dept},{$my_dept})},
                                                        {!contains({$my_roles},ADMIN)},
                                                        {!contains({$my_roles},DEAN)},
                                                        {!contains({$my_roles},DEANEA)})}">
                <ReportItem id="else" type="Static">
                    <![CDATA[
                        <p>You are not allowed to view the recommendations for this user.</p>
                    ]]>
                </ReportItem>
            </ReportItemSet>
        </ReportItemSet>
    </ReportSection>
    <ReportSection id="deans_advice" tooltip="Dean's Advice for Academic Staff Member" name="Dean Advice" title="" blobSection="FEC_DEAN_ADVICE" type="EditableReportSection" pagebreak="false" disabled="true">
        <ReportItemSet id="header" type="PersonReportItemSet" userId="{GET(userId)}">
            <ReportItemSet id="if" type="If" if="{or({==({$user_dept},{$my_dept})},
                                                     {contains({$my_roles},ADMIN)},
                                                     {contains({$my_roles},DEAN)},
                                                     {contains({$my_roles},DEANEA)})}">
                <ReportItemSet id="faculty" type="DeansPeopleReportItemSet" start="{$last_year}-07-01" end="{$this_year}-07-01">
                    <ReportItemSet id="if" type="If" if="{==({$user_id},{$parent_id})}">
                        <ReportItem id="code" type="Static">
                            <![CDATA[
                                <div style="position:absolute; top:-1.75em;right:0;text-align:right;">{getExtra()} / {$user_name}<br /><i>Generated: {$timestamp}</i></div>
                                <div class="pdfnodisplay" style="position:absolute;top:0;right:0;padding: 20px 20px 0 50px;background:white;">{getExtra()} / {$user_name}</div>
                            ]]>
                        </ReportItem>
                    </ReportItemSet>
                </ReportItemSet>
                <ReportItem id="download" type="PDFReportItem" reportType="FECpdf" height="385px" embed="true">
                    <![CDATA[
                        <h1 style="margin-top:0;padding-top:0;">Dean's Advice for {$user_name}</h1>
                        <script type="text/javascript">
                            $("#reportMain form.autosave").attr("action", $("#reportMain form.autosave").attr("action") + "&userId={GET(userId)}");
                        </script>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="teaching" type="Textarea" blobType="BLOB_TEXT" blobItem="TEACHING" blobSubItem="{$user_id}">
                    <![CDATA[
                        <h2>Teaching Evaluations</h2>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="research" type="Textarea" blobType="BLOB_TEXT" blobItem="RESEARCH" blobSubItem="{$user_id}">
                    <![CDATA[
                        <h2>Research Evaluations</h2>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="departmental" type="Textarea" blobType="BLOB_TEXT" blobItem="DEPARTMENTAL" blobSubItem="{$user_id}" height="100px">
                    <![CDATA[
                        <h2>Service/Committees Evaluations</h2>
                        <h3>Departmental</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="faculty" type="Textarea" blobType="BLOB_TEXT" blobItem="FACULTY" blobSubItem="{$user_id}" height="100px">
                    <![CDATA[
                        <h3>Faculty</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="university" type="Textarea" blobType="BLOB_TEXT" blobItem="UNIVERSITY" blobSubItem="{$user_id}" height="100px">
                    <![CDATA[
                        <h3>University</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="scientific" type="Textarea" blobType="BLOB_TEXT" blobItem="SCIENTIFIC" blobSubItem="{$user_id}" height="100px">
                    <![CDATA[
                        <h3>Scientific</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="community" type="Textarea" blobType="BLOB_TEXT" blobItem="COMMUNITY" blobSubItem="{$user_id}" height="100px">
                    <![CDATA[
                        <h3>Community Outreach</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="other" type="Textarea" blobType="BLOB_TEXT" blobItem="OTHER" blobSubItem="{$user_id}" height="100px">
                    <![CDATA[
                        <h3>Other</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="general" type="Textarea" blobType="BLOB_TEXT" blobItem="GENERAL" blobSubItem="{$user_id}">
                    <![CDATA[
                        <h2>General Comments</h2>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="increment" type="Increment" blobItem="INCREMENT" blobSubItem="{$user_id}" width="100%">
                    <![CDATA[
                        <h3>Recommendations</h3>
                        <table id="chairTable" class="wikitable" width="100%">
                        <thead>
                            <tr>
                                <th>Increment</th>
                                <th>Tenure</th>
                                <th>Promotion</th>
                            </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td align='center' valign='middle' class='increment' style="white-space:nowrap;">{$item}</td>
                    ]]>
                </ReportItem>
                <ReportItem id="tenure" type="Tenure" blobItem="TENURE" blobSubItem="{$user_id}" width="100%">
                    <![CDATA[
                            <td align='center' class='tenure'>{$item}</td>
                    ]]>
                </ReportItem>
                <ReportItem id="promotion" type="Promotion" blobItem="PROMOTION" blobSubItem="{$user_id}" width="100%">
                    <![CDATA[
                            <td align='center' class='promotion'>{$item}</td>
                        </tr>
                        </tbody>
                        </table>
                        <hr class="pdfnodisplay" />
                        <script type='text/javascript' src='{$wgServer}{$wgScriptPath}/extensions/Reporting/Report/scripts/recommendations.js'></script>
                    ]]>
                </ReportItem>
                <ReportItem id="submit" type="SimpleReviewSubmit" section="Dean Advice" userId="{$user_id}">
                    <![CDATA[
                        {$item}
                    ]]>
                </ReportItem>
            </ReportItemSet>
            <ReportItemSet id="else" type="If" if="{and({!=({$user_dept},{$my_dept})},
                                                        {!contains({$my_roles},ADMIN)},
                                                        {!contains({$my_roles},DEAN)},
                                                        {!contains({$my_roles},DEANEA)})}">
                <ReportItem id="else" type="Static">
                    <![CDATA[
                        <p>You are not allowed to view the recommendations for this user.</p>
                    ]]>
                </ReportItem>
            </ReportItemSet>
        </ReportItemSet>
    </ReportSection>
    <ReportSection id="deans_decision" tooltip="Dean's Decision for Academic Staff Member" name="Dean Decision" title="" blobSection="FEC_DEAN_DECISION" type="EditableReportSection" pagebreak="false" disabled="true">
        <ReportItemSet id="header" type="PersonReportItemSet" userId="{GET(userId)}">
            <ReportItemSet id="if" type="If" if="{or({==({$user_dept},{$my_dept})},
                                                     {contains({$my_roles},ADMIN)},
                                                     {contains({$my_roles},DEAN)},
                                                     {contains({$my_roles},DEANEA)})}">
                <ReportItemSet id="faculty" type="DeansPeopleReportItemSet" start="{$last_year}-07-01" end="{$this_year}-07-01">
                    <ReportItemSet id="if" type="If" if="{==({$user_id},{$parent_id})}">
                        <ReportItem id="code" type="Static">
                            <![CDATA[
                                <div style="position:absolute; top:-1.75em;right:0;text-align:right;">{getExtra()} / {$user_name}<br /><i>Generated: {$timestamp}</i></div>
                                <div class="pdfnodisplay" style="position:absolute;top:0;right:0;padding: 20px 20px 0 50px;background:white;">{getExtra()} / {$user_name}</div>
                            ]]>
                        </ReportItem>
                    </ReportItemSet>
                </ReportItemSet>
                <ReportItem id="download" type="PDFReportItem" reportType="FECpdf" height="385px" embed="true">
                    <![CDATA[
                        <h1 style="margin-top:0;padding-top:0;">Dean's Decision for {$user_name}</h1>
                        <script type="text/javascript">
                            $("#reportMain form.autosave").attr("action", $("#reportMain form.autosave").attr("action") + "&userId={GET(userId)}");
                        </script>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="teaching" type="Textarea" blobType="BLOB_TEXT" blobItem="TEACHING" blobSubItem="{$user_id}">
                    <![CDATA[
                        <h2>Teaching Evaluations</h2>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="research" type="Textarea" blobType="BLOB_TEXT" blobItem="RESEARCH" blobSubItem="{$user_id}">
                    <![CDATA[
                        <h2>Research Evaluations</h2>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="departmental" type="Textarea" blobType="BLOB_TEXT" blobItem="DEPARTMENTAL" blobSubItem="{$user_id}" height="100px">
                    <![CDATA[
                        <h2>Service/Committees Evaluations</h2>
                        <h3>Departmental</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="faculty" type="Textarea" blobType="BLOB_TEXT" blobItem="FACULTY" blobSubItem="{$user_id}" height="100px">
                    <![CDATA[
                        <h3>Faculty</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="university" type="Textarea" blobType="BLOB_TEXT" blobItem="UNIVERSITY" blobSubItem="{$user_id}" height="100px">
                    <![CDATA[
                        <h3>University</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="scientific" type="Textarea" blobType="BLOB_TEXT" blobItem="SCIENTIFIC" blobSubItem="{$user_id}" height="100px">
                    <![CDATA[
                        <h3>Scientific</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="community" type="Textarea" blobType="BLOB_TEXT" blobItem="COMMUNITY" blobSubItem="{$user_id}" height="100px">
                    <![CDATA[
                        <h3>Community Outreach</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="other" type="Textarea" blobType="BLOB_TEXT" blobItem="OTHER" blobSubItem="{$user_id}" height="100px">
                    <![CDATA[
                        <h3>Other</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="general" type="Textarea" blobType="BLOB_TEXT" blobItem="GENERAL" blobSubItem="{$user_id}">
                    <![CDATA[
                        <h2>General Comments</h2>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="increment" type="Increment" blobItem="INCREMENT" blobSubItem="{$user_id}" width="100%">
                    <![CDATA[
                        <h3>Recommendations</h3>
                        <table id="chairTable" class="wikitable" width="100%">
                        <thead>
                            <tr>
                                <th>Increment</th>
                                <th>Tenure</th>
                                <th>Promotion</th>
                            </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td align='center' valign='middle' class='increment' style="white-space:nowrap;">{$item}</td>
                    ]]>
                </ReportItem>
                <ReportItem id="tenure" type="Tenure" blobItem="TENURE" blobSubItem="{$user_id}" width="100%">
                    <![CDATA[
                            <td align='center' class='tenure'>{$item}</td>
                    ]]>
                </ReportItem>
                <ReportItem id="promotion" type="Promotion" blobItem="PROMOTION" blobSubItem="{$user_id}" width="100%">
                    <![CDATA[
                            <td align='center' class='promotion'>{$item}</td>
                        </tr>
                        </tbody>
                        </table>
                        <hr class="pdfnodisplay" />
                        <script type='text/javascript' src='{$wgServer}{$wgScriptPath}/extensions/Reporting/Report/scripts/recommendations.js'></script>
                    ]]>
                </ReportItem>
                <ReportItem id="submit" type="SimpleReviewSubmit" section="Dean Decision" userId="{$user_id}">
                    <![CDATA[
                        {$item}
                    ]]>
                </ReportItem>
            </ReportItemSet>
            <ReportItemSet id="else" type="If" if="{and({!=({$user_dept},{$my_dept})},
                                                        {!contains({$my_roles},ADMIN)},
                                                        {!contains({$my_roles},DEAN)},
                                                        {!contains({$my_roles},DEANEA)})}">
                <ReportItem id="else" type="Static">
                    <![CDATA[
                        <p>You are not allowed to view the recommendations for this user.</p>
                    ]]>
                </ReportItem>
            </ReportItemSet>
        </ReportItemSet>
    </ReportSection>
    <ReportSection id="chairs_advice" tooltip="Chair's Advice for Academic Staff Member" name="Chair Advice" title="" blobSection="FEC_CHAIR_ADVICE" type="EditableReportSection" pagebreak="false" disabled="true">
        <ReportItemSet id="header" type="PersonReportItemSet" userId="{GET(userId)}">
            <ReportItemSet id="if" type="If" if="{or({==({$user_dept},{$my_dept})},
                                                     {contains({$my_roles},ADMIN)},
                                                     {contains({$my_roles},DEAN)},
                                                     {contains({$my_roles},DEANEA)})}">
                <ReportItemSet id="faculty" type="DepartmentPeopleReportItemSet" department="{$my_dept}" start="{$last_year}-07-01" end="{$this_year}-07-01" university="University of Alberta">
                    <ReportItemSet id="if" type="If" if="{==({$user_id},{$parent_id})}">
                        <ReportItem id="code" type="Static">
                            <![CDATA[
                                <div style="position:absolute; top:-1.75em;right:0;text-align:right;">{getExtra()} / {$user_name}<br /><i>Generated: {$timestamp}</i></div>
                                <div class="pdfnodisplay" style="position:absolute;top:0;right:0;padding: 20px 20px 0 50px;background:white;">{getExtra()} / {$user_name}</div>
                            ]]>
                        </ReportItem>
                    </ReportItemSet>
                </ReportItemSet>
                <ReportItem id="download" type="PDFReportItem" reportType="FECpdf" height="385px" embed="true">
                    <![CDATA[
                        <h1 style="margin-top:0;padding-top:0;">Chair's Advice for {$user_name}</h1>
                        <script type="text/javascript">
                            $("#reportMain form.autosave").attr("action", $("#reportMain form.autosave").attr("action") + "&userId={GET(userId)}");
                        </script>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="teaching" type="Textarea" blobType="BLOB_TEXT" blobItem="TEACHING" blobSubItem="{$user_id}">
                    <![CDATA[
                        <h2>Teaching Evaluations</h2>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="research" type="Textarea" blobType="BLOB_TEXT" blobItem="RESEARCH" blobSubItem="{$user_id}">
                    <![CDATA[
                        <h2>Research Evaluations</h2>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="departmental" type="Textarea" blobType="BLOB_TEXT" blobItem="DEPARTMENTAL" blobSubItem="{$user_id}" height="100px">
                    <![CDATA[
                        <h2>Service/Committees Evaluations</h2>
                        <h3>Departmental</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="faculty" type="Textarea" blobType="BLOB_TEXT" blobItem="FACULTY" blobSubItem="{$user_id}" height="100px">
                    <![CDATA[
                        <h3>Faculty</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="university" type="Textarea" blobType="BLOB_TEXT" blobItem="UNIVERSITY" blobSubItem="{$user_id}" height="100px">
                    <![CDATA[
                        <h3>University</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="scientific" type="Textarea" blobType="BLOB_TEXT" blobItem="SCIENTIFIC" blobSubItem="{$user_id}" height="100px">
                    <![CDATA[
                        <h3>Scientific</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="community" type="Textarea" blobType="BLOB_TEXT" blobItem="COMMUNITY" blobSubItem="{$user_id}" height="100px">
                    <![CDATA[
                        <h3>Community Outreach</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="other" type="Textarea" blobType="BLOB_TEXT" blobItem="OTHER" blobSubItem="{$user_id}" height="100px">
                    <![CDATA[
                        <h3>Other</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="general" type="Textarea" blobType="BLOB_TEXT" blobItem="GENERAL" blobSubItem="{$user_id}">
                    <![CDATA[
                        <h2>General Comments</h2>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="increment" type="Increment" blobItem="INCREMENT" blobSubItem="{$user_id}" width="100%">
                    <![CDATA[
                        <h3>Recommendations</h3>
                        <table id="chairTable" class="wikitable" width="100%">
                        <thead>
                            <tr>
                                <th>Increment</th>
                                <th>Tenure</th>
                                <th>Promotion</th>
                            </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td align='center' valign='middle' class='increment' style="white-space:nowrap;">{$item}</td>
                    ]]>
                </ReportItem>
                <ReportItem id="tenure" type="Tenure" blobItem="TENURE" blobSubItem="{$user_id}" width="100%">
                    <![CDATA[
                            <td align='center' class='tenure'>{$item}</td>
                    ]]>
                </ReportItem>
                <ReportItem id="promotion" type="Promotion" blobItem="PROMOTION" blobSubItem="{$user_id}" width="100%">
                    <![CDATA[
                            <td align='center' class='promotion'>{$item}</td>
                        </tr>
                        </tbody>
                        </table>
                        <hr class="pdfnodisplay" />
                        <script type='text/javascript' src='{$wgServer}{$wgScriptPath}/extensions/Reporting/Report/scripts/recommendations.js'></script>
                    ]]>
                </ReportItem>
                <ReportItem id="submit" type="SimpleReviewSubmit" section="Chair Advice" userId="{$user_id}">
                    <![CDATA[
                        {$item}
                    ]]>
                </ReportItem>
            </ReportItemSet>
            <ReportItemSet id="else" type="If" if="{and({!=({$user_dept},{$my_dept})},
                                                        {!contains({$my_roles},ADMIN)},
                                                        {!contains({$my_roles},DEAN)},
                                                        {!contains({$my_roles},DEANEA)})}">
                <ReportItem id="else" type="Static">
                    <![CDATA[
                        <p>You are not allowed to view the recommendations for this user.</p>
                    ]]>
                </ReportItem>
            </ReportItemSet>
        </ReportItemSet>
    </ReportSection>
    <ReportSection id="dept_hqp" tooltip="HQP Inconsistencies" name="HQP Inconsistencies" title="{$my_dept} HQP Inconsistencies" blobSection="BLOB_NONE" type="ReportSection">
        <ReportItem id="header" type="Static">
            <![CDATA[
                <p>
                    Some inconsistencies related to HQP relations will be shown below<br />
                    <i><b>Note:</b> Because of how some relations may overlap, there could be some false positives.</i>
                </p>
            ]]>
        </ReportItem>
        <ReportItemSet id="faculty" type="DepartmentPeopleReportItemSet" department="{$my_dept}" start="{$last_year}-07-01" end="{$this_year}-07-01" university="University of Alberta" excludeMe="true">
            <ReportItem id="hqp" type="HQPInconsistencies" start="{$last_year}-07-01" end="{$this_year}-07-01">
                <![CDATA[
                    <h2>{$user_name}</h2>
                    {$item}
                ]]>
            </ReportItem>
        </ReportItemSet>
    </ReportSection>
    <ReportSection id="dept_publications" tooltip="Publications" name="Publications" title="{$my_dept} Publications" blobSection="BLOB_NONE" type="ReportSection">
        <ReportItem id="thead" type="Static">
            <![CDATA[
                <table id='products' class='wikitable' frame='box' rules='all'>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Type</th>
                            <th>Output</th>
                        </tr>
                    </thead>
                    <tbody>
            ]]>
        </ReportItem>
        <ReportItemSet id="faculty" type="DepartmentPeopleReportItemSet" department="{$my_dept}" start="{$last_year}-07-01" end="{$this_year}-07-01" university="University of Alberta" excludeMe="true">
            <ReportItemSet id="products" type="PersonProductsReportItemSet" category="Publication" useProductYear="true" includeHQP="false" start="CYCLE_START" end="CYCLE_END">
                <ReportItem id="row" type="Static">
                    <![CDATA[
                        <tr><td>{$user_name}</td><td>{$product_type}</td><td> {$product_citation}</td></tr>
                    ]]>
                </ReportItem>
            </ReportItemSet>
        </ReportItemSet>
        <ReportItem id="tfoot" type="Static">
            <![CDATA[
                    </tbody>
                </table>
                <script type='text/javascript'>
                    $('#products').dataTable({
                       'aLengthMenu': [[-1], ['All']],
                        'iDisplayLength': -1,
                        'dom': 'Blfrtip',
                        'buttons': [
                            'excel', 'pdf'
                        ]
                    });
                </script>
            ]]>
        </ReportItem>
    </ReportSection>
</Report>
