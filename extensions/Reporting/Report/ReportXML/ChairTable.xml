<?xml version="1.0" encoding="UTF-8" ?>
<Report name="Evaluations" title=" " headerName=" " reportType="RP_CHAIR" pdfFiles="ChairTable" pdfType="CHAIR_EVAL" personId="0" ajax="true" disabled="false" encrypt="true">
    <Permissions>
        <Role role="CHAIR">
            <SectionPermission id="evaluations" permissions="rw" />
            <SectionPermission id="dean_evaluations" permissions="" />
            <SectionPermission id="recommendations" permissions="rw" />
            <SectionPermission id="deans_advice" permissions="" />
            <SectionPermission id="deans_decision" permissions="" />
            <SectionPermission id="chairs_advice" permissions="rw" />
            <SectionPermission id="atsec" permissions="rw" />
            <SectionPermission id="dept_hqp" permissions="rw" />
            <SectionPermission id="sabbatical" permissions="rw" />
        </Role>
        <Role role="EA">
            <SectionPermission id="evaluations" permissions="rw" />
            <SectionPermission id="dean_evaluations" permissions="" />
            <SectionPermission id="recommendations" permissions="rw" />
            <SectionPermission id="deans_advice" permissions="" />
            <SectionPermission id="deans_decision" permissions="" />
            <SectionPermission id="chairs_advice" permissions="rw" />
            <SectionPermission id="atsec" permissions="rw" />
            <SectionPermission id="dept_hqp" permissions="rw" />
            <SectionPermission id="sabbatical" permissions="rw" />
        </Role>
        <Role role="DEAN">
            <SectionPermission id="evaluations" permissions="" />
            <SectionPermission id="dean_evaluations" permissions="rw" />
            <SectionPermission id="recommendations" permissions="rw" />
            <SectionPermission id="deans_advice" permissions="rw" />
            <SectionPermission id="deans_decision" permissions="rw" />
            <SectionPermission id="chairs_advice" permissions="" />
            <SectionPermission id="atsec" permissions="" />
            <SectionPermission id="dept_hqp" permissions="" />
            <SectionPermission id="sabbatical" permissions="" />
        </Role>
        <Role role="DEANEA">
            <SectionPermission id="evaluations" permissions="" />
            <SectionPermission id="dean_evaluations" permissions="rw" />
            <SectionPermission id="recommendations" permissions="rw" />
            <SectionPermission id="deans_advice" permissions="rw" />
            <SectionPermission id="deans_decision" permissions="rw" />
            <SectionPermission id="chairs_advice" permissions="" />
            <SectionPermission id="atsec" permissions="rw" />
            <SectionPermission id="dept_hqp" permissions="" />
            <SectionPermission id="sabbatical" permissions="" />
        </Role>
    </Permissions>
    <ReportSection id="evaluations" tooltip="Evaluations" name="Evaluations" title="{$my_dept} Evaluations" blobSection="FEC_REVIEW" type="EditableReportSection" pagebreak="false">
        <Static>
            <![CDATA[
                <style>
                    table#chairTable * {
                        font-size:11px !important;
                    }
                    .remove {
                        display: none;
                    }
                </style>
                <iframe id='downloadFrame' name='downloadFrame' src="" style="display:none;"></iframe>
                <div style='float:right; margin-top: -45px;display:flex;'>
                    <div><button id='downloadAllARs' class='noDisable' type='button'>Download All ARs</button></div>
                    <div><button id='generateAll' type='button'>Generate All Evals</button></div>
                    <div><button id='downloadAll' class='noDisable' type='button'>Download All Evals</button></div>
                </div>
                <script type='text/javascript'>
                    function postToIframe(data,url,target){
                        $('body').append('<form action="'+url+'" method="post" target="'+target+'" id="postToIframe"></form>');
                        $.each(data,function(n,v){
                            $('#postToIframe').append('<input type="hidden" name="'+n+'" value="'+v+'" />');
                        });
                        $('#postToIframe').submit().remove();
                    }
                    $('#downloadAllARs').click(function(){
                        var pdfs = $.makeArray($(".currentAR a:visible").map(function(i, pdf){ return $(pdf).attr('href');})).join(',').replaceAll(wgServer + wgScriptPath + '/index.php/Special:ReportArchive?getpdf=', '');
                        postToIframe({pdfs: pdfs}, wgServer + wgScriptPath + '/index.php?action=downloadReportZip', 'downloadFrame');
                    });
                    $('#generateAll').click(function(){
                        $('.generateButton').click();
                    });
                    $('#downloadAll').click(function(){
                        var pdfs = $.makeArray($(".recommendationPDF:visible").map(function(i, pdf){ return $(pdf).attr('href');})).join(',').replaceAll(wgServer + wgScriptPath + '/index.php/Special:ReportArchive?getpdf=', '');
                        postToIframe({pdfs: pdfs}, wgServer + wgScriptPath + '/index.php?action=downloadReportZip', 'downloadFrame');
                    });
                </script>
                <table id='chairTable' class='wikitable' frame='box' rules='all'>
                    <thead>
                        <tr>
                            <th>Case#</th>
                            <th>Name</th>
                            <th>Rank</th>
                            <th width="1%">{$2_years_ago} Report</th>
                            <th width="1%">{$last_year} Report</th>
                            <th width="1%">Annual Report</th>
                            <th width="1%">Locked</th>
                            <th style='white-space:nowrap;'>T/R/S/A<br />Variance</th>
                            <th>Evaluation</th>
                            <th width="1%">Merit Increment</th>
                            <th width="1%">Tenure</th>
                            <th width="1%">Promotion</th>
                    </thead>
                    <tbody>
            ]]>
        </Static>
        <ReportItemSet id="faculty" type="DepartmentPeopleReportItemSet" department="{$my_dept}" start="{$last_year}-07-01" end="{$this_year}-07-01" university="University of Alberta" excludeMe="true">
            <Static>
                <![CDATA[
                    <tr data-fecid="{getExtra()}">
                        <td>{getExtra()}</td>
                        <td><a href="{$user_url}" target="_blank">{$user_name}</a></td>
                        <td>{$user_level}</td>
                ]]>
            </Static>
            <ReportItem id="previous2_download" type="PDFReportItem" reportType="FECpdf" year="{$2_years_ago}" class="" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                <![CDATA[
                        <td align='center'>
                            {$item}
                        </td>
                ]]>
            </ReportItem>
            <ReportItem id="previous_download" type="PDFReportItem" reportType="FECpdf" year="{$last_year}" class="" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                <![CDATA[
                        <td align='center'>
                            {$item}
                        </td>
                ]]>
            </ReportItem>
            <ReportItem id="download" type="PDFReportItem" reportType="FECpdf" class="" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' /> &lt;span>AR&lt;/span>">
                <![CDATA[
                        <td align='left' class='currentAR'>
                            {$item}
                ]]>
            </ReportItem>
            <ReportItem id="downloadSPOT" type="PDFReportItem" reportType="SPOTs" class="" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' /> &lt;span>SPOTs&lt;/span>">
                <![CDATA[
                            <span {if("{$value}" == "", class='remove')}><br />{$item}</span>
                        </td>
                ]]>
            </ReportItem>
            <If id="if_lock" if="{==({getArray(RP_FEC,FEC_SUBMIT,LOCK,0,{$user_id},0,lock)},Lock)}">
                <ReportItem id="lock" type="Unlock" blobReport="RP_FEC" blobSection="FEC_SUBMIT" blobItem="LOCK" blobSubItem="0" personId="{$user_id}" blobType="BLOB_ARRAY" orientation="vertical" options="Lock">
                    <![CDATA[
                        <td style='white-space:nowrap;' align='center'>
                            <div id='lockContainer_{$user_id}' style='display:none;'>{$item}</div>
                            <button id='lock_{$user_id}' type="button" value="Save" name="submit">Unlock</button>
                            <script type="text/javascript">
                                $('#lock_{$user_id}').click(function(){
                                    if(confirm('Are you sure you want to proceed?\n\nThis annual report will be unlocked and the faculty member will be able to edit their report again.')){
                                        $('#lockContainer_{$user_id} input[type=checkbox]').prop('checked', false);
                                        $('#lock_{$user_id}').prop('disabled', true);
                                        $('#lock_{$user_id}').after("<span class='throbber'></span>");
                                        saveAll(function(){$("#Evaluations").click();});
                                    } else {
                                        $('#lockContainer_{$user_id} input[type=checkbox]').prop('checked', true);
                                    }
                                    return false;
                                });
                            </script>
                        </td>
                    ]]>
                </ReportItem>
            </If>
            <If id="if_not_lock" if="{!=({getArray(RP_FEC,FEC_SUBMIT,LOCK,0,{$user_id},0,lock)},Lock)}">
                <![CDATA[
                    <td align='center'>Not Locked</td>
                ]]>
            </If>
            <If if="{==({getText(RP_LETTER5, TABLE, TEMPLATE, {$user_id}, 1, 0, {$last_year})},Variance)}">
                <ReportItem id="variance_letter" type="PDFReportItem" reportType="Letters/Variance" year="{$last_year}" class="" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                    <![CDATA[
                        <td align='center'>
                            {getText(RP_LETTER5, TABLE, TEACHING, {$user_id}, 1, 0, {$last_year})}
                            {getText(RP_LETTER5, TABLE, RESEARCH, {$user_id}, 1, 0, {$last_year})}
                            {getText(RP_LETTER5, TABLE, SERVICE, {$user_id}, 1, 0, {$last_year})}
                            {getText(RP_LETTER5, TABLE, ADMIN, {$user_id}, 1, 0, {$last_year})}
                            {$item}
                        </td>
                    ]]>
                </ReportItem>
            </If>
            <Else>
                <![CDATA[
                    <td></td>
                ]]>
            </Else>
            <If id="if_not_ca" if="{!contains({$user_sub_roles},Chair's Advice)}">
                <ReportItem id="recommendation" type="PDFReportItem" class="recommendationPDF downloadButton{$user_id}" reportType="ChairTable" section="Recommendations" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                    <![CDATA[
                            <td align='center'>
                            {$item} <a class="viewEvaluation" style="cursor:pointer;" data-href='{$wgServer}{$wgScriptPath}/index.php/Special:Report?report=ChairTable&section=Recommendations&userId={$user_id}'>Recommendation</a><br />
                    ]]>
                </ReportItem>
            </If>
            <If id="if_ca" if="{contains({$user_sub_roles},Chair's Advice)}">
                <ReportItem id="ca" type="PDFReportItem" reportType="ChairTable" class="downloadButton{$user_id}" section="Chair Advice" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                    <![CDATA[
                            <td align='center'>
                            {$item} <a class="viewCA" style="cursor:pointer;" data-href='{$wgServer}{$wgScriptPath}/index.php/Special:Report?report=ChairTable&section=Chair+Advice&userId={$user_id}'>Chair's Advice</a><br />
                    ]]>
                </ReportItem>
            </If>
            <ReportItem id="da_download" type="PDFReportItem" reportType="ChairTable" section="Dean Advice" noRenderIfNull="true" class="" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                <![CDATA[
                        {$item} Dean's Advice<br />
                ]]>
            </ReportItem>
            <If id="if_not_ca" if="{!contains({$user_sub_roles},Chair's Advice)}">
                <ReportItem id="submit" type="SimpleReviewSubmit" section="Recommendations" userId="{$user_id}" onlyGenerate="true" specialDownload=".downloadButton{$user_id}">
                    <![CDATA[
                        {$item}
                    ]]>
                </ReportItem>
            </If>
            <If id="if_ca" if="{contains({$user_sub_roles},Chair's Advice)}">
                <ReportItem id="submit" type="SimpleReviewSubmit" section="Chair Advice" userId="{$user_id}" onlyGenerate="true" specialDownload=".downloadButton{$user_id}">
                    <![CDATA[
                        {$item}
                    ]]>
                </ReportItem>
            </If>
            <If id="if_chair" if="{and({!contains({$my_roles},EA)},
                                       {or({contains({$my_roles},Chair)},
                                           {contains({$user_sub_roles},Chair's Recommendation)},
                                           {==({$my_id},64)}
                                       )}
                                  )}">
                <If id="if_not_ca" if="{!contains({$user_sub_roles},Chair's Advice)}">
                    <ReportItem id="increment" type="Increment" blobItem="INCREMENT" blobSubItem="{$user_id}" width="80px" encrypt="true">
                        <![CDATA[
                                </td>
                                <td align='center' valign='middle' class='increment' style="white-space:nowrap;">{$item}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="tenure" type="Tenure" blobItem="TENURE" blobSubItem="{$user_id}" width="200px" encrypt="true">
                        <![CDATA[
                                <td align='center' class='tenure'>{$item}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="promotion" type="Promotion" blobItem="PROMOTION" blobSubItem="{$user_id}" width="200px" encrypt="true">
                        <![CDATA[
                                <td align='center' class='promotion'>{$item}</td>
                            </tr>
                        ]]>
                    </ReportItem>
                </If>
                <If id="if_ca" if="{contains({$user_sub_roles},Chair's Advice)}">
                    <ReportItem id="increment" type="Increment" blobItem="INCREMENT" blobSection="FEC_CHAIR_ADVICE" blobSubItem="{$user_id}" width="80px" encrypt="true">
                        <![CDATA[
                                </td>
                                <td align='center' valign='middle' class='increment' style="white-space:nowrap;">{$item}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="tenure" type="Tenure" blobItem="TENURE" blobSection="FEC_CHAIR_ADVICE" blobSubItem="{$user_id}" width="200px" encrypt="true">
                        <![CDATA[
                                <td align='center' class='tenure'>{$item}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="promotion" type="Promotion" blobItem="PROMOTION" blobSection="FEC_CHAIR_ADVICE" blobSubItem="{$user_id}" width="200px" encrypt="true">
                        <![CDATA[
                                <td align='center' class='promotion'>{$item}</td>
                            </tr>
                        ]]>
                    </ReportItem>
                </If>
            </If>
            <If id="if_ea" if="{contains({$my_roles},EA)}">
                <If id="if_not_ca" if="{!contains({$user_sub_roles},Chair's Advice)}">
                    <ReportItem id="increment" type="Increment" blobItem="INCREMENT" blobSubItem="{$user_id}" width="80px" encrypt="true">
                        <![CDATA[
                                </td>
                                <td align='center' valign='middle' class='increment' style="white-space:nowrap;">{$value}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="tenure" type="Tenure" blobItem="TENURE" blobSubItem="{$user_id}" width="200px" encrypt="true">
                        <![CDATA[
                                <td align='center' class='tenure'>{$value}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="promotion" type="Promotion" blobItem="PROMOTION" blobSubItem="{$user_id}" width="200px" encrypt="true">
                        <![CDATA[
                                <td align='center' class='promotion'>{$value}</td>
                            </tr>
                        ]]>
                    </ReportItem>
                </If>
                <If id="if_ca" if="{contains({$user_sub_roles},Chair's Advice)}">
                    <ReportItem id="increment" type="Increment" blobItem="INCREMENT" blobSection="FEC_CHAIR_ADVICE" blobSubItem="{$user_id}" width="80px" encrypt="true">
                        <![CDATA[
                                </td>
                                <td align='center' valign='middle' class='increment' style="white-space:nowrap;">{$value}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="tenure" type="Tenure" blobItem="TENURE" blobSection="FEC_CHAIR_ADVICE" blobSubItem="{$user_id}" width="200px" encrypt="true">
                        <![CDATA[
                                <td align='center' class='tenure'>{$value}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="promotion" type="Promotion" blobItem="PROMOTION" blobSection="FEC_CHAIR_ADVICE" blobSubItem="{$user_id}" width="200px" encrypt="true">
                        <![CDATA[
                                <td align='center' class='promotion'>{$value}</td>
                            </tr>
                        ]]>
                    </ReportItem>
                </If>
            </If>
        </ReportItemSet>
        <Static>
            <![CDATA[
                    </tbody>
                </table><br />
                <div style='display: inline-block;'>
                    <h3 style='text-align: center;'>Average Increments</h3>
                    <table class='wikitable' frame='box' rules='all'>
                        <tr>
                            <th>Year</th>
                            <th>Average<br />Faculty Increment</th>
                            <th>Average<br />FSO Increment</th>
                        </tr>
                        <tr>
                            <td><b>{$this_year}</b></td>
                            <td id='averageFac' align='right'></td>
                            <td id='averageFSO' align='right'></td>
                        </tr>
                        <tr>
                            <td><b>{subtract({$this_year},1)}</b></td>
                            <td id='averageFac{subtract({$this_year},1)}' align='right'></td>
                            <td id='averageFSO{subtract({$this_year},1)}' align='right'></td>
                        </tr>
                        <tr>
                            <td><b>{subtract({$this_year},2)}</b></td>
                            <td id='averageFac{subtract({$this_year},2)}' align='right'></td>
                            <td id='averageFSO{subtract({$this_year},2)}' align='right'></td>
                        </tr>
                        <tr>
                            <td><b>{subtract({$this_year},3)}</b></td>
                            <td id='averageFac{subtract({$this_year},3)}' align='right'></td>
                            <td id='averageFSO{subtract({$this_year},3)}' align='right'></td>
                        </tr>
                        <tr>
                            <td><b>{subtract({$this_year},4)}</b></td>
                            <td id='averageFac{subtract({$this_year},4)}' align='right'></td>
                            <td id='averageFSO{subtract({$this_year},4)}' align='right'></td>
                        </tr>
                        <tr>
                            <td><b>{subtract({$this_year},5)}</b></td>
                            <td id='averageFac{subtract({$this_year},5)}' align='right'></td>
                            <td id='averageFSO{subtract({$this_year},5)}' align='right'></td>
                        </tr>
                        <tr>
                            <td><b>{subtract({$this_year},6)}</b></td>
                            <td id='averageFac{subtract({$this_year},6)}' align='right'></td>
                            <td id='averageFSO{subtract({$this_year},6)}' align='right'></td>
                        </tr>
                    </table>
                </div>
                <div style='display:inline-block; margin-left: 15px;'>
                    <style>
                        .histogram td {
                            height: 200px;
                            vertical-align: bottom;
                        }
                        
                        .histogram td div {
                            width: 100%;
                            background: #007d43;
                            color: white;
                            text-align: center;
                            font-size: smaller;
                            user-select: none;
                        }
                        
                        .histogram th {
                            width: 40px;
                        }
                    </style>
                    <h3 style='text-align: center;'>Faculty Increments</h3>
                    <table class='wikitable histogram' frame='box' rules='all'>
                        <tr>
                            <td id='000'><div></div></td>
                            <td id='050'><div></div></td>
                            <td id='075'><div></div></td>
                            <td id='100'><div></div></td>
                            <td id='125'><div></div></td>
                            <td id='150'><div></div></td>
                            <td id='175'><div></div></td>
                            <td id='200'><div></div></td>
                            <td id='225'><div></div></td>
                            <td id='250'><div></div></td>
                            <td id='PTC'><div></div></td>
                        </tr>
                        <tr>
                            <th>0.00</th>
                            <th>0.50</th>
                            <th>0.75</th>
                            <th>1.00</th>
                            <th>1.25</th>
                            <th>1.50</th>
                            <th>1.75</th>
                            <th>2.00</th>
                            <th>2.25</th>
                            <th>2.50+</th>
                            <th>PTC</th>
                        </tr>
                    </table>
                </div><br />
                <small>Averages are based on the people currently in the table, so previous averages may differ slightly as it does not factor in people who are no longer in the department</small>
                <script type='text/javascript'>
                    $('#chairTable').dataTable({
                        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                        "iDisplayLength": -1
                    });
                    
                    $(".viewEvaluation").click(function(){
                        var href = $(this).attr('data-href');
                        $("#Recommendations").attr('href', href);
                        $("#Recommendations").trigger('click');
                    });
                    
                    $(".viewCA").click(function(){
                        var href = $(this).attr('data-href');
                        $("#ChairAdvice").attr('href', href);
                        $("#ChairAdvice").trigger('click');
                    });
                    
                    $(".viewDA").click(function(){
                        var href = $(this).attr('data-href');
                        $("#DeanAdvice").attr('href', href);
                        $("#DeanAdvice").trigger('click');
                    });
                    
                    $(".viewDD").click(function(){
                        var href = $(this).attr('data-href');
                        $("#DeanDecision").attr('href', href);
                        $("#DeanDecision").trigger('click');
                    });
                    
                    $(".increment select").change(function(){
                        var targetFac = $('#targetFac input').val();
                        var targetFSO = $('#targetFso input').val();
                        
                        var fac_sum = 0;
                        var fac_count = 0;
                        var fso_sum = 0;
                        var fso_count = 0;
                        var histogram = {};
                        $(".increment select").each(function(i, el){
                            var tr = $(el).closest("tr");
                            if($($("td", tr)[1]).text() == "Stroulia, Eleni"){
                                return;
                            }
                            if($(el).val() != "" && $(el).val() != "0.00 (PTC)" && $(el).val() != "0A"){
                                if($(tr).attr('data-fecid').includes("A") ||
                                   $(tr).attr('data-fecid').includes("B") ||
                                   $(tr).attr('data-fecid').includes("C") ||
                                   $(tr).attr('data-fecid').includes("N")){
                                    fac_sum += parseFloat($(el).val());
                                    fac_count++;
                                }
                                else if($(tr).attr('data-fecid').includes("D") ||
                                        $(tr).attr('data-fecid').includes("E") ||
                                        $(tr).attr('data-fecid').includes("F") ||
                                        $(tr).attr('data-fecid').includes("M")){
                                    fso_sum += parseFloat($(el).val());
                                    fso_count++;
                                }
                            }
                            if($(el).val() != "" && ($(tr).attr('data-fecid').includes("A") ||
                                                     $(tr).attr('data-fecid').includes("B") ||
                                                     $(tr).attr('data-fecid').includes("C") ||
                                                     $(tr).attr('data-fecid').includes("N"))){
                                if($(el).val().indexOf("PTC") != -1){
                                    if(_.isUndefined(histogram["PTC"])){
                                        histogram["PTC"] = 0;
                                    }
                                    histogram["PTC"]++;
                                }
                                else if(parseFloat($(el).val()) == 0){
                                    if(_.isUndefined(histogram["000"])){
                                        histogram["000"] = 0;
                                    }
                                    histogram["000"]++;
                                }
                                else if(parseFloat($(el).val()) >= 2.5){
                                    if(_.isUndefined(histogram["250"])){
                                        histogram["250"] = 0;
                                    }
                                    histogram["250"]++;
                                }
                                else{
                                    if(_.isUndefined(histogram[$(el).val().replace(".", "")])){
                                        histogram[$(el).val().replace(".", "")] = 0;
                                    }
                                    histogram[$(el).val().replace(".", "")]++;
                                }
                            }
                        });
                        
                        var facSign = (targetFac - fac_sum > 0) ? "-" : "+";
                        var fsoSign = (targetFSO - fso_sum > 0) ? "-" : "+";
                        
                        $('#averageFac').html((fac_sum/Math.max(1, fac_count)).toFixed(3));
                        $('#averageFSO').html((fso_sum/Math.max(1, fso_count)).toFixed(3));
                        
                        $("#totalFac").text(number_format(fac_sum));
                        $("#totalFSO").text(number_format(fso_sum));
                        
                        $("#deltaFac").text(facSign + number_format(Math.abs(targetFac - fac_sum)));
                        $("#deltaFSO").text(fsoSign + number_format(Math.abs(targetFSO - fso_sum)));
                        
                        if(facSign == "+"){
                            $("#deltaFac").css("background", "red");
                            $("#deltaFac").css("color", "white");
                        }
                        else{
                            $("#deltaFac").css("background", "white");
                            $("#deltaFac").css("color", "black");
                        }
                        
                        if(fsoSign == "+"){
                            $("#deltaFSO").css("background", "red");
                            $("#deltaFSO").css("color", "white");
                        }
                        else{
                            $("#deltaFSO").css("background", "white");
                            $("#deltaFSO").css("color", "black");
                        }
                        
                        $(".histogram td div").height(0)
                                              .attr("title", "")
                                              .text("");
                        var max = _.max(histogram);
                        
                        for (const [key, val] of Object.entries(histogram)){
                            $(".histogram td#" + key + " div").height((val/Math.max(max,1))*100 + "%")
                                                              .attr("title", val)
                                                              .text(val);
                        }
                    });
                    
                    setInterval(function(){
                        $(".increment select:first-child").change();
                    }, 1000);
                    
                    var increments = new Array();
                    var fac_counts = new Array();
                    var fac_sums = new Array();

                    var fso_counts = new Array();
                    var fso_sums = new Array();
                    
                    increments[{subtract({$this_year},1)}] = $(".increment{subtract({$this_year},1)}");
                    increments[{subtract({$this_year},2)}] = $(".increment{subtract({$this_year},2)}");
                    increments[{subtract({$this_year},3)}] = $(".increment{subtract({$this_year},3)}");
                    increments[{subtract({$this_year},4)}] = $(".increment{subtract({$this_year},4)}");
                    increments[{subtract({$this_year},5)}] = $(".increment{subtract({$this_year},5)}");
                    increments[{subtract({$this_year},6)}] = $(".increment{subtract({$this_year},6)}");
                    
                    _.each(increments, function(increment, i){
                        fac_counts[i] = 0;
                        fac_sums[i] = 0;
                        fso_counts[i] = 0;
                        fso_sums[i] = 0;
                        $(increment).each(function(j, el){
                            var table = $(el).closest("table");
                            var val = $(el).text();
                            if(val != "N/A" && val != "" && val != "0.00 (PTC)" && $(el).val() != "0A"){
                                if($(table).attr('data-fecid').includes("A") ||
                                   $(table).attr('data-fecid').includes("B") ||
                                   $(table).attr('data-fecid').includes("C") ||
                                   $(table).attr('data-fecid').includes("N")){
                                    fac_sums[i] += parseFloat(val);
                                    fac_counts[i]++;
                                }
                                else if($(table).attr('data-fecid').includes("D") ||
                                        $(table).attr('data-fecid').includes("E") ||
                                        $(table).attr('data-fecid').includes("F") ||
                                        $(table).attr('data-fecid').includes("M")){
                                    fso_sums[i] += parseFloat(val);
                                    fso_counts[i]++;
                                }
                            }
                        });
                        $('#averageFac' + i).html((fac_sums[i]/Math.max(1, fac_counts[i])).toFixed(3));
                        $('#averageFSO' + i).html((fso_sums[i]/Math.max(1, fso_counts[i])).toFixed(3));
                    });
                    $(".increment select").first().trigger('change');
                </script>
                <script type='text/javascript' src='{$wgServer}{$wgScriptPath}/extensions/Reporting/Report/scripts/recommendations.js'></script>
            ]]>
        </Static>
        <Static>
                <![CDATA[
                    <style>
                        #summary {
                            border: 2px solid #aaaaaa;
                        }
                    
                        .target {
                            padding: 0 !important;
                            border: 2px solid #007d43 !important;
                        }
                        
                        .target input {
                            font-size: 9pt;
                            margin: 0;
                            border: none;
                            border-radius: 0;
                        }
                        
                        .target input:focus {
                            border: none !important;
                        }
                    </style>
                    <table id='summary' class='wikitable' frame='box' rules='all'>
                        <tr>
                            <th></th>
                            <th style='width:6em;'>Faculty</th>
                            <th style='width:6em;'>FSO</th>
                        </tr>
                        <tr>
                            <td><b>Recommendations to FEC&nbsp;</b></td>
                            <td id='totalFac' align='right'></td>
                            <td id='totalFSO' align='right'></td>
                        </tr>
                        <tr>
                            <td><b>Total Pool&nbsp;</b></td>
                ]]>
            </Static>
            <ReportItem id="targetFac" type="Integer" blobItem="TARGET_FAC" blobSubItem="{$my_id}" decimals="2" personId="0" width="80px" placeholder="0.00">
                <![CDATA[
                    <td id='targetFac' class='target' align='right'>{$item}</td>
                ]]>
            </ReportItem>
            <ReportItem id="targetFso" type="Integer" blobItem="TARGET_FSO" blobSubItem="{$my_id}" decimals="2" personId="0" width="80px" placeholder="0.00">
                <![CDATA[
                    <td id='targetFso' class='target' align='right'>{$item}</td>
                ]]>
            </ReportItem>
            <Static>
                <![CDATA[
                        </tr>
                        <tr>
                            <td><b>Running Targets&nbsp;</b></td>
                            <td id='deltaFac' align='right'></td>
                            <td id='deltaFSO' align='right'></td>
                        </tr>
                    </table>
                ]]>
            </Static>
    </ReportSection>
    <ReportSection id="dean_evaluations" tooltip="Dean's Evaluations" name="Dean Evaluations" title="Dean's Evaluations" blobSection="FEC_REVIEW" type="EditableReportSection" pagebreak="false">
        <Static>
            <![CDATA[
                <style>
                    table#chairTable * {
                        font-size:11px !important;
                    }
                </style>
                <div style='float:right; margin-top: -45px;'><button id='generateAll' type='button'>Generate All Evaluations</button></div>
                <script type='text/javascript'>
                    $('#generateAll').click(function(){
                        $('.generateButton').click();
                    });
                </script>
                <table id='chairTable' class='wikitable' frame='box' rules='all'>
                    <thead>
                        <tr>
                            <th>Case#</th>
                            <th>Name</th>
                            <th>Rank</th>
                            <th>Special Case</th>
                            <th width="1%">Annual Report</th>
                            <th width="1%">Locked</th>
                            <th style='white-space:nowrap;'>T/R/S/A<br />Variance</th>
                            <th>Evaluation</th>
                            <th width="1%">Merit Increment</th>
                            <th width="1%">Tenure</th>
                            <th width="1%">Promotion</th>
                    </thead>
                    <tbody>
            ]]>
        </Static>
        <ReportItemSet id="faculty" type="DeansPeopleReportItemSet" start="{$last_year}-07-01" end="{$this_year}-07-01">
            <Static>
                <![CDATA[
                    <tr data-fecid="{getExtra()}">
                        <td>{getExtra()}</td>
                        <td><a href="{$user_url}" target="_blank">{$user_name}</a></td>
                        <td>{$user_level}</td>
                        <td>{$user_sub_roles}</td>
                ]]>
            </Static>
            <ReportItem id="download" type="PDFReportItem" reportType="FECpdf" class="" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' /> &lt;span>AR&lt;/span>">
                <![CDATA[
                        <td align='left' class='currentAR'>
                            {$item}
                ]]>
            </ReportItem>
            <ReportItem id="downloadSPOT" type="PDFReportItem" reportType="SPOTs" class="" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' /> &lt;span>SPOTs&lt;/span>">
                <![CDATA[
                            <span {if("{$value}" == "", class='remove')}><br />{$item}</span>
                        </td>
                ]]>
            </ReportItem>
            <If id="if_lock" if="{==({getArray(RP_FEC,FEC_SUBMIT,LOCK,0,{$user_id},0,lock)},Lock)}">
                <ReportItem id="lock" type="Unlock" blobReport="RP_FEC" blobSection="FEC_SUBMIT" blobItem="LOCK" blobSubItem="0" personId="{$user_id}" blobType="BLOB_ARRAY" orientation="vertical" options="Lock">
                    <![CDATA[
                        <td style='white-space:nowrap;' align='center'>
                            <div id='lockContainer_{$user_id}' style='display:none;'>{$item}</div>
                            <button id='lock_{$user_id}' type="button" value="Save" name="submit">Unlock</button>
                            <script type="text/javascript">
                                $('#lock_{$user_id}').click(function(){
                                    if(confirm('Are you sure you want to proceed?\n\nThis annual report will be unlocked and the faculty member will be able to edit their report again.')){
                                        $('#lockContainer_{$user_id} input[type=checkbox]').prop('checked', false);
                                        $('#lock_{$user_id}').prop('disabled', true);
                                        $('#lock_{$user_id}').after("<span class='throbber'></span>");
                                        saveAll(function(){$("#DeanEvaluations").click();});
                                    } else {
                                        $('#lockContainer_{$user_id} input[type=checkbox]').prop('checked', true);
                                    }
                                    return false;
                                });
                            </script>
                        </td>
                    ]]>
                </ReportItem>
            </If>
            <If id="if_not_lock" if="{!=({getArray(RP_FEC,FEC_SUBMIT,LOCK,0,{$user_id},0,lock)},Lock)}">
                <![CDATA[
                    <td align='center'>Not Locked</td>
                ]]>
            </If>
            <If if="{==({getText(RP_LETTER5, TABLE, TEMPLATE, {$user_id}, 1, 0, {$last_year})},Variance)}">
                <ReportItem id="variance_letter" type="PDFReportItem" reportType="Letters/Variance" year="{$last_year}" class="" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                    <![CDATA[
                        <td align='center'>
                            {getText(RP_LETTER5, TABLE, TEACHING, {$user_id}, 1, 0, {$last_year})}
                            {getText(RP_LETTER5, TABLE, RESEARCH, {$user_id}, 1, 0, {$last_year})}
                            {getText(RP_LETTER5, TABLE, SERVICE, {$user_id}, 1, 0, {$last_year})}
                            {getText(RP_LETTER5, TABLE, ADMIN, {$user_id}, 1, 0, {$last_year})}
                            {$item}
                        </td>
                    ]]>
                </ReportItem>
            </If>
            <Else>
                <![CDATA[
                    <td></td>
                ]]>
            </Else>
            <Static>
                <![CDATA[
                        <td align='center'>
                ]]>
            </Static>
            <If id="if_dr" if="{contains({$user_sub_roles},Dean's Recommendation)}">
                <ReportItem id="dr" type="PDFReportItem" reportType="ChairTable" section="Recommendations" class="downloadButton{$user_id}" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                    <![CDATA[
                            {$item} <a class="viewEvaluation" style="cursor:pointer;" data-href='{$wgServer}{$wgScriptPath}/index.php/Special:Report?report=ChairTable&section=Recommendations&userId={$user_id}'>Dean's Recommendation</a><br />
                    ]]>
                </ReportItem>
            </If>
            <If id="if_da" if="{contains({$user_sub_roles},Dean's Advice)}">
                <ReportItem id="da" type="PDFReportItem" reportType="ChairTable" section="Dean Advice" class="downloadButton{$user_id}" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                    <![CDATA[
                            {$item} <a class="viewDA" style="cursor:pointer;" data-href='{$wgServer}{$wgScriptPath}/index.php/Special:Report?report=ChairTable&section=Dean+Advice&userId={$user_id}'>Dean's Advice</a><br />
                    ]]>
                </ReportItem>
            </If>
            <If id="if_dd" if="{contains({$user_sub_roles},Dean's Decision)}">
                <ReportItem id="dd" type="PDFReportItem" reportType="ChairTable" section="Dean Decision" class="downloadButton{$user_id}" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                    <![CDATA[
                            {$item} <a class="viewDD" style="cursor:pointer;" data-href='{$wgServer}{$wgScriptPath}/index.php/Special:Report?report=ChairTable&section=Dean+Decision&userId={$user_id}'>Dean's Decision</a><br />
                    ]]>
                </ReportItem>
            </If>
            <ReportItem id="ca_download" type="PDFReportItem" reportType="ChairTable" section="Chair Advice" noRenderIfNull="true" class="downloadButton{$user_id}" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                <![CDATA[
                        {$item} Chair's Advice<br />
                ]]>
            </ReportItem>
            <ReportItem id="cr_download" type="PDFReportItem" reportType="ChairTable" section="Recommendations" noRenderIfNull="true" class="downloadButton{$user_id}" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                <![CDATA[
                        {$item} Chair's Recommendation<br />
                ]]>
            </ReportItem>
            <If id="if_dr" if="{contains({$user_sub_roles},Dean's Recommendation)}">
                <ReportItem id="submit" type="SimpleReviewSubmit" section="Recommendations" userId="{$user_id}" onlyGenerate="true" specialDownload=".downloadButton{$user_id}">
                    <![CDATA[
                        {$item}
                    ]]>
                </ReportItem>
            </If>
            <If id="if_da" if="{contains({$user_sub_roles},Dean's Advice)}">
                <ReportItem id="submit" type="SimpleReviewSubmit" section="Dean Advice" userId="{$user_id}" onlyGenerate="true" specialDownload=".downloadButton{$user_id}">
                    <![CDATA[
                        {$item}
                    ]]>
                </ReportItem>
            </If>
            <If id="if_dd" if="{contains({$user_sub_roles},Dean's Decision)}">
                <ReportItem id="submit" type="SimpleReviewSubmit" section="Dean Decision" userId="{$user_id}" onlyGenerate="true" specialDownload=".downloadButton{$user_id}">
                    <![CDATA[
                        {$item}
                    ]]>
                </ReportItem>
            </If>
            <If id="if_dean" if="{!contains({$my_roles},DeanEA)}">
                <If id="if_dr" if="{contains({$user_sub_roles},Dean's Recommendation)}">
                    <ReportItem id="increment" type="Increment" blobItem="INCREMENT" blobSection="FEC_REVIEW" blobSubItem="{$user_id}" width="80px" encrypt="true">
                        <![CDATA[
                                </td>
                                <td align='center' valign='middle' class='increment' style="white-space:nowrap;">{$item}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="tenure" type="Tenure" blobItem="TENURE" blobSection="FEC_REVIEW" blobSubItem="{$user_id}" width="200px" encrypt="true">
                        <![CDATA[
                                <td align='center' class='tenure'>{$item}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="promotion" type="Promotion" blobItem="PROMOTION" blobSection="FEC_REVIEW" blobSubItem="{$user_id}" width="200px" encrypt="true">
                        <![CDATA[
                                <td align='center' class='promotion'>{$item}</td>
                            </tr>
                        ]]>
                    </ReportItem>
                </If>
                <If id="if_da" if="{contains({$user_sub_roles},Dean's Advice)}">
                    <ReportItem id="increment" type="Increment" blobItem="INCREMENT" blobSection="FEC_DEAN_ADVICE" blobSubItem="{$user_id}" width="80px" encrypt="true">
                        <![CDATA[
                                </td>
                                <td align='center' valign='middle' class='increment' style="white-space:nowrap;">{$item}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="tenure" type="Tenure" blobItem="TENURE" blobSection="FEC_DEAN_ADVICE" blobSubItem="{$user_id}" width="200px" encrypt="true">
                        <![CDATA[
                                <td align='center' class='tenure'>{$item}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="promotion" type="Promotion" blobItem="PROMOTION" blobSection="FEC_DEAN_ADVICE" blobSubItem="{$user_id}" width="200px" encrypt="true">
                        <![CDATA[
                                <td align='center' class='promotion'>{$item}</td>
                            </tr>
                        ]]>
                    </ReportItem>
                </If>
                <If id="if_dd" if="{contains({$user_sub_roles},Dean's Decision)}">
                    <ReportItem id="increment" type="Increment" blobItem="INCREMENT" blobSection="FEC_DEAN_DECISION" blobSubItem="{$user_id}" width="80px" encrypt="true">
                        <![CDATA[
                                </td>
                                <td align='center' valign='middle' class='increment' style="white-space:nowrap;">{$item}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="tenure" type="Tenure" blobItem="TENURE" blobSection="FEC_DEAN_DECISION" blobSubItem="{$user_id}" width="200px" encrypt="true">
                        <![CDATA[
                                <td align='center' class='tenure'>{$item}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="promotion" type="Promotion" blobItem="PROMOTION" blobSection="FEC_DEAN_DECISION" blobSubItem="{$user_id}" width="200px" encrypt="true">
                        <![CDATA[
                                <td align='center' class='promotion'>{$item}</td>
                            </tr>
                        ]]>
                    </ReportItem>
                </If>
            </If>
            <If id="if_ea" if="{contains({$my_roles},DeanEA)}">
                <If id="if_dr" if="{contains({$user_sub_roles},Dean's Recommendation)}">
                    <ReportItem id="increment" type="Increment" blobItem="INCREMENT" blobSection="FEC_REVIEW" blobSubItem="{$user_id}" width="80px" encrypt="true">
                        <![CDATA[
                                </td>
                                <td align='center' valign='middle' class='increment' style="white-space:nowrap;">{$value}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="tenure" type="Tenure" blobItem="TENURE" blobSection="FEC_REVIEW" blobSubItem="{$user_id}" width="200px" encrypt="true">
                        <![CDATA[
                                <td align='center' class='tenure'>{$value}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="promotion" type="Promotion" blobItem="PROMOTION" blobSection="FEC_REVIEW" blobSubItem="{$user_id}" width="200px" encrypt="true">
                        <![CDATA[
                                <td align='center' class='promotion'>{$value}</td>
                            </tr>
                        ]]>
                    </ReportItem>
                </If>
                <If id="if_da" if="{contains({$user_sub_roles},Dean's Advice)}">
                    <ReportItem id="increment" type="Increment" blobItem="INCREMENT" blobSection="FEC_DEAN_ADVICE" blobSubItem="{$user_id}" width="80px" encrypt="true">
                        <![CDATA[
                                </td>
                                <td align='center' valign='middle' class='increment' style="white-space:nowrap;">{$value}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="tenure" type="Tenure" blobItem="TENURE" blobSection="FEC_DEAN_ADVICE" blobSubItem="{$user_id}" width="200px" encrypt="true">
                        <![CDATA[
                                <td align='center' class='tenure'>{$value}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="promotion" type="Promotion" blobItem="PROMOTION" blobSection="FEC_DEAN_ADVICE" blobSubItem="{$user_id}" width="200px" encrypt="true">
                        <![CDATA[
                                <td align='center' class='promotion'>{$value}</td>
                            </tr>
                        ]]>
                    </ReportItem>
                </If>
                <If id="if_dd" if="{contains({$user_sub_roles},Dean's Decision)}">
                    <ReportItem id="increment" type="Increment" blobItem="INCREMENT" blobSection="FEC_DEAN_DECISION" blobSubItem="{$user_id}" width="80px" encrypt="true">
                        <![CDATA[
                                </td>
                                <td align='center' valign='middle' class='increment' style="white-space:nowrap;">{$value}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="tenure" type="Tenure" blobItem="TENURE" blobSection="FEC_DEAN_DECISION" blobSubItem="{$user_id}" width="200px" encrypt="true">
                        <![CDATA[
                                <td align='center' class='tenure'>{$value}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="promotion" type="Promotion" blobItem="PROMOTION" blobSection="FEC_DEAN_DECISION" blobSubItem="{$user_id}" width="200px" encrypt="true">
                        <![CDATA[
                                <td align='center' class='promotion'>{$value}</td>
                            </tr>
                        ]]>
                    </ReportItem>
                </If>
            </If>
        </ReportItemSet>
        <Static>
            <![CDATA[
                    </tbody>
                </table><br />
                <table class='wikitable' frame='box' rules='all'>
                    <tr>
                        <th>Year</th>
                        <th>Average<br />Faculty Increment</th>
                        <th>Average<br />FSO Increment</th>
                    </tr>
                    <tr>
                        <td><b>{$this_year}</b></td>
                        <td id='averageFac' align='right'></td>
                        <td id='averageFSO' align='right'></td>
                    </tr>
                    <tr>
                        <td><b>{subtract({$this_year},1)}</b></td>
                        <td id='averageFac{subtract({$this_year},1)}' align='right'></td>
                        <td id='averageFSO{subtract({$this_year},1)}' align='right'></td>
                    </tr>
                    <tr>
                        <td><b>{subtract({$this_year},2)}</b></td>
                        <td id='averageFac{subtract({$this_year},2)}' align='right'></td>
                        <td id='averageFSO{subtract({$this_year},2)}' align='right'></td>
                    </tr>
                    <tr>
                        <td><b>{subtract({$this_year},3)}</b></td>
                        <td id='averageFac{subtract({$this_year},3)}' align='right'></td>
                        <td id='averageFSO{subtract({$this_year},3)}' align='right'></td>
                    </tr>
                    <tr>
                        <td><b>{subtract({$this_year},4)}</b></td>
                        <td id='averageFac{subtract({$this_year},4)}' align='right'></td>
                        <td id='averageFSO{subtract({$this_year},4)}' align='right'></td>
                    </tr>
                    <tr>
                        <td><b>{subtract({$this_year},5)}</b></td>
                        <td id='averageFac{subtract({$this_year},5)}' align='right'></td>
                        <td id='averageFSO{subtract({$this_year},5)}' align='right'></td>
                    </tr>
                    <tr>
                        <td><b>{subtract({$this_year},6)}</b></td>
                        <td id='averageFac{subtract({$this_year},6)}' align='right'></td>
                        <td id='averageFSO{subtract({$this_year},6)}' align='right'></td>
                    </tr>
                </table>
                <small>Averages are based on the people currently in the table, so previous averages may differ slightly as it does not factor in people who are no longer in the department</small>
                <script type='text/javascript'>
                    $('#chairTable').dataTable({
                        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                        "iDisplayLength": -1
                    });
                    
                    $(".viewEvaluation").click(function(){
                        var href = $(this).attr('data-href');
                        $("#Recommendations").attr('href', href);
                        $("#Recommendations").trigger('click');
                    });
                    
                    $(".viewCA").click(function(){
                        var href = $(this).attr('data-href');
                        $("#ChairAdvice").attr('href', href);
                        $("#ChairAdvice").trigger('click');
                    });
                    
                    $(".viewDA").click(function(){
                        var href = $(this).attr('data-href');
                        $("#DeanAdvice").attr('href', href);
                        $("#DeanAdvice").trigger('click');
                    });
                    
                    $(".viewDD").click(function(){
                        var href = $(this).attr('data-href');
                        $("#DeanDecision").attr('href', href);
                        $("#DeanDecision").trigger('click');
                    });
                    
                    $(".increment select").change(function(){
                        var fac_sum = 0;
                        var fac_count = 0;
                        var fso_sum = 0;
                        var fso_count = 0;
                        $(".increment select").each(function(i, el){
                            var tr = $(el).closest("tr");
                            if($(el).val() != "" && $(el).val() != "0.00 (PTC)" && $(el).val() != "0A"){
                                if($(tr).attr('data-fecid').includes("A") ||
                                   $(tr).attr('data-fecid').includes("B") ||
                                   $(tr).attr('data-fecid').includes("C") ||
                                   $(tr).attr('data-fecid').includes("N")){
                                    fac_sum += parseFloat($(el).val());
                                    fac_count++;
                                }
                                else if($(tr).attr('data-fecid').includes("D") ||
                                        $(tr).attr('data-fecid').includes("E") ||
                                        $(tr).attr('data-fecid').includes("F") ||
                                        $(tr).attr('data-fecid').includes("M")){
                                    fso_sum += parseFloat($(el).val());
                                    fso_count++;
                                }
                            }
                        });
                        $('#averageFac').html((fac_sum/Math.max(1, fac_count)).toFixed(3));
                        $('#averageFSO').html((fso_sum/Math.max(1, fso_count)).toFixed(3));
                    });
                    
                    var increments = new Array();
                    var fac_counts = new Array();
                    var fac_sums = new Array();

                    var fso_counts = new Array();
                    var fso_sums = new Array();
                    
                    increments[{subtract({$this_year},1)}] = $(".increment{subtract({$this_year},1)}");
                    increments[{subtract({$this_year},2)}] = $(".increment{subtract({$this_year},2)}");
                    increments[{subtract({$this_year},3)}] = $(".increment{subtract({$this_year},3)}");
                    increments[{subtract({$this_year},4)}] = $(".increment{subtract({$this_year},4)}");
                    increments[{subtract({$this_year},5)}] = $(".increment{subtract({$this_year},5)}");
                    increments[{subtract({$this_year},6)}] = $(".increment{subtract({$this_year},6)}");
                    
                    _.each(increments, function(increment, i){
                        fac_counts[i] = 0;
                        fac_sums[i] = 0;
                        fso_counts[i] = 0;
                        fso_sums[i] = 0;
                        $(increment).each(function(j, el){
                            var table = $(el).closest("table");
                            var val = $(el).text();
                            if(val != "N/A" && val != "" && val != "0.00 (PTC)" && $(el).val() != "0A"){
                                if($(table).attr('data-fecid').includes("A") ||
                                   $(table).attr('data-fecid').includes("B") ||
                                   $(table).attr('data-fecid').includes("C") ||
                                   $(table).attr('data-fecid').includes("N")){
                                    fac_sums[i] += parseFloat(val);
                                    fac_counts[i]++;
                                }
                                else if($(table).attr('data-fecid').includes("D") ||
                                        $(table).attr('data-fecid').includes("E") ||
                                        $(table).attr('data-fecid').includes("F") ||
                                        $(table).attr('data-fecid').includes("M")){
                                    fso_sums[i] += parseFloat(val);
                                    fso_counts[i]++;
                                }
                            }
                        });
                        $('#averageFac' + i).html((fac_sums[i]/Math.max(1, fac_counts[i])).toFixed(3));
                        $('#averageFSO' + i).html((fso_sums[i]/Math.max(1, fso_counts[i])).toFixed(3));
                    });
                    $(".increment select").first().trigger('change');
                </script>
                <script type='text/javascript' src='{$wgServer}{$wgScriptPath}/extensions/Reporting/Report/scripts/recommendations.js'></script>
            ]]>
        </Static>
    </ReportSection>
    <ReportSection id="atsec" tooltip="ATSEC" name="ATSEC" title="ATSEC Evaluations" blobSection="FEC_REVIEW" type="EditableReportSection" pagebreak="false">
        <Static>
            <![CDATA[
                <style>
                    table#chairTable * {
                        font-size:11px !important;
                    }
                    .remove {
                        display: none;
                    }
                </style>
                <iframe id='downloadFrame' name='downloadFrame' src="" style="display:none;"></iframe>
                <div style='float:right; margin-top: -45px;display:flex;'>
                    <div><button id='generateAll' type='button'>Generate All Evals</button></div>
                    <div><button id='downloadAll' class='noDisable' type='button'>Download All Evals</button></div>
                </div>
                <script type='text/javascript'>
                    function postToIframe(data,url,target){
                        $('body').append('<form action="'+url+'" method="post" target="'+target+'" id="postToIframe"></form>');
                        $.each(data,function(n,v){
                            $('#postToIframe').append('<input type="hidden" name="'+n+'" value="'+v+'" />');
                        });
                        $('#postToIframe').submit().remove();
                    }
                    $('#generateAll').click(function(){
                        $('.generateButton').click();
                    });
                    $('#downloadAll').click(function(){
                        var pdfs = $.makeArray($(".recommendationPDF:visible").map(function(i, pdf){ return $(pdf).attr('href');})).join(',').replaceAll(wgServer + wgScriptPath + '/index.php/Special:ReportArchive?getpdf=', '');
                        postToIframe({pdfs: pdfs}, wgServer + wgScriptPath + '/index.php?action=downloadReportZip', 'downloadFrame');
                    });
                </script>
                <table id='chairTable' class='wikitable' frame='box' rules='all'>
                    <thead>
                        <tr>
                            <th>Case#</th>
                            <th>Name</th>
                            <th>Rank</th>
                            <th width="1%">{$2_years_ago} Report</th>
                            <th width="1%">{$last_year} Report</th>
                            <th width="1%">Annual Report</th>
                            <th width="1%">Locked</th>
                            <th>Evaluation</th>
                            <th width="1%">Merit Increment</th>
                            <th width="1%">Promotion</th>
                    </thead>
                    <tbody>
            ]]>
        </Static>
        <ReportItemSet id="faculty" type="DepartmentPeopleReportItemSet" atsec="true" department="{$my_dept}" start="{$last_year}-07-01" end="{$this_year}-07-01" university="University of Alberta" excludeMe="true">
            <Static>
                <![CDATA[
                    <tr data-fecid="{getExtra()}">
                        <td>{getExtra()}</td>
                        <td><a href="{$user_url}" target="_blank">{$user_name}</a></td>
                        <td>{$user_level}</td>
                ]]>
            </Static>
            <ReportItem id="previous2_download" type="PDFReportItem" reportType="FECpdf" year="{$2_years_ago}" class="" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                <![CDATA[
                        <td align='center'>
                            {$item}
                        </td>
                ]]>
            </ReportItem>
            <ReportItem id="previous_download" type="PDFReportItem" reportType="FECpdf" year="{$last_year}" class="" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                <![CDATA[
                        <td align='center'>
                            {$item}
                        </td>
                ]]>
            </ReportItem>
            <ReportItem id="download" type="PDFReportItem" reportType="FECpdf" class="" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' /> &lt;span>AR&lt;/span>">
                <![CDATA[
                        <td align='left' class='currentAR'>
                            {$item}
                ]]>
            </ReportItem>
            <ReportItem id="downloadSPOT" type="PDFReportItem" reportType="SPOTs" class="" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' /> &lt;span>SPOTs&lt;/span>">
                <![CDATA[
                            <span {if("{$value}" == "", class='remove')}><br />{$item}</span>
                        </td>
                ]]>
            </ReportItem>
            <If id="if_lock" if="{==({getArray(RP_FEC,FEC_SUBMIT,LOCK,0,{$user_id},0,lock)},Lock)}">
                <ReportItem id="lock" type="Unlock" blobReport="RP_FEC" blobSection="FEC_SUBMIT" blobItem="LOCK" blobSubItem="0" personId="{$user_id}" blobType="BLOB_ARRAY" orientation="vertical" options="Lock">
                    <![CDATA[
                        <td style='white-space:nowrap;' align='center'>
                            <div id='lockContainer_{$user_id}' style='display:none;'>{$item}</div>
                            <button id='lock_{$user_id}' type="button" value="Save" name="submit">Unlock</button>
                            <script type="text/javascript">
                                $('#lock_{$user_id}').click(function(){
                                    if(confirm('Are you sure you want to proceed?\n\nThis annual report will be unlocked and the faculty member will be able to edit their report again.')){
                                        $('#lockContainer_{$user_id} input[type=checkbox]').prop('checked', false);
                                        $('#lock_{$user_id}').prop('disabled', true);
                                        $('#lock_{$user_id}').after("<span class='throbber'></span>");
                                        saveAll(function(){$("#ATSEC").click();});
                                    } else {
                                        $('#lockContainer_{$user_id} input[type=checkbox]').prop('checked', true);
                                    }
                                    return false;
                                });
                            </script>
                        </td>
                    ]]>
                </ReportItem>
            </If>
            <If id="if_not_lock" if="{!=({getArray(RP_FEC,FEC_SUBMIT,LOCK,0,{$user_id},0,lock)},Lock)}">
                <![CDATA[
                    <td align='center'>Not Locked</td>
                ]]>
            </If>
            <ReportItem id="recommendation" type="PDFReportItem" class="recommendationPDF downloadButton{$user_id}" reportType="ChairTable" section="Recommendations" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                <![CDATA[
                        <td align='center'>
                        {$item} <a class="viewEvaluation" style="cursor:pointer;" data-href='{$wgServer}{$wgScriptPath}/index.php/Special:Report?report=ChairTable&section=Recommendations&userId={$user_id}'>Recommendation</a><br />
                ]]>
            </ReportItem>
            <ReportItem id="submit" type="SimpleReviewSubmit" section="Recommendations" userId="{$user_id}" onlyGenerate="true" specialDownload=".downloadButton{$user_id}">
                <![CDATA[
                    {$item}
                ]]>
            </ReportItem>
            <If id="if_chair" if="{and({!contains({$my_roles},EA)},{or({contains({$my_roles},Chair)},{contains({$user_sub_roles},Chair's Recommendation)})})}">
                <ReportItem id="increment" type="Increment" blobItem="INCREMENT" blobSubItem="{$user_id}" width="80px" encrypt="true">
                    <![CDATA[
                            </td>
                            <td align='center' valign='middle' class='increment' style="white-space:nowrap;">{$item}</td>
                    ]]>
                </ReportItem>
                <ReportItem id="promotion" type="Promotion" blobItem="PROMOTION" blobSubItem="{$user_id}" width="200px" encrypt="true">
                    <![CDATA[
                            <td align='center' class='promotion'>{$item}</td>
                        </tr>
                    ]]>
                </ReportItem>
            </If>
            <If id="if_ea" if="{contains({$my_roles},EA)}">
                <ReportItem id="increment" type="Increment" blobItem="INCREMENT" blobSubItem="{$user_id}" width="80px" encrypt="true">
                    <![CDATA[
                            </td>
                            <td align='center' valign='middle' class='increment' style="white-space:nowrap;">{$value}</td>
                    ]]>
                </ReportItem>
                <ReportItem id="promotion" type="Promotion" blobItem="PROMOTION" blobSubItem="{$user_id}" width="200px" encrypt="true">
                    <![CDATA[
                            <td align='center' class='promotion'>{$value}</td>
                        </tr>
                    ]]>
                </ReportItem>
            </If>
        </ReportItemSet>
        <Static>
            <![CDATA[
                    </tbody>
                </table><br />
                
                <script type='text/javascript'>
                    $('#chairTable').dataTable({
                        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                        "iDisplayLength": -1
                    });
                    
                    $(".viewEvaluation").click(function(){
                        var href = $(this).attr('data-href');
                        $("#Recommendations").attr('href', href);
                        $("#Recommendations").trigger('click');
                    });
                </script>
                <script type='text/javascript' src='{$wgServer}{$wgScriptPath}/extensions/Reporting/Report/scripts/recommendations.js'></script>
            ]]>
        </Static>
    </ReportSection>
    <ReportSection id="recommendations" tooltip="Recommendation for Academic Staff Member" name="Recommendations" title="" blobSection="FEC_REVIEW" type="EditableReportSection" pagebreak="false" disabled="true">
        <ReportItemSet id="header" type="PersonReportItemSet" userId="{GET(userId)}">
            <If id="if" if="{isAllowedToViewRecommendation({$user_id})}">
                <Static>
                    <![CDATA[
                        <div id='generated' style="position:absolute; top:-1.75em;right:0;text-align:right;">{$user_name}<br /><i>Generated: {$timestamp}</i></div>
                        <script type='text/javascript'>
                            $('#generated').after("<div style='position:absolute;top:0;right:0;padding: 20px 20px 0 200px;background:white;'>{$user_name}</div>");
                        </script>
                    ]]>
                </Static>
                <Static>
                    <![CDATA[
                        <h1 style="margin-top:0;padding-top:0;">Recommendation for {$user_name}</h1>
                        <script type="text/javascript">
                            $("#reportMain form.autosave").attr("action", $("#reportMain form.autosave").attr("action") + "&userId={GET(userId)}");
                        </script>
                    ]]>
                </Static>
                <ReportItemSet id="header" type="ToggleHeader" title="Annual Report">
                    <ReportItem id="sticky" type="StickyNotes" blobType="BLOB_ARRAY" blobItem="STICKY" blobSubItem="{$user_id}" reportType="FECpdf" >
                        <![CDATA[
                            <div style='width:100%; display:flex; gap: 10px;'>
                                <div style='width:50%;'>
                                    <h3 style='margin-top:0;'>Instructions</h3>
                                    <ul>
                                        <li>Click on a word in the document below to annotate it with a "Sticky Note".  (Only words in headers can have a sticky note added)</li>
                                        <li>To delete an annotation, delete any text in the annotation and press the 'X' icon.</li>
                                        <li>Make sure to press the "Save" button at the bottom of the page after you have made changes.</li>
                                    </ul>
                                </div>
                                <div style='width:50%;'>
                                    <h3 style='margin-top:0;'>Historical Data</h3>
                                    <small>Note: These numbers are not reviewed by the Faculty members, so they may not be 100% accurate.</small>
                                    <table class='wikitable'>
                                        <tr>
                                            <th></th>
                                            <th style='width:75px;'>Refereed</th>
                                            <th style='width:75px;'>Books</th>
                                            <th style='width:75px;'>Patents</th>
                                        </tr>
                                        <tr>
                                            <td><b>{subtract({$this_year},1)}/{$this_year}</b></td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},1)}-07-01, {$this_year}-06-30,Publication)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},1)}-07-01, {$this_year}-06-30,Book)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},1)}-07-01, {$this_year}-06-30,Patent)}</td>
                                        </tr>
                                        <tr>
                                            <td><b>{subtract({$this_year},2)}/{subtract({$this_year},1)}</b></td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},2)}-07-01, {subtract({$this_year},1)}-06-30, Publication)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},2)}-07-01, {subtract({$this_year},1)}-06-30, Book)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},2)}-07-01, {subtract({$this_year},1)}-06-30, Patent)}</td>
                                        </tr>
                                        <tr>
                                            <td><b>{subtract({$this_year},3)}/{subtract({$this_year},2)}</b></td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},3)}-07-01, {subtract({$this_year},2)}-06-30, Publication)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},3)}-07-01, {subtract({$this_year},2)}-06-30, Book)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},3)}-07-01, {subtract({$this_year},2)}-06-30, Patent)}</td>
                                        </tr>
                                        <tr>
                                            <td><b>{subtract({$this_year},4)}/{subtract({$this_year},3)}</b></td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},4)}-07-01, {subtract({$this_year},3)}-06-30, Publication)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},4)}-07-01, {subtract({$this_year},3)}-06-30, Book)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},4)}-07-01, {subtract({$this_year},3)}-06-30, Patent)}</td>
                                        </tr>
                                        <tr>
                                            <td><b>{subtract({$this_year},5)}/{subtract({$this_year},4)}</b></td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},5)}-07-01, {subtract({$this_year},4)}-06-30, Publication)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},5)}-07-01, {subtract({$this_year},4)}-06-30, Book)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},5)}-07-01, {subtract({$this_year},4)}-06-30, Patent)}</td>
                                        </tr>
                                        <tr>
                                            <td><b>Lifetime</b></td>
                                            <td align='center'>{user_lifetime_pubs_count(Publication)}</td>
                                            <td align='center'>{user_lifetime_pubs_count(Book)}</td>
                                            <td align='center'>{user_lifetime_pubs_count(Patent)}</td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                            {$item}
                        ]]>
                    </ReportItem>
                </ReportItemSet>
                <ReportItem id="teaching" type="Textarea" blobType="BLOB_TEXT" blobItem="TEACHING" blobSubItem="{$user_id}" rich="true" encrypt="true">
                    <![CDATA[
                        <h2>Teaching Evaluations</h2>
                        {$item}
                    ]]>
                </ReportItem>
                <If if="{contains({$user_case_number}, T)}">
                    <ReportItem id="reduced_teaching" type="Textarea" blobType="BLOB_TEXT" blobItem="REDUCED_TEACHING" blobSubItem="{$user_id}" rich="true" encrypt="true">
                        <![CDATA[
                            <h2>Commentary on Reduced Teaching Load</h2>
                            <p class='pdfnodisplay'>If applicable, please comment on the "reasons for reduced teaching" provided by the ATS member; discuss your rationale for how you would "translate" these other duties into typical course-teaching duties.</p>
                            {$item}
                        ]]>
                    </ReportItem>
                </If>
                <ReportItem id="research" type="Textarea" blobType="BLOB_TEXT" blobItem="RESEARCH" blobSubItem="{$user_id}" rich="true" encrypt="true">
                    <![CDATA[
                        <h2>Research Evaluations</h2>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="departmental" type="Textarea" blobType="BLOB_TEXT" blobItem="DEPARTMENTAL" blobSubItem="{$user_id}" height="100px" rich="true" encrypt="true">
                    <![CDATA[
                        <h2>Service/Committees Evaluations</h2>
                        <h3>Departmental</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="faculty" type="Textarea" blobType="BLOB_TEXT" blobItem="FACULTY" blobSubItem="{$user_id}" height="100px" rich="true" encrypt="true">
                    <![CDATA[
                        <h3>Faculty</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="university" type="Textarea" blobType="BLOB_TEXT" blobItem="UNIVERSITY" blobSubItem="{$user_id}" height="100px" rich="true" encrypt="true">
                    <![CDATA[
                        <h3>University</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="scientific" type="Textarea" blobType="BLOB_TEXT" blobItem="SCIENTIFIC" blobSubItem="{$user_id}" height="100px" rich="true" encrypt="true">
                    <![CDATA[
                        <h3>Scientific</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="community" type="Textarea" blobType="BLOB_TEXT" blobItem="COMMUNITY" blobSubItem="{$user_id}" height="100px" rich="true" encrypt="true">
                    <![CDATA[
                        <h3>Community Outreach</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="other" type="Textarea" blobType="BLOB_TEXT" blobItem="OTHER" blobSubItem="{$user_id}" height="100px" rich="true" encrypt="true">
                    <![CDATA[
                        <h3>Other</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="general" type="Textarea" blobType="BLOB_TEXT" blobItem="GENERAL" blobSubItem="{$user_id}" rich="true" encrypt="true">
                    <![CDATA[
                        <h2>General Comments</h2>
                        {$item}
                    ]]>
                </ReportItem>
                <If if="{!contains({$user_case_number}, T)}">
                    <ReportItem id="increment" type="Increment" blobItem="INCREMENT" blobSubItem="{$user_id}" width="100%" encrypt="true">
                        <![CDATA[
                            <h3>Recommendations</h3>
                            <table id="chairTable" class="wikitable" width="100%">
                            <thead>
                                <tr>
                                    <th>Increment</th>
                                    <th>Tenure</th>
                                    <th>Promotion</th>
                                </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td align='center' valign='middle' class='increment' style="white-space:nowrap;">{$item}</td>
                        ]]>
                    </ReportItem>
                    <ReportItem id="tenure" type="Tenure" blobItem="TENURE" blobSubItem="{$user_id}" width="100%" encrypt="true">
                        <![CDATA[
                                <td align='center' class='tenure'>{$item}</td>
                        ]]>
                    </ReportItem>
                </If>
                <Else>
                    <ReportItem id="increment" type="Increment" blobItem="INCREMENT" blobSubItem="{$user_id}" width="100%" encrypt="true">
                        <![CDATA[
                            <h3>Recommendations</h3>
                            <table id="chairTable" class="wikitable" width="100%">
                            <thead>
                                <tr>
                                    <th>Increment</th>
                                    <th>Promotion</th>
                                </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td align='center' valign='middle' class='increment' style="white-space:nowrap;">{$item}</td>
                        ]]>
                    </ReportItem>
                </Else>
                <ReportItem id="promotion" type="Promotion" blobItem="PROMOTION" blobSubItem="{$user_id}" width="100%" encrypt="true">
                    <![CDATA[
                            <td align='center' class='promotion'>{$item}</td>
                        </tr>
                        </tbody>
                        </table>
                        <hr class="pdfnodisplay" />
                        <script type='text/javascript' src='{$wgServer}{$wgScriptPath}/extensions/Reporting/Report/scripts/recommendations.js'></script>
                    ]]>
                </ReportItem>
                <ReportItem id="file1" type="Upload" blobItem="FILE1" blobSubItem="{$user_id}" blobType="BLOB_RAW" mimeType="application/pdf" fileSize="30" encrypt="true">
                    <![CDATA[
                        <div class='files' id='file1'>{$item}</div>
                    ]]>
                </ReportItem>
                <ReportItem id="file2" type="Upload" blobItem="FILE2" blobSubItem="{$user_id}" blobType="BLOB_RAW" mimeType="application/pdf" fileSize="30" encrypt="true">
                    <![CDATA[
                        <div class='files' id='file2'>{$item}</div>
                        <script type='text/javascript'> if('{getBlobMD5()}' != ''){ $('#file2').show(); } else { $('#file2').hide(); } </script>
                    ]]>
                </ReportItem>
                <ReportItem id="file3" type="Upload" blobItem="FILE3" blobSubItem="{$user_id}" blobType="BLOB_RAW" mimeType="application/pdf" fileSize="30" encrypt="true">
                    <![CDATA[
                        <div class='files' id='file3'>{$item}</div>
                        <script type='text/javascript'> if('{getBlobMD5()}' != ''){ $('#file3').show(); } else { $('#file3').hide(); } </script>
                    ]]>
                </ReportItem>
                <Static>
                    <![CDATA[
                        <button id='addFile' type='button' class='pdfnodisplay'>Add another file</button>
                        <script type='text/javascript'>
                            $('#addFile').click(function(){
                                $('.files:not(:visible)').first().show();
                                $('iframe', $('.files:visible').last())[0].src = $('iframe', $('.files:visible').last())[0].src;
                                if($('.files:not(:visible)').length == 0){
                                    $('#addFile').prop('disabled', true);
                                }
                            });
                        </script>
                    ]]>
                </Static>
                <ReportItem id="submit" type="SimpleReviewSubmit" section="Recommendations" userId="{$user_id}">
                    <![CDATA[
                        {$item}
                    ]]>
                </ReportItem>
            </If>
            <Else id="else">
                <![CDATA[
                    <p>You are not allowed to view the recommendations for this user.</p>
                ]]>
            </Else>
        </ReportItemSet>
    </ReportSection>
    <ReportSection id="deans_advice" tooltip="Dean's Advice for Academic Staff Member" name="Dean Advice" title="" blobSection="FEC_DEAN_ADVICE" type="EditableReportSection" pagebreak="false" disabled="true">
        <ReportItemSet id="header" type="PersonReportItemSet" userId="{GET(userId)}">
            <If id="if" if="{isAllowedToViewRecommendation({$user_id})}">
                <Static>
                    <![CDATA[
                        <div id='generated' style="position:absolute; top:-1.75em;right:0;text-align:right;">{$user_name}<br /><i>Generated: {$timestamp}</i></div>
                        <script type='text/javascript'>
                            $('#generated').after("<div style='position:absolute;top:0;right:0;padding: 20px 20px 0 200px;background:white;'>{$user_name}</div>");
                        </script>
                    ]]>
                </Static>
                <Static>
                    <![CDATA[
                        <h1 style="margin-top:0;padding-top:0;">Dean's Advice for {$user_name}</h1>
                        <script type="text/javascript">
                            $("#reportMain form.autosave").attr("action", $("#reportMain form.autosave").attr("action") + "&userId={GET(userId)}");
                        </script>
                    ]]>
                </Static>
                <ReportItemSet id="header" type="ToggleHeader" title="Annual Report">
                    <ReportItem id="sticky" type="StickyNotes" blobType="BLOB_ARRAY" blobItem="STICKY" blobSubItem="{$user_id}" reportType="FECpdf">
                        <![CDATA[
                            <div style='width:100%; display:flex; gap: 10px;'>
                                <div style='width:50%;'>
                                    <h3 style='margin-top:0;'>Instructions</h3>
                                    <ul>
                                        <li>Click on a word in the document below to annotate it with a "Sticky Note".  (Only words in headers can have a sticky note added)</li>
                                        <li>To delete an annotation, delete any text in the annotation and press the 'X' icon.</li>
                                        <li>Make sure to press the "Save" button at the bottom of the page after you have made changes.</li>
                                    </ul>
                                </div>
                                <div style='width:50%;'>
                                    <h3 style='margin-top:0;'>Historical Data</h3>
                                    <small>Note: These numbers are not reviewed by the Faculty members, so they may not be 100% accurate.</small>
                                    <table class='wikitable'>
                                        <tr>
                                            <th></th>
                                            <th style='width:75px;'>Refereed</th>
                                            <th style='width:75px;'>Books</th>
                                            <th style='width:75px;'>Patents</th>
                                        </tr>
                                        <tr>
                                            <td><b>{subtract({$this_year},1)}/{$this_year}</b></td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},1)}-07-01, {$this_year}-06-30,Publication)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},1)}-07-01, {$this_year}-06-30,Book)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},1)}-07-01, {$this_year}-06-30,Patent)}</td>
                                        </tr>
                                        <tr>
                                            <td><b>{subtract({$this_year},2)}/{subtract({$this_year},1)}</b></td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},2)}-07-01, {subtract({$this_year},1)}-06-30, Publication)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},2)}-07-01, {subtract({$this_year},1)}-06-30, Book)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},2)}-07-01, {subtract({$this_year},1)}-06-30, Patent)}</td>
                                        </tr>
                                        <tr>
                                            <td><b>{subtract({$this_year},3)}/{subtract({$this_year},2)}</b></td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},3)}-07-01, {subtract({$this_year},2)}-06-30, Publication)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},3)}-07-01, {subtract({$this_year},2)}-06-30, Book)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},3)}-07-01, {subtract({$this_year},2)}-06-30, Patent)}</td>
                                        </tr>
                                        <tr>
                                            <td><b>{subtract({$this_year},4)}/{subtract({$this_year},3)}</b></td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},4)}-07-01, {subtract({$this_year},3)}-06-30, Publication)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},4)}-07-01, {subtract({$this_year},3)}-06-30, Book)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},4)}-07-01, {subtract({$this_year},3)}-06-30, Patent)}</td>
                                        </tr>
                                        <tr>
                                            <td><b>{subtract({$this_year},5)}/{subtract({$this_year},4)}</b></td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},5)}-07-01, {subtract({$this_year},4)}-06-30, Publication)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},5)}-07-01, {subtract({$this_year},4)}-06-30, Book)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},5)}-07-01, {subtract({$this_year},4)}-06-30, Patent)}</td>
                                        </tr>
                                        <tr>
                                            <td><b>Lifetime</b></td>
                                            <td align='center'>{user_lifetime_pubs_count(Publication)}</td>
                                            <td align='center'>{user_lifetime_pubs_count(Book)}</td>
                                            <td align='center'>{user_lifetime_pubs_count(Patent)}</td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                            {$item}
                        ]]>
                    </ReportItem>
                </ReportItemSet>
                <ReportItem id="teaching" type="Textarea" blobType="BLOB_TEXT" blobItem="TEACHING" blobSubItem="{$user_id}" rich="true">
                    <![CDATA[
                        <h2>Teaching Evaluations</h2>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="research" type="Textarea" blobType="BLOB_TEXT" blobItem="RESEARCH" blobSubItem="{$user_id}" rich="true">
                    <![CDATA[
                        <h2>Research Evaluations</h2>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="departmental" type="Textarea" blobType="BLOB_TEXT" blobItem="DEPARTMENTAL" blobSubItem="{$user_id}" height="100px" rich="true">
                    <![CDATA[
                        <h2>Service/Committees Evaluations</h2>
                        <h3>Departmental</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="faculty" type="Textarea" blobType="BLOB_TEXT" blobItem="FACULTY" blobSubItem="{$user_id}" height="100px" rich="true">
                    <![CDATA[
                        <h3>Faculty</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="university" type="Textarea" blobType="BLOB_TEXT" blobItem="UNIVERSITY" blobSubItem="{$user_id}" height="100px" rich="true">
                    <![CDATA[
                        <h3>University</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="scientific" type="Textarea" blobType="BLOB_TEXT" blobItem="SCIENTIFIC" blobSubItem="{$user_id}" height="100px" rich="true">
                    <![CDATA[
                        <h3>Scientific</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="community" type="Textarea" blobType="BLOB_TEXT" blobItem="COMMUNITY" blobSubItem="{$user_id}" height="100px" rich="true">
                    <![CDATA[
                        <h3>Community Outreach</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="other" type="Textarea" blobType="BLOB_TEXT" blobItem="OTHER" blobSubItem="{$user_id}" height="100px" rich="true">
                    <![CDATA[
                        <h3>Other</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="general" type="Textarea" blobType="BLOB_TEXT" blobItem="GENERAL" blobSubItem="{$user_id}" rich="true">
                    <![CDATA[
                        <h2>General Comments</h2>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="increment" type="Increment" blobItem="INCREMENT" blobSubItem="{$user_id}" width="100%" encrypt="true">
                    <![CDATA[
                        <h3>Recommendations</h3>
                        <table id="chairTable" class="wikitable" width="100%">
                        <thead>
                            <tr>
                                <th>Increment</th>
                                <th>Tenure</th>
                                <th>Promotion</th>
                            </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td align='center' valign='middle' class='increment' style="white-space:nowrap;">{$item}</td>
                    ]]>
                </ReportItem>
                <ReportItem id="tenure" type="Tenure" blobItem="TENURE" blobSubItem="{$user_id}" width="100%" encrypt="true">
                    <![CDATA[
                            <td align='center' class='tenure'>{$item}</td>
                    ]]>
                </ReportItem>
                <ReportItem id="promotion" type="Promotion" blobItem="PROMOTION" blobSubItem="{$user_id}" width="100%" encrypt="true">
                    <![CDATA[
                            <td align='center' class='promotion'>{$item}</td>
                        </tr>
                        </tbody>
                        </table>
                        <hr class="pdfnodisplay" />
                        <script type='text/javascript' src='{$wgServer}{$wgScriptPath}/extensions/Reporting/Report/scripts/recommendations.js'></script>
                    ]]>
                </ReportItem>
                <ReportItem id="file1" type="Upload" blobItem="FILE1" blobSubItem="{$user_id}" blobType="BLOB_RAW" mimeType="application/pdf" fileSize="30" encrypt="true">
                    <![CDATA[
                        <div class='files' id='file1'>{$item}</div>
                    ]]>
                </ReportItem>
                <ReportItem id="file2" type="Upload" blobItem="FILE2" blobSubItem="{$user_id}" blobType="BLOB_RAW" mimeType="application/pdf" fileSize="30" encrypt="true">
                    <![CDATA[
                        <div class='files' id='file2'>{$item}</div>
                        <script type='text/javascript'> if('{getBlobMD5()}' != ''){ $('#file2').show(); } else { $('#file2').hide(); } </script>
                    ]]>
                </ReportItem>
                <ReportItem id="file3" type="Upload" blobItem="FILE3" blobSubItem="{$user_id}" blobType="BLOB_RAW" mimeType="application/pdf" fileSize="30" encrypt="true">
                    <![CDATA[
                        <div class='files' id='file3'>{$item}</div>
                        <script type='text/javascript'> if('{getBlobMD5()}' != ''){ $('#file3').show(); } else { $('#file3').hide(); } </script>
                    ]]>
                </ReportItem>
                <Static>
                    <![CDATA[
                        <button id='addFile' type='button' class='pdfnodisplay'>Add another file</button>
                        <script type='text/javascript'>
                            $('#addFile').click(function(){
                                $('.files:not(:visible)').first().show();
                                $('iframe', $('.files:visible').last())[0].src = $('iframe', $('.files:visible').last())[0].src;
                                if($('.files:not(:visible)').length == 0){
                                    $('#addFile').prop('disabled', true);
                                }
                            });
                        </script>
                    ]]>
                </Static>
                <ReportItem id="submit" type="SimpleReviewSubmit" section="Dean Advice" userId="{$user_id}">
                    <![CDATA[
                        {$item}
                    ]]>
                </ReportItem>
            </If>
            <Else id="else">
                <![CDATA[
                    <p>You are not allowed to view the recommendations for this user.</p>
                ]]>
            </Else>
        </ReportItemSet>
    </ReportSection>
    <ReportSection id="deans_decision" tooltip="Dean's Decision for Academic Staff Member" name="Dean Decision" title="" blobSection="FEC_DEAN_DECISION" type="EditableReportSection" pagebreak="false" disabled="true">
        <ReportItemSet id="header" type="PersonReportItemSet" userId="{GET(userId)}">
            <If id="if" if="{isAllowedToViewRecommendation({$user_id})}">
                <Static>
                    <![CDATA[
                        <div id='generated' style="position:absolute; top:-1.75em;right:0;text-align:right;">{$user_name}<br /><i>Generated: {$timestamp}</i></div>
                        <script type='text/javascript'>
                            $('#generated').after("<div style='position:absolute;top:0;right:0;padding: 20px 20px 0 200px;background:white;'>{$user_name}</div>");
                        </script>
                    ]]>
                </Static>
                <Static>
                    <![CDATA[
                        <h1 style="margin-top:0;padding-top:0;">Dean's Decision for {$user_name}</h1>
                        <script type="text/javascript">
                            $("#reportMain form.autosave").attr("action", $("#reportMain form.autosave").attr("action") + "&userId={GET(userId)}");
                        </script>
                    ]]>
                </Static>
                <ReportItemSet id="header" type="ToggleHeader" title="Annual Report">
                    <ReportItem id="sticky" type="StickyNotes" blobType="BLOB_ARRAY" blobItem="STICKY" blobSubItem="{$user_id}" reportType="FECpdf" >
                        <![CDATA[
                            <div style='width:100%; display:flex; gap: 10px;'>
                                <div style='width:50%;'>
                                    <h3 style='margin-top:0;'>Instructions</h3>
                                    <ul>
                                        <li>Click on a word in the document below to annotate it with a "Sticky Note".  (Only words in headers can have a sticky note added)</li>
                                        <li>To delete an annotation, delete any text in the annotation and press the 'X' icon.</li>
                                        <li>Make sure to press the "Save" button at the bottom of the page after you have made changes.</li>
                                    </ul>
                                </div>
                                <div style='width:50%;'>
                                    <h3 style='margin-top:0;'>Historical Data</h3>
                                    <small>Note: These numbers are not reviewed by the Faculty members, so they may not be 100% accurate.</small>
                                    <table class='wikitable'>
                                        <tr>
                                            <th></th>
                                            <th style='width:75px;'>Refereed</th>
                                            <th style='width:75px;'>Books</th>
                                            <th style='width:75px;'>Patents</th>
                                        </tr>
                                        <tr>
                                            <td><b>{subtract({$this_year},1)}/{$this_year}</b></td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},1)}-07-01, {$this_year}-06-30,Publication)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},1)}-07-01, {$this_year}-06-30,Book)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},1)}-07-01, {$this_year}-06-30,Patent)}</td>
                                        </tr>
                                        <tr>
                                            <td><b>{subtract({$this_year},2)}/{subtract({$this_year},1)}</b></td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},2)}-07-01, {subtract({$this_year},1)}-06-30, Publication)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},2)}-07-01, {subtract({$this_year},1)}-06-30, Book)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},2)}-07-01, {subtract({$this_year},1)}-06-30, Patent)}</td>
                                        </tr>
                                        <tr>
                                            <td><b>{subtract({$this_year},3)}/{subtract({$this_year},2)}</b></td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},3)}-07-01, {subtract({$this_year},2)}-06-30, Publication)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},3)}-07-01, {subtract({$this_year},2)}-06-30, Book)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},3)}-07-01, {subtract({$this_year},2)}-06-30, Patent)}</td>
                                        </tr>
                                        <tr>
                                            <td><b>{subtract({$this_year},4)}/{subtract({$this_year},3)}</b></td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},4)}-07-01, {subtract({$this_year},3)}-06-30, Publication)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},4)}-07-01, {subtract({$this_year},3)}-06-30, Book)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},4)}-07-01, {subtract({$this_year},3)}-06-30, Patent)}</td>
                                        </tr>
                                        <tr>
                                            <td><b>{subtract({$this_year},5)}/{subtract({$this_year},4)}</b></td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},5)}-07-01, {subtract({$this_year},4)}-06-30, Publication)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},5)}-07-01, {subtract({$this_year},4)}-06-30, Book)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},5)}-07-01, {subtract({$this_year},4)}-06-30, Patent)}</td>
                                        </tr>
                                        <tr>
                                            <td><b>Lifetime</b></td>
                                            <td align='center'>{user_lifetime_pubs_count(Publication)}</td>
                                            <td align='center'>{user_lifetime_pubs_count(Book)}</td>
                                            <td align='center'>{user_lifetime_pubs_count(Patent)}</td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                            {$item}
                        ]]>
                    </ReportItem>
                </ReportItemSet>
                <ReportItem id="teaching" type="Textarea" blobType="BLOB_TEXT" blobItem="TEACHING" blobSubItem="{$user_id}" rich="true">
                    <![CDATA[
                        <h2>Teaching Evaluations</h2>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="research" type="Textarea" blobType="BLOB_TEXT" blobItem="RESEARCH" blobSubItem="{$user_id}" rich="true">
                    <![CDATA[
                        <h2>Research Evaluations</h2>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="departmental" type="Textarea" blobType="BLOB_TEXT" blobItem="DEPARTMENTAL" blobSubItem="{$user_id}" height="100px" rich="true">
                    <![CDATA[
                        <h2>Service/Committees Evaluations</h2>
                        <h3>Departmental</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="faculty" type="Textarea" blobType="BLOB_TEXT" blobItem="FACULTY" blobSubItem="{$user_id}" height="100px" rich="true">
                    <![CDATA[
                        <h3>Faculty</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="university" type="Textarea" blobType="BLOB_TEXT" blobItem="UNIVERSITY" blobSubItem="{$user_id}" height="100px" rich="true">
                    <![CDATA[
                        <h3>University</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="scientific" type="Textarea" blobType="BLOB_TEXT" blobItem="SCIENTIFIC" blobSubItem="{$user_id}" height="100px" rich="true">
                    <![CDATA[
                        <h3>Scientific</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="community" type="Textarea" blobType="BLOB_TEXT" blobItem="COMMUNITY" blobSubItem="{$user_id}" height="100px" rich="true">
                    <![CDATA[
                        <h3>Community Outreach</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="other" type="Textarea" blobType="BLOB_TEXT" blobItem="OTHER" blobSubItem="{$user_id}" height="100px" rich="true">
                    <![CDATA[
                        <h3>Other</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="general" type="Textarea" blobType="BLOB_TEXT" blobItem="GENERAL" blobSubItem="{$user_id}" rich="true">
                    <![CDATA[
                        <h2>General Comments</h2>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="increment" type="Increment" blobItem="INCREMENT" blobSubItem="{$user_id}" width="100%" encrypt="true">
                    <![CDATA[
                        <h3>Recommendations</h3>
                        <table id="chairTable" class="wikitable" width="100%">
                        <thead>
                            <tr>
                                <th>Increment</th>
                                <th>Tenure</th>
                                <th>Promotion</th>
                            </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td align='center' valign='middle' class='increment' style="white-space:nowrap;">{$item}</td>
                    ]]>
                </ReportItem>
                <ReportItem id="tenure" type="Tenure" blobItem="TENURE" blobSubItem="{$user_id}" width="100%" encrypt="true">
                    <![CDATA[
                            <td align='center' class='tenure'>{$item}</td>
                    ]]>
                </ReportItem>
                <ReportItem id="promotion" type="Promotion" blobItem="PROMOTION" blobSubItem="{$user_id}" width="100%" encrypt="true">
                    <![CDATA[
                            <td align='center' class='promotion'>{$item}</td>
                        </tr>
                        </tbody>
                        </table>
                        <hr class="pdfnodisplay" />
                        <script type='text/javascript' src='{$wgServer}{$wgScriptPath}/extensions/Reporting/Report/scripts/recommendations.js'></script>
                    ]]>
                </ReportItem>
                <ReportItem id="file1" type="Upload" blobItem="FILE1" blobSubItem="{$user_id}" blobType="BLOB_RAW" mimeType="application/pdf" fileSize="30" encrypt="true">
                    <![CDATA[
                        <div class='files' id='file1'>{$item}</div>
                    ]]>
                </ReportItem>
                <ReportItem id="file2" type="Upload" blobItem="FILE2" blobSubItem="{$user_id}" blobType="BLOB_RAW" mimeType="application/pdf" fileSize="30" encrypt="true">
                    <![CDATA[
                        <div class='files' id='file2'>{$item}</div>
                        <script type='text/javascript'> if('{getBlobMD5()}' != ''){ $('#file2').show(); } else { $('#file2').hide(); } </script>
                    ]]>
                </ReportItem>
                <ReportItem id="file3" type="Upload" blobItem="FILE3" blobSubItem="{$user_id}" blobType="BLOB_RAW" mimeType="application/pdf" fileSize="30" encrypt="true">
                    <![CDATA[
                        <div class='files' id='file3'>{$item}</div>
                        <script type='text/javascript'> if('{getBlobMD5()}' != ''){ $('#file3').show(); } else { $('#file3').hide(); } </script>
                    ]]>
                </ReportItem>
                <Static>
                    <![CDATA[
                        <button id='addFile' type='button' class='pdfnodisplay'>Add another file</button>
                        <script type='text/javascript'>
                            $('#addFile').click(function(){
                                $('.files:not(:visible)').first().show();
                                $('iframe', $('.files:visible').last())[0].src = $('iframe', $('.files:visible').last())[0].src;
                                if($('.files:not(:visible)').length == 0){
                                    $('#addFile').prop('disabled', true);
                                }
                            });
                        </script>
                    ]]>
                </Static>
                <ReportItem id="submit" type="SimpleReviewSubmit" section="Dean Decision" userId="{$user_id}">
                    <![CDATA[
                        {$item}
                    ]]>
                </ReportItem>
            </If>
            <Else id="else">
                <![CDATA[
                    <p>You are not allowed to view the recommendations for this user.</p>
                ]]>
            </Else>
        </ReportItemSet>
    </ReportSection>
    <ReportSection id="chairs_advice" tooltip="Chair's Advice for Academic Staff Member" name="Chair Advice" title="" blobSection="FEC_CHAIR_ADVICE" type="EditableReportSection" pagebreak="false" disabled="true">
        <ReportItemSet id="header" type="PersonReportItemSet" userId="{GET(userId)}">
            <If id="if" if="{isAllowedToViewRecommendation({$user_id})}">
                <Static>
                    <![CDATA[
                        <div id='generated' style="position:absolute; top:-1.75em;right:0;text-align:right;">{$user_name}<br /><i>Generated: {$timestamp}</i></div>
                        <script type='text/javascript'>
                            $('#generated').after("<div style='position:absolute;top:0;right:0;padding: 20px 20px 0 200px;background:white;'>{$user_name}</div>");
                        </script>
                    ]]>
                </Static>
                <Static>
                    <![CDATA[
                        <h1 style="margin-top:0;padding-top:0;">Chair's Advice for {$user_name}</h1>
                        <script type="text/javascript">
                            $("#reportMain form.autosave").attr("action", $("#reportMain form.autosave").attr("action") + "&userId={GET(userId)}");
                        </script>
                    ]]>
                </Static>
                <ReportItemSet id="header" type="ToggleHeader" title="Annual Report">
                    <ReportItem id="sticky" type="StickyNotes" blobType="BLOB_ARRAY" blobItem="STICKY" blobSubItem="{$user_id}" reportType="FECpdf" >
                        <![CDATA[
                            <div style='width:100%; display:flex; gap: 10px;'>
                                <div style='width:50%;'>
                                    <h3 style='margin-top:0;'>Instructions</h3>
                                    <ul>
                                        <li>Click on a word in the document below to annotate it with a "Sticky Note".  (Only words in headers can have a sticky note added)</li>
                                        <li>To delete an annotation, delete any text in the annotation and press the 'X' icon.</li>
                                        <li>Make sure to press the "Save" button at the bottom of the page after you have made changes.</li>
                                    </ul>
                                </div>
                                <div style='width:50%;'>
                                    <h3 style='margin-top:0;'>Historical Data</h3>
                                    <small>Note: These numbers are not reviewed by the Faculty members, so they may not be 100% accurate.</small>
                                    <table class='wikitable'>
                                        <tr>
                                            <th></th>
                                            <th style='width:75px;'>Refereed</th>
                                            <th style='width:75px;'>Books</th>
                                            <th style='width:75px;'>Patents</th>
                                        </tr>
                                        <tr>
                                            <td><b>{subtract({$this_year},1)}/{$this_year}</b></td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},1)}-07-01, {$this_year}-06-30,Publication)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},1)}-07-01, {$this_year}-06-30,Book)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},1)}-07-01, {$this_year}-06-30,Patent)}</td>
                                        </tr>
                                        <tr>
                                            <td><b>{subtract({$this_year},2)}/{subtract({$this_year},1)}</b></td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},2)}-07-01, {subtract({$this_year},1)}-06-30, Publication)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},2)}-07-01, {subtract({$this_year},1)}-06-30, Book)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},2)}-07-01, {subtract({$this_year},1)}-06-30, Patent)}</td>
                                        </tr>
                                        <tr>
                                            <td><b>{subtract({$this_year},3)}/{subtract({$this_year},2)}</b></td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},3)}-07-01, {subtract({$this_year},2)}-06-30, Publication)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},3)}-07-01, {subtract({$this_year},2)}-06-30, Book)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},3)}-07-01, {subtract({$this_year},2)}-06-30, Patent)}</td>
                                        </tr>
                                        <tr>
                                            <td><b>{subtract({$this_year},4)}/{subtract({$this_year},3)}</b></td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},4)}-07-01, {subtract({$this_year},3)}-06-30, Publication)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},4)}-07-01, {subtract({$this_year},3)}-06-30, Book)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},4)}-07-01, {subtract({$this_year},3)}-06-30, Patent)}</td>
                                        </tr>
                                        <tr>
                                            <td><b>{subtract({$this_year},5)}/{subtract({$this_year},4)}</b></td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},5)}-07-01, {subtract({$this_year},4)}-06-30, Publication)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},5)}-07-01, {subtract({$this_year},4)}-06-30, Book)}</td>
                                            <td align='center'>{getUserPublicationCount({subtract({$this_year},5)}-07-01, {subtract({$this_year},4)}-06-30, Patent)}</td>
                                        </tr>
                                        <tr>
                                            <td><b>Lifetime</b></td>
                                            <td align='center'>{user_lifetime_pubs_count(Publication)}</td>
                                            <td align='center'>{user_lifetime_pubs_count(Book)}</td>
                                            <td align='center'>{user_lifetime_pubs_count(Patent)}</td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                            {$item}
                        ]]>
                    </ReportItem>
                </ReportItemSet>
                <ReportItem id="teaching" type="Textarea" blobType="BLOB_TEXT" blobItem="TEACHING" blobSubItem="{$user_id}" rich="true">
                    <![CDATA[
                        <h2>Teaching Evaluations</h2>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="research" type="Textarea" blobType="BLOB_TEXT" blobItem="RESEARCH" blobSubItem="{$user_id}" rich="true">
                    <![CDATA[
                        <h2>Research Evaluations</h2>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="departmental" type="Textarea" blobType="BLOB_TEXT" blobItem="DEPARTMENTAL" blobSubItem="{$user_id}" height="100px" rich="true">
                    <![CDATA[
                        <h2>Service/Committees Evaluations</h2>
                        <h3>Departmental</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="faculty" type="Textarea" blobType="BLOB_TEXT" blobItem="FACULTY" blobSubItem="{$user_id}" height="100px" rich="true">
                    <![CDATA[
                        <h3>Faculty</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="university" type="Textarea" blobType="BLOB_TEXT" blobItem="UNIVERSITY" blobSubItem="{$user_id}" height="100px" rich="true">
                    <![CDATA[
                        <h3>University</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="scientific" type="Textarea" blobType="BLOB_TEXT" blobItem="SCIENTIFIC" blobSubItem="{$user_id}" height="100px" rich="true">
                    <![CDATA[
                        <h3>Scientific</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="community" type="Textarea" blobType="BLOB_TEXT" blobItem="COMMUNITY" blobSubItem="{$user_id}" height="100px" rich="true">
                    <![CDATA[
                        <h3>Community Outreach</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="other" type="Textarea" blobType="BLOB_TEXT" blobItem="OTHER" blobSubItem="{$user_id}" height="100px" rich="true">
                    <![CDATA[
                        <h3>Other</h3>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="general" type="Textarea" blobType="BLOB_TEXT" blobItem="GENERAL" blobSubItem="{$user_id}" rich="true">
                    <![CDATA[
                        <h2>General Comments</h2>
                        {$item}
                    ]]>
                </ReportItem>
                <ReportItem id="increment" type="Increment" blobItem="INCREMENT" blobSubItem="{$user_id}" width="100%" encrypt="true">
                    <![CDATA[
                        <h3>Recommendations</h3>
                        <table id="chairTable" class="wikitable" width="100%">
                        <thead>
                            <tr>
                                <th>Increment</th>
                                <th>Tenure</th>
                                <th>Promotion</th>
                            </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td align='center' valign='middle' class='increment' style="white-space:nowrap;">{$item}</td>
                    ]]>
                </ReportItem>
                <ReportItem id="tenure" type="Tenure" blobItem="TENURE" blobSubItem="{$user_id}" width="100%" encrypt="true">
                    <![CDATA[
                            <td align='center' class='tenure'>{$item}</td>
                    ]]>
                </ReportItem>
                <ReportItem id="promotion" type="Promotion" blobItem="PROMOTION" blobSubItem="{$user_id}" width="100%" encrypt="true">
                    <![CDATA[
                            <td align='center' class='promotion'>{$item}</td>
                        </tr>
                        </tbody>
                        </table>
                        <hr class="pdfnodisplay" />
                        <script type='text/javascript' src='{$wgServer}{$wgScriptPath}/extensions/Reporting/Report/scripts/recommendations.js'></script>
                    ]]>
                </ReportItem>
                <ReportItem id="file1" type="Upload" blobItem="FILE1" blobSubItem="{$user_id}" blobType="BLOB_RAW" mimeType="application/pdf" fileSize="30" encrypt="true">
                    <![CDATA[
                        <div class='files' id='file1'>{$item}</div>
                    ]]>
                </ReportItem>
                <ReportItem id="file2" type="Upload" blobItem="FILE2" blobSubItem="{$user_id}" blobType="BLOB_RAW" mimeType="application/pdf" fileSize="30" encrypt="true">
                    <![CDATA[
                        <div class='files' id='file2'>{$item}</div>
                        <script type='text/javascript'> if('{getBlobMD5()}' != ''){ $('#file2').show(); } else { $('#file2').hide(); } </script>
                    ]]>
                </ReportItem>
                <ReportItem id="file3" type="Upload" blobItem="FILE3" blobSubItem="{$user_id}" blobType="BLOB_RAW" mimeType="application/pdf" fileSize="30" encrypt="true">
                    <![CDATA[
                        <div class='files' id='file3'>{$item}</div>
                        <script type='text/javascript'> if('{getBlobMD5()}' != ''){ $('#file3').show(); } else { $('#file3').hide(); } </script>
                    ]]>
                </ReportItem>
                <Static>
                    <![CDATA[
                        <button id='addFile' type='button' class='pdfnodisplay'>Add another file</button>
                        <script type='text/javascript'>
                            $('#addFile').click(function(){
                                $('.files:not(:visible)').first().show();
                                $('iframe', $('.files:visible').last())[0].src = $('iframe', $('.files:visible').last())[0].src;
                                if($('.files:not(:visible)').length == 0){
                                    $('#addFile').prop('disabled', true);
                                }
                            });
                        </script>
                    ]]>
                </Static>
                <ReportItem id="submit" type="SimpleReviewSubmit" section="Chair Advice" userId="{$user_id}">
                    <![CDATA[
                        {$item}
                    ]]>
                </ReportItem>
            </If>
            <Else id="else">
                <![CDATA[
                    <p>You are not allowed to view the recommendations for this user.</p>
                ]]>
            </Else>
        </ReportItemSet>
    </ReportSection>
    <ReportSection id="dept_hqp" tooltip="HQP Inconsistencies" name="HQP Inconsistencies" title="{$my_dept} HQP Inconsistencies" blobSection="BLOB_NONE" type="ReportSection">
        <Static>
            <![CDATA[
                <p>
                    Some inconsistencies related to HQP relations will be shown below<br />
                    <i><b>Note:</b> Because of how some relations may overlap, there could be some false positives.</i>
                </p>
            ]]>
        </Static>
        <ReportItemSet id="faculty" type="DepartmentPeopleReportItemSet" department="{$my_dept}" start="{$last_year}-07-01" end="{$this_year}-07-01" university="University of Alberta" excludeMe="true">
            <ReportItem id="hqp" type="HQPInconsistencies" start="{$last_year}-07-01" end="{$this_year}-07-01">
                <![CDATA[
                    <h2>{$user_name}</h2>
                    {$item}
                ]]>
            </ReportItem>
        </ReportItemSet>
    </ReportSection>
    <ReportSection id="sabbatical" type="EditableReportSection" name="Sabbatical Applications" title="Sabbatical Applications" blobSection="FEC_SABBATICAL">
        <Static>
            <![CDATA[
                <style>
                    table#chairTable * {
                        font-size:11px !important;
                    }
                    .remove {
                        display: none;
                    }
                </style>
                <table id='chairTable' class='wikitable' frame='box' rules='all'>
                    <thead>
                        <tr>
                            <th>Case#</th>
                            <th>Name</th>
                            <th>Rank</th>
                            <th width="1%">Application</th>
                            <th width="1%">Decision</th>
                            <th>Comments</th>
                            <th>Decision PDF</th>
                    </thead>
                    <tbody>
            ]]>
        </Static>
        <ReportItemSet id="faculty" type="DepartmentPeopleReportItemSet" department="{$my_dept}" start="{$last_year}-07-01" end="{$this_year}-07-01" university="University of Alberta" excludeMe="true">
            <ReportItem type="PDFReportItem" reportType="SabbaticalApplication" class="" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                <![CDATA[
                    {set(pdf, {$value})}
                ]]>
            </ReportItem>
            <Static>
                <![CDATA[
                    <tr data-fecid="{getExtra()}" {if("{get(pdf)}" == "", class='remove')}>
                        <td>{getExtra()}</td>
                        <td><a href="{$user_url}" target="_blank">{$user_name}</a></td>
                        <td>{$user_level}</td>
                ]]>
            </Static>
            <ReportItem id="download" type="PDFReportItem" reportType="SabbaticalApplication" class="" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                <![CDATA[
                        <td align='center'>
                            {$item}
                        </td>
                ]]>
            </ReportItem>
            <ReportItem id="decision" type="Select" blobItem="DECISION" blobSubItem="{$user_id}" blobSection="FEC_SABBATICAL" options="|Yes|No|Conditionally" encrypt="true">
                <![CDATA[
                        <td align='center'>{$item}</td>
                ]]>
            </ReportItem>
            <ReportItem id="comments" type="Textarea" blobItem="COMMENTS" blobSubItem="{$user_id}" blobSection="FEC_SABBATICAL" width="100%" height="90px" encrypt="true">
                <![CDATA[
                        <td align='center'>{$item}</td>
                ]]>
            </ReportItem>
            <ReportItem id="pdf" type="PDFReportItem" class="recommendationPDF downloadButton{$user_id}" reportType="ChairSabbaticalApplication" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />">
                <![CDATA[
                        <td align='center'>
                        {$item}<br />
                        <input class='generatePDF' data-id='{$user_id}' type='button' value='Generate PDF' />
                    </tr>
                ]]>
            </ReportItem>
        </ReportItemSet>
        <Static>
            <![CDATA[
                    </tbody>
                </table>
                <script type='text/javascript'>
                    $('tr.remove').remove();
                    $('#chairTable').dataTable({
                        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                        "iDisplayLength": -1
                    });
                    
                    $('.generatePDF').click(function(){
                        $(this).prop('disabled', true);
                        var userId = $(this).attr('data-id');
                        saveAll(function(){
                            $.get(wgServer + wgScriptPath + '/index.php/Special:Report?report=ChairSabbaticalApplication&generatePDF&userId=' + userId, function(response){
                                $('.downloadButton' + userId).attr('href', wgServer + wgScriptPath + '/index.php/Special:ReportArchive?getpdf=' + response.ChairSabbaticalApplication.tok);
                                $('.downloadButton' + userId).show();
                                $(this).prop('disabled', false);
                            }.bind(this));
                        }.bind(this));
                    });
                </script>
            ]]>
        </Static>
    </ReportSection>
</Report>
