<?xml version="1.0" encoding="UTF-8" ?>
<Report extends="../FECTable" disabled="false">
    <Permissions>
        <Role role="FEC Engineering" start="{$this_year}-07-01" end="{$next_year}-07-01">
            <SectionPermission id="fec" permissions="rw" />
            <SectionPermission id="fec_votes" permissions="" />
            <SectionPermission id="fec_numbers" permissions="" />
        </Role>
    </Permissions>
    <ReportSection id="fec">
        <ReportItem id="header">
            <![CDATA[
                <table id='chairTable' class='wikitable' frame='box' rules='all'>
                    <thead>
                        <tr>
                            <th width="1%">Case#</th>
                            <th width="1%">Cohort#</th>
                            <th width="1%">Review#</th>
                            <th>Name</th>
                            <th>Rank</th>
                            <th>Department</th>
                            <th width="1%">Annual Report</th>
                            <!--th>Evaluation</th-->
                            <th>Recommended Increment</th>
                            <th>Revised Increment</th>
                            <th>Increment Vote <span class='tooltip' title='Votes will be visible to the FEC Chair'>&#9432;</span></th>
                            <!--th>Tenure Vote <span class='tooltip' title='Votes will be visible to the FEC Chair'>&#9432;</span></th>
                            <th>Promotion Vote <span class='tooltip' title='Votes will be visible to the FEC Chair'>&#9432;</span></th-->
                            <th>Comments <span class='tooltip' title='Comments will be visible to the FEC Chair'>&#9432;</span></th>
                        </tr>
                    </thead>
                    <tbody>
            ]]>
        </ReportItem>
        <ReportItemSet id="faculty" start="{$last_year}-07-01" end="{$this_year}-07-01" excludeMe="true">
            <Static>
                <![CDATA[
                    <tr data-id="{$user_id}">
                        <td class="casenumber" style='white-space:nowrap;'>{getExtra()}</td>
                        <td class="cohortnumber" style='white-space:nowrap;'>{user_case_number(2)}</td>
                        <td class="reviewnumber" style='white-space:nowrap;'>{user_case_number(3)}</td>
                        <td><a href="{$user_url}" target="_blank">{$user_name}</a></td>
                        <td style='white-space:nowrap;'>{$user_title}</td>
                        <td>{$user_depts}</td>
                ]]>
            </Static>
            <!-- Annual Report -->
            <ReportItem id="download" type="PDFReportItem" reportType="FECpdf" class="downloadPDF" buttonName=" AR ">
                <![CDATA[
                        <td align='center' style="white-space:nowrap;">{$item}<br />
                ]]>
            </ReportItem>
            <ReportItem id="spots" type="PDFReportItem" reportType="SPOTs" class="downloadPDF" buttonName=" SPOTs ">
                <![CDATA[
                        {$item}<br />
                ]]>
            </ReportItem>
            <!-- Rebuttal -->
            <If if="{!=(1,0)}"> <!-- edit this line if there the rebuttal should be hidden. (ie. {!=({$user_id},23673)} ) -->
                <Static>
                    {set(fileRebuttal, {getBlobMD5(RP_FEC,REBUTTAL,REBUTTAL,0,{$user_id},0)})}
                </Static>
                <If if="{!=({get(fileRebuttal)},)}">
                    <![CDATA[
                       <a class="downloadPDF file_{$user_id}" target="_blank" href="{$wgServer}{$wgScriptPath}/index.php?action=downloadBlob&id={get(fileRebuttal)}&mime=application/pdf&stream">Rebuttal</a><br />
                    ]]>
                </If>
            </If>
            <!-- Variance -->
            <Static>
                {set(fileVariance, {getBlobMD5(RP_FEC,VARIANCE,VARIANCE,0,{$user_id},0)})}
            </Static>
            <If if="{!=({get(fileVariance)},)}">
                <![CDATA[
                   <a class="downloadPDF file_{$user_id}" target="_blank" href="{$wgServer}{$wgScriptPath}/index.php?action=downloadBlob&id={get(fileVariance)}&mime=application/pdf&stream">Variance</a><br />
                ]]>
            </If>
            <!-- Files -->
            <!--For from="1" to="3">
                <Static>
                    {set(fileCR, {getBlobMD5(RP_CHAIR,FEC_REVIEW,FILE{$index},{$user_id},0,0)})}
                </Static>
                <If if="{!=({get(fileCR)},)}">
                    <![CDATA[
                       <a class="downloadPDF file_{$user_id}" href="{$wgServer}{$wgScriptPath}/index.php?action=downloadBlob&id={get(fileCR)}">File</a><br />
                    ]]>
                </If>
            </For-->
            <Static>
                <![CDATA[
                    </td>
                    <!--td align='center' style="white-space:nowrap;"-->
                ]]>
            </Static>
            <!--ReportItem id="recommendation" type="PDFReportItem" reportType="ChairTable" section="Recommendations" noRenderIfNull="true" class="downloadPDF" buttonName="Recommendation">
                <![CDATA[
                            {$item}<br />
                ]]>
            </ReportItem>
            <If if="{or({contains({$my_roles},ADMIN)},
                        {contains({$my_roles},FEC_CHAIR)},
                        {contains({$my_roles},HR)}">
                <ReportItem id="da" type="PDFReportItem" reportType="ChairTable" section="Dean Advice" noRenderIfNull="true" class="downloadPDF" buttonName="Dean's Advice">
                    <![CDATA[
                            {$item}<br />
                    ]]>
                </ReportItem>
                <ReportItem id="dd" type="PDFReportItem" reportType="ChairTable" section="Dean Decision" noRenderIfNull="true" class="downloadPDF" buttonName="Dean's Decision">
                    <![CDATA[
                            {$item}<br />
                    ]]>
                </ReportItem>
            </If>
            <Static>
                <![CDATA[
                    </td>
                ]]>
            </Static-->
            <If if="{or({contains({user_sub_roles(;)},Dean's Decision)})}">
                <![CDATA[
                    <td>
                        <span class="increment dd">{getText(RP_CHAIR, FEC_DEAN_DECISION, INCREMENT, {$user_id}, 0, 0)}</span> [DD]<br />
                        <div id="comment_{$user_id}" class='comments_to_fec' style='display:none;' title="Comments to FEC for {$user_name}">{getText(RP_CHAIR, FEC_DEAN_DECISION, COMMENTS, {$user_id}, 0, 0)}</div>
                        <a class='click_comments_to_fec' data-id="comment_{$user_id}" style="cursor:pointer;">Comments to FEC</a>
                    </td>
                ]]>
            </If>
            <Else>
                <![CDATA[
                    <td>
                        <span class="increment">{getText(RP_CHAIR, FEC_REVIEW, INCREMENT, {$user_id}, 0, 0)}</span><br />
                        <div id="comment_{$user_id}" class='comments_to_fec' style='display:none;' title="Comments to FEC for {$user_name}">{getText(RP_CHAIR, FEC_REVIEW, COMMENTS, {$user_id}, 0, 0)}</div>
                        <a class='click_comments_to_fec' data-id="comment_{$user_id}" style="cursor:pointer;">Comments to FEC</a>
                    </td>
                ]]>
            </Else>
            <Static>
                <![CDATA[
                    <td>
                        <span class="revised_increment">{getText(RP_FEC_TABLE, TABLE, INCREMENT, {$user_id}, 1, 0)}</span>
                    </td>
                ]]>
            </Static>
            <If if="{or({contains({$my_roles},FEC_CHAIR)},{contains({$my_roles},FEC)})}">
                <!-- Increment Vote -->
                <ReportItem id="vote" type="Select" blobType="BLOB_TEXT" blobItem="VOTE" blobSubItem="{$user_id}" options="|Yes|No|Abstain" width="80px" encrypt="true">
                    <![CDATA[
                        <td class="vote" align="center">
                            <div class='text' style='display:none;'>
                                
                            </div>
                            <div class='field' style='display:none;'>
                                <span id='vote_{$user_id}'>{$item}</span>
                            </div>
                        </td>
                    ]]>
                </ReportItem>
                <!-- Tenure Vote -->
                <!--ReportItem id="t_vote" type="Select" blobType="BLOB_TEXT" blobItem="T_VOTE" blobSubItem="{$user_id}" options="|Yes|No|Abstain" width="80px" encrypt="true">
                    <![CDATA[
                        <td class="t_vote" align="center">
                            <div class='text' style='display:none;'>
                                
                            </div>
                            <div class='field' style='display:none;'>
                                <span id='t_vote_{$user_id}'>{$item}</span>
                            </div>
                        </td>
                    ]]>
                </ReportItem-->
                <!-- Promotion Vote -->
                <!--ReportItem id="p_vote" type="Select" blobType="BLOB_TEXT" blobItem="P_VOTE" blobSubItem="{$user_id}" options="|Yes|No|Abstain" width="80px" encrypt="true">
                    <![CDATA[
                        <td class="p_vote" align="center">
                            <div class='text' style='display:none;'>
                                
                            </div>
                            <div class='field' style='display:none;'>
                                <span id='p_vote_{$user_id}'>{$item}</span>
                            </div>
                        </td>
                    ]]>
                </ReportItem-->
                
                <!-- Comments -->
                <If if="{or({contains({$my_roles},FEC_CHAIR)})}">
                    <Static>
                        <![CDATA[
                            <td>
                        ]]>
                    </Static>
                    <ReportItemSet id="fec_comments" type="FECReportItemSet">
                        <Static>
                            <![CDATA[
                                {set(discuss, {getText(RP_FEC_TABLE, TABLE, COMMENTS_DISCUSS, {$parent_id}, {$user_id}, 0)})}
                                {set(comment, {getText(RP_FEC_TABLE, TABLE, COMMENTS, {$parent_id}, {$user_id}, 0)})}
                            ]]>
                        </Static>
                        <If id="comment_if" if="{!=({get(discuss)},)}">
                            <![CDATA[
                                <b>{$user_name}:</b> &#x2714; {get(comment)}
                                <hr />
                            ]]>
                        </If>
                    </ReportItemSet>
                    <Static>
                        <![CDATA[
                            </td>
                        ]]>
                    </Static>
                </If>
                <Else>
                    <ReportItem id="comments_discuss" type="SingleCheckbox" blobType="BLOB_TEXT" blobItem="COMMENTS_DISCUSS" blobSubItem="{$user_id}" options="Discuss" height="75px" encrypt="true">
                        <![CDATA[
                            <td align="center">
                                <div id='comments_discuss_{$user_id}'>{$item}</div>
                        ]]>
                    </ReportItem>
                    <ReportItem id="comments" type="Textarea" blobType="BLOB_TEXT" blobItem="COMMENTS" blobSubItem="{$user_id}" height="75px" width="170px" encrypt="true">
                        <![CDATA[
                                <div id='comments_{$user_id}'>{$item}</div>
                                <script type='text/javascript'>
                                    $('#comments_discuss_{$user_id} input').change(function(){
                                        if($('#comments_discuss_{$user_id} input').is(":checked")){
                                            $('#comments_{$user_id}').show();
                                        }
                                        else{
                                            $('#comments_{$user_id}').hide();
                                        }
                                    }).change();
                                </script>
                            </td>
                        ]]>
                    </ReportItem>
                </Else>
            </If>
            <Else>
                <![CDATA[
                    <td></td>
                    <td></td>
                ]]>
            </Else>
            <Static>
                <![CDATA[
                    </tr>
                ]]>
            </Static>
        </ReportItemSet>
        <ReportItem id="footer">
            <![CDATA[
                    </tbody>
                </table>
                <script type='text/javascript'>
                    $(".click_comments_to_fec").click(function(){
                        var id = $(this).attr("data-id");
                        $("#" + id).dialog({
                            width: "600px"
                        });
                    });
                </script>
            ]]>
        </ReportItem>
    </ReportSection>
    <ReportSection id="fec_votes">
        <ReportItem id="header">
            <![CDATA[
                <table id='chairTable' class='wikitable' frame='box' rules='all'>
                    <thead>
                        <tr>
                            <th rowspan='2' width="1%">Case#</th>
                            <th rowspan='2' width="1%">Cohort#</th>
                            <th rowspan='2' width="1%">Review#</th>
                            <th rowspan='2'>Name</th>
                            <th rowspan='2'>Rank</th>
                            <th rowspan='2'>Department</th>
                            <th rowspan='2'>Recommended Increment</th>
                            <th rowspan='2'>Revised Increment</th>
                            <th colspan='4'>Increment Votes</th>
                            <th colspan='4'>Tenure Votes</th>
                            <th colspan='4'>Promotion Votes</th>
                            <th rowspan='2'>HR Comments</th>
                        </tr>
                        <tr>
                            <th>Y</th>
                            <th>N</th>
                            <th>A</th>
                            <th>Freeze</th>
                            <th>Y</th>
                            <th>N</th>
                            <th>A</th>
                            <th>Freeze</th>
                            <th>Y</th>
                            <th>N</th>
                            <th>A</th>
                            <th>Freeze</th>
                        </tr>
                    </thead>
                    <tbody>
            ]]>
        </ReportItem>
        <ReportItemSet id="faculty">
            <Static>
                <![CDATA[
                    <tr>
                        <td style='white-space:nowrap;'>{getExtra()}</td>
                        <td style='white-space:nowrap;'>{user_case_number(2)}</td>
                        <td style='white-space:nowrap;'>{user_case_number(3)}</td>
                        <td><a href="{$user_url}" target="_blank">{$user_name}</a></td>
                        <td>{$user_level}</td>
                        <td>{$user_dept}</td>
                ]]>
            </Static>
            <If if="{contains({$my_roles},HR)}">
                <![CDATA[
                    <td>{getText(RP_CHAIR, FEC_REVIEW, INCREMENT, {$user_id}, 0, 0)}</td>
                    <td>
                        {getText(RP_FEC_TABLE, TABLE, INCREMENT, {$user_id}, 1, 0)}
                    </td>
                ]]>
            </If>
            <Else>
                <ReportItem id="increment" type="Increment" blobItem="INCREMENT" blobSubItem="{$user_id}" personId="1" width="80px" history="false" encrypt="true">
                    <![CDATA[
                        <td>{getText(RP_CHAIR, FEC_REVIEW, INCREMENT, {$user_id}, 0, 0)}</td>
                        <td class='revised_increment_{$user_id}'>
                            {$item}
                        </td>
                    ]]>
                </ReportItem>
            </Else>
            
            <!-- Increment Votes -->
            <ReportItem id="freeze" type="VoteResultsReportItem" voteType="increment" freezeId="vote_{$user_id}" blobItem="FREEZE" blobSubItem="{$user_id}" voteBlobItem="VOTE" personId="1" width="75px">
                <![CDATA[
                        {$item}
                ]]>
            </ReportItem>
            
            <!-- Tenure Votes -->
            <ReportItem id="t_freeze" type="VoteResultsReportItem" voteType="tenure" freezeId="t_vote_{$user_id}" blobItem="T_FREEZE" blobSubItem="{$user_id}" voteBlobItem="T_VOTE" personId="1" width="75px">
                <![CDATA[
                        {$item}
                ]]>
            </ReportItem>
            
            <!-- Promotion Votes -->
            <ReportItem id="p_freeze" type="VoteResultsReportItem" voteType="promotion" freezeId="p_vote_{$user_id}" blobItem="P_FREEZE" blobSubItem="{$user_id}" voteBlobItem="P_VOTE" personId="1" width="75px">
                <![CDATA[
                        {$item}
                ]]>
            </ReportItem>
            <If if="{contains({$my_roles},HR)}">
                <ReportItem id="comments" type="Textarea" blobType="BLOB_TEXT" blobItem="COMMENTS" blobSubItem="{$user_id}" personId="1" height="75px" encrypt="true">
                    <![CDATA[
                        <td>
                            {$item}
                        </td>
                    ]]>
                </ReportItem>
            </If>
            <Else>
                <![CDATA[
                    <td>
                        {getText(RP_FEC_TABLE, TABLE, COMMENTS, {$user_id}, 1, 0)}
                    </td>
                ]]>
            </Else>
            
            <Static>
                <![CDATA[
                    </tr>
                ]]>
            </Static>
        </ReportItemSet>
    </ReportSection>
</Report>
