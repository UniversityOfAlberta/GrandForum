<?xml version="1.0" encoding="UTF-8" ?>
<Report name="FEC Table" title="FEC Table" reportType="RP_FEC_TABLE" ajax="true" disabled="true">
    <Permissions>
        <Role role="FEC" start="{$this_year}-07-01" end="{$next_year}-07-01">
            <SectionPermission id="fec" permissions="rw" />
            <SectionPermission id="fec_votes" permissions="" />
            <SectionPermission id="summary" permissions="rw" />
        </Role>
        <Role role="FEC_CHAIR" start="{$this_year}-07-01" end="{$next_year}-07-01">
            <SectionPermission id="fec" permissions="rw" />
            <SectionPermission id="fec_votes" permissions="rw" />
            <SectionPermission id="summary" permissions="rw" />
        </Role>
        <Role role="HR" start="{$this_year}-07-01" end="{$next_year}-07-01">
            <SectionPermission id="fec" permissions="rw" />
            <SectionPermission id="fec_votes" permissions="rw" />
            <SectionPermission id="summary" permissions="rw" />
        </Role>
        <Role role="MANAGER+" start="{$this_year}-07-01" end="{$next_year}-07-01">
            <SectionPermission id="fec" permissions="rw" />
            <SectionPermission id="fec_votes" permissions="rw" />
            <SectionPermission id="summary" permissions="rw" />
        </Role>
    </Permissions>
    <Script>
        <![CDATA[
            <script type='text/javascript'>
                var lastData = null;
                var freezeUpdate = function(){
                    if(!$("#FECTable").hasClass("selectedReportTab")){
                        return;
                    }
                    $.get(wgServer + wgScriptPath + '/index.php?action=api.voteFreeze', function(response){
                        var data = response.data;
                        
                        var sumFaculty = 0;
                        var sumFSO = 0;
                        
                        var nFaculty = 0;
                        var nFSO = 0;
                        
                        var nRevFaculty = 0;
                        var nRevFSO = 0;
                        
                        var sumRevFaculty = 0;
                        var sumRevFSO = 0;
                        
                        var sumDDFaculty = 0;
                        var sumDDFSO = 0;
                        
                        var nDDFaculty = 0;
                        var nDDFSO = 0;
                        
                        var targetFac = $('#targetFac input').val();
                        var targetFSO = $('#targetFso input').val();
                        
                        var needsSaving = false;
                        
                        if(lastData == null){
                            lastData = data;
                        }
                        
                        table.rows().every(function(i){
                            var el = $(this.nodes());
                            var index = el.attr("data-id");
                            var caseN = $(".casenumber", el).text();
                            $(".revised_increment", el).empty();
                            if(data['increment'][index] != undefined){
                                $(".revised_increment", el).text(data['increment'][index]);
                            }
                            
                            if(data['freeze'].indexOf(index) == -1 &&
                               lastData['freeze'].indexOf(index) != -1){
                                $(".vote .field select option[value='']", el).prop("selected", true);
                                needsSaving = true;
                            }
                            
                            if(data['t_freeze'].indexOf(index) == -1 &&
                               lastData['t_freeze'].indexOf(index) != -1){
                                $(".t_vote .field select option[value='']", el).prop("selected", true);
                                needsSaving = true;
                            }
                            
                            if(data['p_freeze'].indexOf(index) == -1 &&
                               lastData['p_freeze'].indexOf(index) != -1){
                                $(".p_vote .field select option[value='']", el).prop("selected", true);
                                needsSaving = true;
                            }
                            
                            if(data['freeze'].indexOf(index) != -1){
                                // Frozen
                                $(".vote .text", el).text($(".vote .field select option:selected", el).val());
                                $(".vote .text", el).show();
                                $(".vote .field", el).hide();
                            }
                            else{
                                // Unfrozen
                                $(".vote .text", el).hide();
                                $(".vote .field", el).show();
                            }
                            
                            if(data['t_freeze'].indexOf(index) != -1){
                                // Frozen
                                $(".t_vote .text", el).text($(".t_vote .field select option:selected", el).val());
                                $(".t_vote .text", el).show();
                                $(".t_vote .field", el).hide();
                            }
                            else{
                                // Unfrozen
                                $(".t_vote .text", el).hide();
                                $(".t_vote .field", el).show();
                            }
                            
                            if(data['p_freeze'].indexOf(index) != -1){
                                // Frozen
                                $(".p_vote .text", el).text($(".p_vote .field select option:selected", el).val());
                                $(".p_vote .text", el).show();
                                $(".p_vote .field", el).hide();
                            }
                            else{
                                // Unfrozen
                                $(".p_vote .text", el).hide();
                                $(".p_vote .field", el).show();
                            }
                            
                            var increment = $(".increment:not(.dd):not('.nopool')", el).text();
                            var revisedIncrement = $(".revised_increment:not('.nopool')", el).text();
                            var ddIncrement = $(".increment.dd:not('.nopool')", el).text();
                            
                            if(increment != "" &&
                               increment != "N/A" &&
                               increment != "0.00" &&
                               increment != "0.00 (PTC)" &&
                               increment != "0A"){
                                if(caseN.indexOf('A') != -1 ||
                                   caseN.indexOf('B') != -1 ||
                                   caseN.indexOf('C') != -1 ||
                                   caseN.indexOf('N') != -1){
                                    sumFaculty += parseFloat(increment);
                                    if(revisedIncrement == ""){
                                        revisedIncrement = increment;
                                    }
                                    nFaculty++;
                                } else 
                                if(caseN.indexOf('D') != -1 ||
                                   caseN.indexOf('E') != -1 ||
                                   caseN.indexOf('F') != -1 ||
                                   caseN.indexOf('M') != -1){
                                    sumFSO += parseFloat(increment);
                                    if(revisedIncrement == ""){
                                        revisedIncrement = increment;
                                    }
                                    nFSO++;
                                }
                            }
                            
                            if(revisedIncrement != "" &&
                               revisedIncrement != "N/A" &&
                               revisedIncrement != "0.00" &&
                               revisedIncrement != "0.00 (PTC)" &&
                               revisedIncrement != "0A"){
                                if(caseN.indexOf('A') != -1 ||
                                   caseN.indexOf('B') != -1 ||
                                   caseN.indexOf('C') != -1 ||
                                   caseN.indexOf('N') != -1){
                                    sumRevFaculty += parseFloat(revisedIncrement);
                                    nRevFaculty++;
                                } else 
                                if(caseN.indexOf('D') != -1 ||
                                   caseN.indexOf('E') != -1 ||
                                   caseN.indexOf('F') != -1 ||
                                   caseN.indexOf('M') != -1){
                                    sumRevFSO += parseFloat(revisedIncrement);
                                    nRevFSO++;
                                }
                            }
                            
                            if(ddIncrement != "" &&
                               ddIncrement != "N/A" &&
                               ddIncrement != "0.00" &&
                               ddIncrement != "0.00 (PTC)" &&
                               ddIncrement != "0A"){
                                if(caseN.indexOf('A') != -1 ||
                                   caseN.indexOf('B') != -1 ||
                                   caseN.indexOf('C') != -1 ||
                                   caseN.indexOf('N') != -1){
                                    sumDDFaculty += parseFloat(ddIncrement);
                                    nDDFaculty++;
                                } else 
                                if(caseN.indexOf('D') != -1 ||
                                   caseN.indexOf('E') != -1 ||
                                   caseN.indexOf('F') != -1 ||
                                   caseN.indexOf('M') != -1){
                                    sumDDFSO += parseFloat(ddIncrement);
                                    nDDFSO++;
                                }
                            }
                        });
                        
                        table.rows().invalidate();
                        if(needsSaving){
                            saveAll();
                        }
                        
                        var facSign = (targetFac - sumRevFaculty - sumDDFaculty > 0) ? "-" : "+";
                        var fsoSign = (targetFSO - sumRevFSO - sumDDFSO > 0) ? "-" : "+";
                        
                        $("#averageFac").text(number_format(sumFaculty/Math.max(1,nFaculty)));
                        $("#averageFSO").text(number_format(sumFSO/Math.max(1,nFSO)));
                        $("#totalFac").text(number_format(sumFaculty));
                        $("#totalFSO").text(number_format(sumFSO));
                        
                        $("#runningAverageFac").text(number_format(sumRevFaculty/Math.max(1,nRevFaculty)));
                        $("#runningAverageFSO").text(number_format(sumRevFSO/Math.max(1,nRevFSO)));
                        $("#runningTotalFac").text(number_format(sumRevFaculty));
                        $("#runningTotalFSO").text(number_format(sumRevFSO));
                        
                        $("#ddAverageFac").text(number_format(sumDDFaculty/Math.max(1,nDDFaculty)));
                        $("#ddAverageFSO").text(number_format(sumDDFSO/Math.max(1,nDDFSO)));
                        $("#ddTotalFac").text(number_format(sumDDFaculty));
                        $("#ddTotalFSO").text(number_format(sumDDFSO));
                        
                        $("#deltaFac").text(facSign + number_format(Math.abs(targetFac - sumRevFaculty - sumDDFaculty)));
                        $("#deltaFSO").text(fsoSign + number_format(Math.abs(targetFSO - sumRevFSO - sumDDFSO)));
                        
                        if(facSign == "+"){
                            $("#deltaFac").css("background", "red");
                            $("#deltaFac").css("color", "white");
                        }
                        else{
                            $("#deltaFac").css("background", "white");
                            $("#deltaFac").css("color", "black");
                        }
                        
                        if(fsoSign == "+"){
                            $("#deltaFSO").css("background", "red");
                            $("#deltaFSO").css("color", "white");
                        }
                        else{
                            $("#deltaFSO").css("background", "white");
                            $("#deltaFSO").css("color", "black");
                        }
                        
                        lastData = response.data;
                    });
                }
                $(document).ready(freezeUpdate);
                setInterval(freezeUpdate, 3000);
            </script>
        ]]>
    </Script>
    <ReportSection id="fec" tooltip="FEC Table" name="FEC Table" title="FEC Table" blobSection="TABLE" type="EditableReportSection">
        <Static>
            <![CDATA[
                <style>
                    table#chairTable * {
                        font-size:11px !important;
                    }
                    
                    table.fixedHeader-floating * {
                        font-size:11px !important;
                    }
                </style>
                <iframe id='downloadFrame' name='downloadFrame' src="" style="display:none;"></iframe>
                
                <script type='text/javascript'>
                    function postToIframe(data,url,target){
                        $('body').append('<form action="'+url+'" method="post" target="'+target+'" id="postToIframe"></form>');
                        $.each(data,function(n,v){
                            $('#postToIframe').append('<input type="hidden" name="'+n+'" value="'+v+'" />');
                        });
                        $('#postToIframe').submit().remove();
                    }
                    $(document).ready(function(){
                        $('#downloadAll').click(function(){
                            var pdfs = $.makeArray($(".downloadPDF:visible").map(function(i, pdf){
                                return $(pdf).attr('href');
                            })).join(',')
                               .replaceAll(wgServer + wgScriptPath + '/index.php/Special:ReportArchive?getpdf=', '')
                               .replaceAll(wgServer + wgScriptPath + '/index.php?action=downloadBlob&id=', '');
                            postToIframe({pdfs: pdfs}, wgServer + wgScriptPath + '/index.php?action=downloadReportZip', 'downloadFrame');
                        });
                    });
                </script>
            ]]>
        </Static>
        <Static id="header">
            <![CDATA[
                <div style='text-align: right; width: 50%; float: right; width: 50%;'>
                    <button id='downloadAll' class='noDisable' type='button'>Download All</button><br />
                    <small style='width:525px; line-height: 1.5em;'>This function is provided for the convenience of the Faculty Evaluation Committee, while reviewing the materials. Please make sure to destroy any information stored locally immediately after the FEC week.</small>
                </div>
                <table id='chairTable' class='wikitable' frame='box' rules='all'>
                    <thead>
                        <tr>
                            <th width="1%">Case#</th>
                            <th>Name</th>
                            <th>Rank</th>
                            <th>Department</th>
                            <th width="1%">Annual Report</th>
                            <th>Evaluation</th>
                            <th>Recommended Increment</th>
                            <th>Revised Increment</th>
                            <th>Increment Vote <span class='tooltip' title='Votes will be visible to the FEC Chair'>&#9432;</span></th>
                            <th>Tenure Vote <span class='tooltip' title='Votes will be visible to the FEC Chair'>&#9432;</span></th>
                            <th>Promotion Vote <span class='tooltip' title='Votes will be visible to the FEC Chair'>&#9432;</span></th>
                            <th>Comments <span class='tooltip' title='Comments will be visible to the FEC Chair'>&#9432;</span></th>
                        </tr>
                    </thead>
                    <tbody>
            ]]>
        </Static>
        <ReportItemSet id="faculty" type="FacultyPeopleReportItemSet" start="{$last_year}-07-01" end="{$this_year}-07-01" excludeMe="true">
            <Static>
                <![CDATA[
                    {set(noPool,)}
                ]]>
            </Static>
            <If if="{contains({user_sub_roles(;)},No Pool)}">
                <![CDATA[
                    {set(noPool, nopool)}
                ]]>
            </If>
            
            <Static>
                <![CDATA[
                    <tr data-id="{$user_id}">
                        <td class="casenumber" style='white-space:nowrap;'>{getExtra()}</td>
                        <td><a href="{$user_url}" target="_blank">{$user_name}</a></td>
                        <td>{$user_level}</td>
                        <td>{$user_depts}</td>
                ]]>
            </Static>
            <ReportItem id="download" type="PDFReportItem" reportType="FECpdf" class="downloadPDF" buttonName=" AR ">
                <![CDATA[
                        <td align='center' style="white-space:nowrap;">{$item}<br />
                ]]>
            </ReportItem>
            <If if="{!=({getBlobMD5(RP_CHAIR,FEC_REVIEW,FILE1,{$user_id},0,0)},)}">
                <For from="1" to="3">
                    <If if="{!=({getBlobMD5(RP_CHAIR,FEC_REVIEW,FILE{$index},{$user_id},0,0)},)}">
                        <![CDATA[
                           <a class="downloadPDF file_{$user_id}" href="{$wgServer}{$wgScriptPath}/index.php?action=downloadBlob&id={getBlobMD5(RP_CHAIR,FEC_REVIEW,FILE{$index},{$user_id},0,0)}">File</a><br />
                        ]]>
                    </If>
                </For>
            </If>
            <Static>
                <![CDATA[
                    </td>
                    <td align='center' style="white-space:nowrap;">
                ]]>
            </Static>
            <ReportItem id="recommendation" type="PDFReportItem" reportType="ChairTable" section="Recommendations" noRenderIfNull="true" class="downloadPDF" buttonName="Recommendation">
                <![CDATA[
                            {$item}<br />
                ]]>
            </ReportItem>
            <If if="{or({contains({$my_roles},ADMIN)},
                        {contains({$my_roles},FEC_CHAIR)},
                        {contains({$my_roles},HR)})}">
                <If if="{or({contains({user_sub_roles(;)},Dean's Advice)})}">
                    <ReportItem id="da" type="PDFReportItem" reportType="ChairTable" section="Dean Advice" noRenderIfNull="true" class="downloadPDF" buttonName="Dean's Advice">
                        <![CDATA[
                                {$item}<br />
                        ]]>
                    </ReportItem>
                </If>
                <If if="{or({contains({user_sub_roles(;)},Dean's Decision)})}">
                    <ReportItem id="dd" type="PDFReportItem" reportType="ChairTable" section="Dean Decision" noRenderIfNull="true" class="downloadPDF" buttonName="Dean's Decision">
                        <![CDATA[
                                {$item}<br />
                        ]]>
                    </ReportItem>
                </If>
            </If>
            <Static>
                <![CDATA[
                    </td>
                ]]>
            </Static>
            
            <!-- Increment -->
            <If if="{or({contains({user_sub_roles(;)},Dean's Decision)})}">
                <![CDATA[
                    <td>
                        <span class="increment dd {get(noPool)}">{getText(RP_CHAIR, FEC_DEAN_DECISION, INCREMENT, {$user_id}, 0, 0)}</span>
                    </td>
                ]]>
            </If>
            <Else>
                <![CDATA[
                    <td>
                        <span class="increment {get(noPool)}">{getText(RP_CHAIR, FEC_REVIEW, INCREMENT, {$user_id}, 0, 0)}</span>
                    </td>
                ]]>
            </Else>
            <!-- Revised Increment -->
            <Static>
                <![CDATA[
                    <td>
                        <span class="revised_increment {get(noPool)}">{getText(RP_FEC_TABLE, TABLE, INCREMENT, {$user_id}, 1, 0)}</span>
                    </td>
                ]]>
            </Static>
            
            <!-- Votes -->
            <If if="{or({contains({$my_roles},FEC_CHAIR)},{contains({$my_roles},FEC)})}">
                <!-- Increment Vote -->
                <ReportItem id="vote" type="Select" blobType="BLOB_TEXT" blobItem="VOTE" blobSubItem="{$user_id}" options="|Yes|No|Abstain" width="80px" encrypt="true">
                    <![CDATA[
                        <td class="vote">
                            <div class='text' style='display:none;'>
                                
                            </div>
                            <div class='field' style='display:none;'>
                                <span id='vote_{$user_id}'>{$item}</span>
                            </div>
                        </td>
                    ]]>
                </ReportItem>
                <!-- Tenure Vote -->
                <ReportItem id="t_vote" type="Select" blobType="BLOB_TEXT" blobItem="T_VOTE" blobSubItem="{$user_id}" options="|Yes|No|Abstain" width="80px" encrypt="true">
                    <![CDATA[
                        <td class="t_vote">
                            <div class='text' style='display:none;'>
                                
                            </div>
                            <div class='field' style='display:none;'>
                                <span id='t_vote_{$user_id}'>{$item}</span>
                            </div>
                        </td>
                    ]]>
                </ReportItem>
                <!-- Promotion Vote -->
                <ReportItem id="p_vote" type="Select" blobType="BLOB_TEXT" blobItem="P_VOTE" blobSubItem="{$user_id}" options="|Yes|No|Abstain" width="80px" encrypt="true">
                    <![CDATA[
                        <td class="p_vote">
                            <div class='text' style='display:none;'>
                                
                            </div>
                            <div class='field' style='display:none;'>
                                <span id='p_vote_{$user_id}'>{$item}</span>
                            </div>
                        </td>
                    ]]>
                </ReportItem>
            </If>
            <Else>
                <![CDATA[
                    <td></td>
                    <td></td>
                    <td></td>
                ]]>
            </Else>
            
            <!-- Comments -->
            <Static>
                <![CDATA[
                    <td>
                ]]>
            </Static>
            <If if="{or({contains({$my_roles},HR)},{contains({$my_roles},FEC)})}">
                <ReportItem id="comments" type="Textarea" blobType="BLOB_TEXT" blobItem="COMMENTS" blobSubItem="{$user_id}" height="75px" encrypt="true">
                    <![CDATA[
                        {$item}
                    ]]>
                </ReportItem>
            </If>
            <If if="{or({contains({$my_roles},HR)},{contains({$my_roles},FEC_CHAIR)})}">
                <ReportItemSet id="fec_comments" type="FECReportItemSet" includeHR="true" excludeMe="true">
                    <Static>
                        <![CDATA[
                            {set(comment, {getText(RP_FEC_TABLE, TABLE, COMMENTS, {$parent_id}, {$user_id}, 0)})}
                        ]]>
                    </Static>
                    <If id="comment_if" if="{!=({get(comment)},)}">
                        <![CDATA[
                            <b>{$user_name}:</b> {get(comment)}
                            <hr />
                        ]]>
                    </If>
                </ReportItemSet>
            </If>
            <Static>
                <![CDATA[
                    </td>
                ]]>
            </Static>
            <Static>
                <![CDATA[
                    </tr>
                    <script type='text/javascript'>
                        var tenure = "{getText(RP_CHAIR, FEC_REVIEW, TENURE, {$user_id}, 0, 0)}";
                        if(tenure != "i recommend that an appointment with tenure be offered" &&
                           tenure != "i recommend tenure as per clause 12.17 (special recommendation for tenure)" &&
                           tenure != "i recommend that continuing appointment be offered"){
                            $("#t_vote_{$user_id}").remove();
                        }
                        else if(tenure != ""){
                            $(".file_{$user_id}").text("Tenure File");
                        }
                        
                        var promotion = "{getText(RP_CHAIR, FEC_REVIEW, PROMOTION, {$user_id}, 0, 0)}";
                        if(promotion.indexOf("i recommend promotion") == -1){
                            $("#p_vote_{$user_id}").remove();
                            
                        }
                        else if(promotion != ""){
                            $(".file_{$user_id}").text("Promotion File");
                        }
                    </script>
                ]]>
            </Static>
        </ReportItemSet>
        <Static id="footer">
            <![CDATA[
                    </tbody>
                </table>
            ]]>
        </Static>
        <If if="{or({contains({$my_roles},ADMIN)},
                    {contains({$my_roles},FEC_CHAIR)},
                    {contains({$my_roles},HR)})}">
            <Static>
                <![CDATA[
                    <style>
                        #summary {
                            border: 2px solid #aaaaaa;
                        }
                    
                        .target {
                            padding: 0 !important;
                            border: 2px solid #007d43 !important;
                        }
                        
                        .target input {
                            font-size: 9pt;
                            margin: 0;
                            border: none;
                            border-radius: 0;
                        }
                        
                        .target input:focus {
                            border: none !important;
                        }
                    </style>
                    <table id='summary' class='wikitable' frame='box' rules='all'>
                        <tr>
                            <th></th>
                            <th style='width:6em;'>Faculty</th>
                            <th style='width:6em;'>FSO</th>
                        </tr>
                        <tr>
                            <td><b>Dean's Decisions&nbsp;</b></td>
                            <td id='ddTotalFac' align='right'></td>
                            <td id='ddTotalFSO' align='right'></td>
                        </tr>
                        <tr>
                            <td><b>Recommendations to FEC&nbsp;</b></td>
                            <td id='totalFac' align='right'></td>
                            <td id='totalFSO' align='right'></td>
                        </tr>
                        <tr>
                            <td><b>Recommendations by FEC&nbsp;</b></td>
                            <td id='runningTotalFac' align='right'></td>
                            <td id='runningTotalFSO' align='right'></td>
                        </tr>
                        <tr>
                            <td><b>Total Pool&nbsp;</b></td>
                ]]>
            </Static>
            <ReportItem id="targetFac" type="Integer" blobItem="TARGET_FAC" blobSubItem="{$networkName}" decimals="2" personId="0" width="80px" placeholder="0.00">
                <![CDATA[
                    <td id='targetFac' class='target' align='right'>{$item}</td>
                ]]>
            </ReportItem>
            <ReportItem id="targetFso" type="Integer" blobItem="TARGET_FSO" blobSubItem="{$networkName}" decimals="2" personId="0" width="80px" placeholder="0.00">
                <![CDATA[
                    <td id='targetFso' class='target' align='right'>{$item}</td>
                ]]>
            </ReportItem>
            <Static>
                <![CDATA[
                        </tr>
                        <tr>
                            <td><b>Running Targets&nbsp;</b></td>
                            <td id='deltaFac' align='right'></td>
                            <td id='deltaFSO' align='right'></td>
                        </tr>
                    </table>
                ]]>
            </Static>
        </If>
        <Static>
            <![CDATA[
                <script type='text/javascript'>
                    $(window).resize();
                    table = $('#chairTable').DataTable({
                        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                        "iDisplayLength": -1,
                        'fixedHeader': true
                    });
                    $('#chairTable select, #chairTable textarea, #chairTable input').change(function(){
                        saveAll();
                    });
                    $('#summary input').change(function(){
                        saveAll();
                    });
                </script>
            ]]>
        </Static>
    </ReportSection>
    <ReportSection id="fec_votes" tooltip="FEC Votes" name="FEC Votes" title="FEC Votes" blobSection="TABLE" type="EditableReportSection">
        <Static>
            <![CDATA[
                <style>
                    table#chairTable * {
                        font-size:11px !important;
                    }
                    
                    table.fixedHeader-floating * {
                        font-size:11px !important;
                    }
                </style>
                <button id='refresh' class='noDisable' type='button' style='margin-bottom: 1em;'>Refresh</button>
                Dean's Decisions are not included in this table.
            ]]>
        </Static>
        <Static id="header">
            <![CDATA[
                <table id='chairTable' class='wikitable' frame='box' rules='all'>
                    <thead>
                        <tr>
                            <th rowspan='2' width="1%">Case#</th>
                            <th rowspan='2'>Name</th>
                            <th rowspan='2'>Rank</th>
                            <th rowspan='2'>Department</th>
                            <th rowspan='2'>Recommended Increment</th>
                            <th rowspan='2'>Revised Increment</th>
                            <th colspan='4'>Increment Votes</th>
                            <th colspan='4'>Tenure Votes</th>
                            <th colspan='4'>Promotion Votes</th>
                            <th rowspan='2'>HR Comments</th>
                        </tr>
                        <tr>
                            <th>Y</th>
                            <th>N</th>
                            <th>A</th>
                            <th>Freeze</th>
                            <th>Y</th>
                            <th>N</th>
                            <th>A</th>
                            <th>Freeze</th>
                            <th>Y</th>
                            <th>N</th>
                            <th>A</th>
                            <th>Freeze</th>
                        </tr>
                    </thead>
                    <tbody>
            ]]>
        </Static>
        <ReportItemSet id="faculty" type="FacultyPeopleReportItemSet" includeDD="false" start="{$last_year}-07-01" end="{$this_year}-07-01">
            <Static>
                <![CDATA[
                    <tr>
                        <td style='white-space:nowrap;'>{getExtra()}</td>
                        <td><a href="{$user_url}" target="_blank">{$user_name}</a></td>
                        <td>{$user_level}</td>
                        <td>{$user_dept}</td>
                ]]>
            </Static>
            <If if="{contains({$my_roles},HR)}">
                <![CDATA[
                    <td>{getText(RP_CHAIR, FEC_REVIEW, INCREMENT, {$user_id}, 0, 0)}</td>
                    <td>
                        {getText(RP_FEC_TABLE, TABLE, INCREMENT, {$user_id}, 1, 0)}
                    </td>
                ]]>
            </If>
            <Else>
                <ReportItem id="increment" type="Increment" blobItem="INCREMENT" blobSubItem="{$user_id}" personId="1" width="80px" history="false" encrypt="true">
                    <![CDATA[
                        <td>{getText(RP_CHAIR, FEC_REVIEW, INCREMENT, {$user_id}, 0, 0)}</td>
                        <td class='revised_increment_{$user_id}'>
                            {$item}
                        </td>
                    ]]>
                </ReportItem>
            </Else>
            
            <!-- Increment Votes -->
            <ReportItem id="freeze" type="VoteResultsReportItem" voteType="increment" freezeId="vote_{$user_id}" blobItem="FREEZE" blobSubItem="{$user_id}" voteBlobItem="VOTE" personId="1" width="75px">
                <![CDATA[
                        {$item}
                ]]>
            </ReportItem>
            
            <!-- Tenure Votes -->
            <ReportItem id="t_freeze" type="VoteResultsReportItem" voteType="tenure" freezeId="t_vote_{$user_id}" blobItem="T_FREEZE" blobSubItem="{$user_id}" voteBlobItem="T_VOTE" personId="1" width="75px">
                <![CDATA[
                        {$item}
                ]]>
            </ReportItem>
            
            <!-- Promotion Votes -->
            <ReportItem id="p_freeze" type="VoteResultsReportItem" voteType="promotion" freezeId="p_vote_{$user_id}" blobItem="P_FREEZE" blobSubItem="{$user_id}" voteBlobItem="P_VOTE" personId="1" width="75px">
                <![CDATA[
                        {$item}
                ]]>
            </ReportItem>
            <If if="{contains({$my_roles},HR)}">
                <ReportItem id="comments" type="Textarea" blobType="BLOB_TEXT" blobItem="COMMENTS" blobSubItem="{$user_id}" personId="1" height="75px" encrypt="true">
                    <![CDATA[
                        <td>
                            {$item}
                        </td>
                    ]]>
                </ReportItem>
            </If>
            <Else>
                <![CDATA[
                    <td>
                        {getText(RP_FEC_TABLE, TABLE, COMMENTS, {$user_id}, 1, 0)}
                    </td>
                ]]>
            </Else>
            
            <Static>
                <![CDATA[
                    </tr>
                ]]>
            </Static>
        </ReportItemSet>
        <Static>
            <![CDATA[
                    </tbody>
                </table>
                <script type='text/javascript'>
                    $(window).resize();
                    table = $('#chairTable').DataTable({
                        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                        "autoWidth": false,
                        "iDisplayLength": -1
                    });
                    if(typeof order != 'undefined'){
                        table.order(order);
	                    table.search(searchStr);
	                    table.draw();
	                    $(".dataTables_scrollBody").scrollTop(scrollTop);
	                    order = undefined;
	                    search = undefined;
	                    scrollTop = 0;
	                }
                    $('#chairTable select, #chairTable textarea').change(function(){
                        saveAll(function(){
                            $("#refresh").click();
                        });
                        $("#chairTable select, #chairTable input, #chairTable textarea").prop("disabled", true);
                    });
                    $("#refresh").click(function(){
                        order = table.order();
                        searchStr = table.search();
                        scrollTop = $(".dataTables_scrollBody").scrollTop();
                        $("#refresh").prop("disabled", true);
                        $("#chairTable select, #chairTable input, #chairTable textarea").prop("disabled", true);
                        dbWritable = false;
                        $(".selectedReportTab").click();
                        dbWritable = true;
                    });
                </script>
            ]]>
        </Static>
    </ReportSection>
    <ReportSection id="summary" tooltip="Summary Table" name="Summary Table" title="Summary Table" blobSection="SUMMARY" type="EditableReportSection">
        <Static>
            <![CDATA[
                <table id='summary' class='wikitable' frame=box' rules='all'>
                    <thead>
                        <tr>
                            <th colspan='4'>Person</th>
                            <th colspan='4'>Variance</th>
                            <th colspan='3'>Summary of Teaching</th>
                            <th colspan='3'>Thesis Based - MSc</th>
                            <th colspan='3'>Thesis Based - PhD</th>
                            <th colspan='1'>Post Doc</th>
                            <th colspan='7'>Research</th>
                            <th colspan='12'>Grants</th>
                            <th colspan='2'>Dept</th>
                            <th colspan='2'>Faculty</th>
                            <th colspan='2'>University</th>
                            <th colspan='2'>External to the University</th>
                            <th colspan='1'>Other Services</th>
                        </tr>
                        <tr>
                            <th>Case#</th>
                            <th>Name</th>
                            <th>Title</th>
                            <th>Department</th>
                            
                            <th>Teaching</th>
                            <th>Research/scholarly activities</th>
                            <th>Service</th>
                            <th>Admin</th>
                            
                            <th># Courses Taught</th>
                            <th>No of Students (average)</th>
                            <th>SPOT Survey</th>
                            
                            <th>Supervise</th>
                            <th>Committee Mbr</th>
                            <th>Examiner</th>
                            
                            <th>Supervise</th>
                            <th>Committee Mbr</th>
                            <th>Examiner</th>
                            
                            <th></th>
                            
                            <th>First or Senior Refereed</th>
                            <th>Co-Authored Refereed </th>
                            <th>Non-Peer Reviewed Scholarly Article</th>
                            <th>Conference Presentations - Invited</th>
                            <th>Conference Presentations - Oral/Poster</th>
                            <th>Presentation Conference - Panel/Workshop</th>
                            <th>Book or Book Chapters</th>

                            <th style='white-space:nowrap;'># Total New<br />Grants</th>
                            <th style='white-space:nowrap;'># New PI<br />Grants</th>
                            <th style='white-space:nowrap;'># New Grants as<br />Co-Investigator</th>
                            <th style='white-space:nowrap;'># On-going<br />grants</th>
                            <th style='white-space:nowrap;'>New PI<br />Yearly Funds</th>
                            <th style='white-space:nowrap;'>New<br />Grants as<br />Co-I Yearly Funds</th>
                            <th style='white-space:nowrap;'>Ongoing<br />Grant<br />Yearly Funds</th>
                            <th style='white-space:nowrap;'>Total<br />Yearly Funds</th>
                            <th style='white-space:nowrap;'>New PI<br />Funds</th>
                            <th style='white-space:nowrap;'>New<br />Grants as<br />Co-I Funds</th>
                            <th style='white-space:nowrap;'>Ongoing<br />Grant<br />Funds</th>
                            <th style='white-space:nowrap;'>Total<br />Funds</th>

                            <th>Chair</th>
                            <th>Member</th>
                            
                            <th>Chair</th>
                            <th>Member</th>
                            
                            <th>Chair</th>
                            <th>Member</th>
                            
                            <th>Chair</th>
                            <th>Member</th>
                            
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
            ]]>
        </Static>
        <ReportItemSet id="faculty" type="FacultyPeopleReportItemSet" start="{$last_year}-07-01" end="{$this_year}-07-01">
            <Static>
                <![CDATA[
                    <tr>

                        <td style='white-space:nowrap;'>{getExtra()}</td>
                        <td><a href="{$user_url}" target="_blank">{$user_name}</a></td>
                        <td>{$user_level}</td>
                        <td>{$user_dept}</td>
                        
                        <td align='center'>{getText(RP_LETTER5, TABLE, TEACHING, {$user_id}, 1, 0, {$last_year})}</td>
                        <td align='center'>{getText(RP_LETTER5, TABLE, RESEARCH, {$user_id}, 1, 0, {$last_year})}</td>
                        <td align='center'>{getText(RP_LETTER5, TABLE, SERVICE, {$user_id}, 1, 0, {$last_year})}</td>
                        <td align='center'>{getText(RP_LETTER5, TABLE, ADMIN, {$user_id}, 1, 0, {$last_year})}</td>
                        
                        <td align='center'>{$user_courses_count}</td>
                        <td align='center'>{round({divide({$user_student_count}, {$user_courses_count})})}</td>
                        <td></td>
                        
                        <td align='center'>{add({user_msc_count(all,Supervisor)},{user_msc_count(all,Co-Supervisor)})}</td>
                        <td align='center'>{user_msc_count(all,Supervisory-Committee member)}</td>
                        <td align='center'>{add({user_msc_count(all,Examining-Committee member)},{user_msc_count(all,Examining-Committee chair)})}</td>
                        
                        <td align='center'>{add({user_phd_count(all,Supervisor)},{user_phd_count(all,Co-Supervisor)})}</td>
                        <td align='center'>{user_phd_count(all,Supervisory-Committee member)}</td>
                        <td align='center'>{add({user_phd_count(all,Examining-Committee member)},{user_phd_count(all,Examining-Committee chair)})}</td>
                        
                        <td align='center'>{$user_fellow_count}</td>
                        
                        <td align='center'>{getUserPublicationCount(CYCLE_START, CYCLE_END, First Author)}</td>
                        <td align='center'>{getUserPublicationCount(CYCLE_START, CYCLE_END, Co-Author)}</td>
                        <td align='center'>{getUserPublicationCount(CYCLE_START, CYCLE_END, Not Refereed)}</td>
                        <td align='center'>{getUserPublicationCount(CYCLE_START, CYCLE_END, Conference Presentation)}</td>
                        <td align='center'>{getUserPublicationCount(CYCLE_START, CYCLE_END, Poster Presentation)}</td>
                        <td align='center'>{getUserPublicationCount(CYCLE_START, CYCLE_END, Workshop Presentation)}</td>
                        <td align='center'>{getUserPublicationCount(CYCLE_START, CYCLE_END, Books)}</td>

                        <td align='center'>{$user_new_grant}</td>
                        <td align='center'>{user_new_grant(count, pi)}</td>
                        <td align='center'>{user_new_grant(count, copi)}</td>
                        <td align='center'>{$user_continuing_grant}</td>
                        <td align='right'>{number_format({user_new_grant(average, pi)})}</td>
                        <td align='right'>{number_format({user_new_grant(average, copi)})}</td>
                        <td align='right'>{number_format({user_continuing_grant(average, both)})}</td>
                        <td align='right'>{number_format({add({user_new_grant(average, both)},{user_continuing_grant(average, both)})})}</td>
                        <td align='right'>{number_format({user_new_grant(total, pi)})}</td>
                        <td align='right'>{number_format({user_new_grant(total, copi)})}</td>
                        <td align='right'>{number_format({user_continuing_grant(total, both)})}</td>
                        <td align='right'>{number_format({add({user_new_grant(total, both)},{user_continuing_grant(total, both)})})}</td>

                        <td align='center'>{getUserServiceCount(CYCLE_START, CYCLE_END, Departmental, Chair)}</td>
                        <td align='center'>{getUserServiceCount(CYCLE_START, CYCLE_END, Departmental, Member)}</td>
                        
                        <td align='center'>{getUserServiceCount(CYCLE_START, CYCLE_END, Faculty, Chair)}</td>
                        <td align='center'>{getUserServiceCount(CYCLE_START, CYCLE_END, Faculty, Member)}</td>
                        
                        <td align='center'>{getUserServiceCount(CYCLE_START, CYCLE_END, University, Chair)}</td>
                        <td align='center'>{getUserServiceCount(CYCLE_START, CYCLE_END, University, Member)}</td>
                        
                        <td align='center'>{getUserServiceCount(CYCLE_START, CYCLE_END, Community Outreach, Chair)}</td>
                        <td align='center'>{getUserServiceCount(CYCLE_START, CYCLE_END, Community Outreach, Member)}</td>
                        
                        <td align='center'>{getUserServiceCount(CYCLE_START, CYCLE_END, Other)}</td>

                    </tr>
                ]]>
            </Static>
        </ReportItemSet>
        <Static>
            <![CDATA[
                    </tbody>
                </table>
                <script type='text/javascript'>
                    $('#summary').DataTable({
                        scrollX: true,
                        'aLengthMenu': [[100,-1], [100,'All']], 
                        'iDisplayLength': -1, 
                        'dom': 'Blfrtip',
                        'buttons': [
                            'excel'
                        ]
                    });
                </script>
            ]]>
        </Static>
    </ReportSection>
</Report>
