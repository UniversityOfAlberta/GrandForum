<td align="center" style="width:30px">
    <% if(sop_pdf != "") { %>
        <span style="display:none;"><a href="<%= sop_pdf %>" target="_blank"><span class="pdf_gif"></span></a></span>
    <% } %>
    <% if(this.parent.model.year != ''){ %>
        <b><span><%= student_data.name %></b></span><br />
    <% } else { %>
        <b><span><a href="<%= sop_url %>" id="sop<%= sop_id %>" target="_blank"><%= student_data.name %></a></b></span><br />
    <% } %>
    (<%=student_data.email %>)<br /><%= gender %>
    <% if(sop_pdf != "") { %>
        <br />
        <b>GARS PDF:</b> <a href="<%= sop_pdf %>" target="_blank"><span class="pdf_gif"></span></a>
    <% } %>
    <% if(gsms_url != "") { %>
        <br />
        <b>GSMS PDF:</b> <a href="<%= gsms_url %>" target="_blank"><span class="pdf_gif"></span></a>
    <% } %>
</td>

<td style="white-space: nowrap;" id='nationality_notes'>
  <% if(gsms_id != 0){ %>
    <%= gsms_id %><br />
  <% } %>
  <% if(applicant_number != 0){ %>
    <%= applicant_number %><br />
  <% } %>
  <% if(student_id != 0){ %>
    <%= student_id %><br />
  <% } %>
  <input type="checkbox" style="vertical-align: text-bottom;" name="hidden" value="Hidden by me" <% if(hidden){ %> checked <% } %> /> Hidden by me <span id="hiddenThrobber" style="display:none;vertical-align:top;" class="throbber"></span><br />
  <input type="checkbox" style="vertical-align: text-bottom;" name="favorited" value="Favorited" <% if(favorited){ %> checked <% } %> /> Favorited <span id="favoritedThrobber" style="display:none;vertical-align:top;" class="throbber"></span>
</td>

<td style="white-space: nowrap; display:none;" id="gsms_pdf">
<% if(gsms_url != "") { %>
  <a href="<%= gsms_url %>" target="_blank"><span class="pdf_gif"></span></a><br />
<% } %>
</td>

<td style="white-space: wrap;" id='folder'>
    <%= folder %>
</td>

<td style="white-space: nowrap;" id='dob'>
    <%= date_of_birth %>
</td>

<td id='citizenship'>
    <b>Citizenship:</b> <%= additional.country_of_citizenship_full %><br />
    <b>Degree:</b> <%= additional.country_of_degree %><br />
    <b>Current:</b> <%= additional.current_country %><br />
</td>

<td style="white-space: nowrap;" id='applicant_type'>
    <%= applicant_type %>
</td>

<td id='education_history' class="scrollableCell">
    <div class="scrollableCell"><%= education_history %></div>
</td>

<td class="scrollableCell">
    <div class="scrollableCell">
        <% _.each(additional.education, function(degree){ %>
            <%= _.values(degree).join(" ") %><br />
        <% }) %>
    </div>
</td>

<td style="white-space: nowrap;" id='program_name'>
    <% var t = program_name.replace(/Master of Science/g, 'MSc.'); %>
    <%= t.replace(/Doctor of Philosophy/g, 'PhD') %>
  
</td>

<td style="white-space: nowrap;" id='epl'>
    <% if(epl_test.indexOf(",") == -1){ %>
        <%= epl_test %> <br /><%= epl_score %> <br /><%= epl_listen %> <br /><%= epl_write %> <br /><%= epl_read %> <br /><%= epl_speaking %>
    <% } else { %>
        <div style='float:left;'>
        <%= epl_test.split(",")[0] %> <br /><%= epl_score.split(",")[0] %> <br /><%= epl_listen.split(",")[0] %> <br /><%= epl_write.split(",")[0] %> <br /><%= epl_read.split(",")[0] %> <br /><%= epl_speaking.split(",")[0] %></div>
        <div style='float:right;'>
        <%= epl_test.split(",")[1] %> <br /><%= epl_score.split(",")[1] %> <br /><%= epl_listen.split(",")[1] %> <br /><%= epl_write.split(",")[1] %> <br /><%= epl_read.split(",")[1] %> <br /><%= epl_speaking.split(",")[1] %>
        </div>
    <% } %>
</td>

<td>
    <%= additional.edi %>
</td>

<!--  department specific -->
<td class="scrollableCell">
    <% _.each(_.filter(additional.referees, function(referee){ return (referee.email != null && referee.email.indexOf("@ualberta.ca") !== -1); }), function(referee){ %>
        <%= referee.name.trim() %><br />
    <% }) %>
</td>

<td id='aos' class="scrollableCell">
    <div class="scrollableCell"><%= additional.areas_of_study %></div>
</td>

<td id='supervisors' class="scrollableCell">
    <div class="scrollableCell">
        <%= _.map(additional.supervisors, function(sup){ return "<span style='display:none;'>" + sup.last + " " + sup.first + " </span>" + sup.last; }).join(", <br />") %>
    </div>
</td>

<td id='scholarships'>
    <%= additional.scholarships_held %>/<%= additional.scholarships_applied %>
</td>

<td align="right" id='gpaNormalized'>
    <%= additional.gpaNormalized %>
</td>

<td align="right" id='gpaManual'>
    <%= additional.gpaManual %>
</td>

<td id='gres'>
    <%= additional.gre1 %>, <%= additional.gre2 %>, <%= additional.gre3 %>, <%= additional.gre4 %>
</td>

<td align="right" id='pubs'>
    <%= additional.num_publications %>
</td>

<td align="right" id='awards'>
    <%= additional.num_awards %>
</td>

<td align="right" id='courses' class="scrollableCell">
  <div class="scrollableCell">
    <%= additional.courses %>
  </div>
</td>

<td id='submittedDate'>
    <%= submitted_date %>
</td>

<!-- reviewer info -->
<td style="white-space: nowrap;">
    <% for(var i=0; i < reviewers.length;i++){ %>
        <span title="<%= reviewers[i].comments.replaceAll('"', '&quot;') %>"><%= reviewers[i].name %> (<%= reviewers[i].rank.replace("-1", "--") %>)</span>
        <br />
    <% } %>
    <% if(this.parent.model.year == ''){ %>
        <span class="assign_button" style="display:none"><a class="button" href="<%= wgServer+wgScriptPath %>/index.php/Special:AssignReviewer?student=<%= user_id %>">+</a></span>
    <% } %>
</td>

<!-- reviewer average -->
<td style="white-space: nowrap;">
    <% var avg=0; %>
    <% var ignore=0; %>
    <% for(var i=0; i < reviewers.length;i++){ %>
        <% if ((reviewers[i].rank != '--') && (reviewers[i].rank != "-1")) { %>
          <% avg += parseInt(reviewers[i].rank); %>
        <% } else { %>
          <% ignore += 1; %>
        <% } %>
    <% } %>
    <% avg /= reviewers.length - ignore; %>
    <% if(avg) { %> <%= avg.toFixed(2) %> <% } %>
</td>

<!-- faculty info -->
<td style="white-space: nowrap;">
  <% for(var i=0; i < other_reviewers.length;i++){ %>
        <% if (other_reviewers[i].rank == "-1" || other_reviewers[i].rank == "--") { %>
            <!--%= other_reviewers[i].name %> (<span style="color: red;">-1</span>)-->
        <% } else { %>
            <span title="<%= other_reviewers[i].comments.replaceAll('"', '&quot;') %>"><%= other_reviewers[i].name %> (<%= other_reviewers[i].rank.replace("-1", "--") %>)</span><br />
        <% } %>
  <% } %>
</td>

<!-- faculty average -->
<td style="white-space: nowrap;">
    <% var avg=0; %>
    <% var ignore=0; %>
    <% for(var i=0; i < other_reviewers.length;i++){ %>
        <% if (other_reviewers[i].rank != "-1" && other_reviewers[i].rank != "--") { %>
          <% avg += parseInt(other_reviewers[i].rank); %>
        <% } else { %>
          <% ignore += 1; %>
        <% } %>
    <% } %>
    <% avg /= other_reviewers.length - ignore; %>
    <% if(avg) { %> <%= avg.toFixed(2) %> <% } %>
</td>

<td id='notes' class="scrollableCell">
  <div class="scrollableCell" style="height:124px; max-height:124px;">
    <% _.each(additional.notes, function(note, key) { %>
        <% if (note.trim() != ""){ %>
            <% var lastname = me.get('lastname').replace(/[^\wA-zÀ-ÿ]/gi, '') %>
            <% if (key == lastname) { %>
              <font color="#007239" style="font-weight:bold"><%= key %></font>: <%= note %>
            <% } else { %>
              <font style="font-weight:bold"><%= key %></font>: <%= note %>
            <% } %>
            <br />
        <% } %>
    <% }); %>
  </div>
  <% if(this.parent.model.year == ''){ %>
    <span class="assign_button" style="display:none" id="additionalNotes">
      <a class="button">+</a>
      <span class="throbber" style="display:none"></span>
    </span>
    <% var additionalNotesDialogId = 'additionalNotes_' + id; %>
    <div title="Additional Notes" id="<%= additionalNotesDialogId %>" style="display:none; z-index:10;"></div>
  <% } %>
</td>

<td id='confidence' class="scrollableCell">
  <div class="scrollableCell" style="height:124px; max-height:124px;">
    <% _.each(reviewers.concat(other_reviewers), function(reviewer, key) { %>
        <% if(reviewer.extra.confidence != ""){ %>
            <font style="font-weight:bold"><%= _.last(reviewer.name.split(" ")) %></font>: <%= reviewer.extra.confidence %><br />
        <% } %>
    <% }); %>
  </div>
</td>

<td id='basedOn' class="scrollableCell">
  <div class="scrollableCell" style="height:124px; max-height:124px;">
    <% _.each(reviewers.concat(other_reviewers), function(reviewer, key) { %>
        <% if(_.size(reviewer.extra.basedOn) > 0){ %>
            <font style="font-weight:bold"><%= _.last(reviewer.name.split(" ")) %></font>: <%= reviewer.extra.basedOn.join(", ") %><br />
        <% } %>
    <% }); %>
  </div>
</td>

<td id='award' class="scrollableCell">
  <div class="scrollableCell" style="height:124px; max-height:124px;">
    <% _.each(reviewers.concat(other_reviewers), function(reviewer, key) { %>
        <% if(reviewer.extra.award != ""){ %>
            <font style="font-weight:bold"><%= _.last(reviewer.name.split(" ")) %></font>: <%= reviewer.extra.award %><br />
        <% } %>
    <% }); %>
  </div>
</td>

<!--td>
    <%= _.pluck(_.where(reviewers.concat(other_reviewers), {wantToSupervise: true}), 'name').join(",<br />") %>
</td-->

<td>
    <%= _.pluck(_.where(reviewers.concat(other_reviewers), {willingToSupervise: true}), 'name').join(",<br />") %>
</td>

<td>
    <%= supervisor %>
</td>

<td style="width:200px" class="scrollableCell">
    <div class="scrollableCell"><span id="span<%= sop_id %>"><%= comments %></span></div>
</td>

<td>
    <%= admit %>
</td>
